<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ConsensusAI | Multi-LLM Decision Intelligence</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
  <!-- Clerk JS SDK loaded dynamically by initAuth() -->
  <style>
    :root {
      --bg-primary: #09090b;
      --bg-secondary: #0f0f11;
      --bg-tertiary: #18181b;
      --bg-card: rgba(255, 255, 255, 0.02);
      --bg-card-hover: rgba(255, 255, 255, 0.04);
      --border-color: rgba(255, 255, 255, 0.06);
      --border-light: rgba(255, 255, 255, 0.1);
      --text-primary: #fafafa;
      --text-secondary: #a1a1aa;
      --text-tertiary: #71717a;
      --accent-primary: #6366f1;
      --accent-secondary: #8b5cf6;
      --accent-tertiary: #a855f7;
      --accent-gradient: linear-gradient(135deg, #6366f1 0%, #8b5cf6 50%, #a855f7 100%);
      --success: #10b981;
      --success-bg: rgba(16, 185, 129, 0.1);
      --warning: #f59e0b;
      --warning-bg: rgba(245, 158, 11, 0.1);
      --error: #ef4444;
      --error-bg: rgba(239, 68, 68, 0.1);
      --info: #3b82f6;
      --info-bg: rgba(59, 130, 246, 0.1);
      --gpt-color: #10a37f;
      --gemini-color: #4285f4;
      --grok-color: #f97316;
      --claude-color: #d97706;
      --shadow-sm: 0 1px 2px rgba(0, 0, 0, 0.4);
      --shadow-md: 0 4px 16px rgba(0, 0, 0, 0.5);
      --shadow-lg: 0 12px 40px rgba(0, 0, 0, 0.6);
      --shadow-glow: 0 0 80px rgba(99, 102, 241, 0.12);
      --radius-sm: 8px;
      --radius-md: 12px;
      --radius-lg: 16px;
      --radius-xl: 20px;
      --radius-2xl: 28px;
      --transition-fast: 150ms ease;
      --transition-normal: 250ms ease;
      --transition-slow: 400ms cubic-bezier(0.4, 0, 0.2, 1);
    }

    * { margin: 0; padding: 0; box-sizing: border-box; }

    html { scroll-behavior: smooth; }

    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
      background: var(--bg-primary);
      color: var(--text-primary);
      min-height: 100vh;
      overflow-x: hidden;
      line-height: 1.6;
      -webkit-font-smoothing: antialiased;
    }

    /* Background */
    .bg-effects {
      position: fixed;
      inset: 0;
      pointer-events: none;
      z-index: 0;
      overflow: hidden;
    }

    .bg-gradient-orb {
      position: absolute;
      border-radius: 50%;
      filter: blur(100px);
      opacity: 0.5;
    }

    .orb-1 {
      width: 600px;
      height: 600px;
      background: radial-gradient(circle, rgba(99, 102, 241, 0.15) 0%, transparent 70%);
      top: -200px;
      left: -100px;
      animation: float1 25s ease-in-out infinite;
    }

    .orb-2 {
      width: 500px;
      height: 500px;
      background: radial-gradient(circle, rgba(139, 92, 246, 0.12) 0%, transparent 70%);
      bottom: -150px;
      right: -100px;
      animation: float2 30s ease-in-out infinite;
    }

    .orb-3 {
      width: 400px;
      height: 400px;
      background: radial-gradient(circle, rgba(168, 85, 247, 0.08) 0%, transparent 70%);
      top: 40%;
      left: 60%;
      animation: float3 20s ease-in-out infinite;
    }

    @keyframes float1 {
      0%, 100% { transform: translate(0, 0); }
      50% { transform: translate(50px, 30px); }
    }

    @keyframes float2 {
      0%, 100% { transform: translate(0, 0); }
      50% { transform: translate(-40px, -20px); }
    }

    @keyframes float3 {
      0%, 100% { transform: translate(0, 0); }
      50% { transform: translate(-30px, 40px); }
    }

    .grid-overlay {
      position: absolute;
      inset: 0;
      background-image:
        linear-gradient(rgba(255,255,255,0.02) 1px, transparent 1px),
        linear-gradient(90deg, rgba(255,255,255,0.02) 1px, transparent 1px);
      background-size: 60px 60px;
      mask-image: radial-gradient(ellipse at center, black 0%, transparent 70%);
    }

    /* Navigation */
    nav {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      z-index: 50;
      padding: 1rem 2rem;
      background: rgba(9, 9, 11, 0.8);
      backdrop-filter: blur(20px);
      border-bottom: 1px solid var(--border-color);
    }

    .nav-inner {
      max-width: 1400px;
      margin: 0 auto;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .nav-logo {
      display: flex;
      align-items: center;
      gap: 0.625rem;
      text-decoration: none;
    }

    .nav-logo-icon {
      width: 36px;
      height: 36px;
      background: var(--accent-gradient);
      border-radius: var(--radius-sm);
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 800;
      font-size: 1rem;
      color: white;
    }

    .nav-logo-text {
      font-size: 1.25rem;
      font-weight: 700;
      background: var(--accent-gradient);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }

    .nav-links {
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .nav-link {
      padding: 0.5rem 1rem;
      font-size: 0.875rem;
      font-weight: 500;
      color: var(--text-secondary);
      text-decoration: none;
      border-radius: var(--radius-sm);
      transition: var(--transition-fast);
    }

    .nav-link:hover {
      color: var(--text-primary);
      background: var(--bg-card-hover);
    }

    .nav-link.active {
      color: var(--text-primary);
      background: var(--bg-tertiary);
    }

    /* Auth UI */
    .nav-auth {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      margin-left: 1rem;
    }

    .auth-btn {
      padding: 0.5rem 1rem;
      font-size: 0.875rem;
      font-weight: 500;
      border-radius: var(--radius-sm);
      cursor: pointer;
      transition: var(--transition-fast);
      border: none;
      font-family: inherit;
    }

    .auth-btn-signin {
      color: var(--text-secondary);
      background: transparent;
    }

    .auth-btn-signin:hover {
      color: var(--text-primary);
      background: var(--bg-card-hover);
    }

    .auth-btn-signup {
      color: white;
      background: var(--accent-gradient);
    }

    .auth-btn-signup:hover {
      opacity: 0.9;
    }

    .user-menu {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.35rem 0.75rem 0.35rem 0.35rem;
      background: var(--bg-card);
      border: 1px solid var(--border-color);
      border-radius: var(--radius-lg);
      cursor: pointer;
      transition: var(--transition-fast);
    }

    .user-menu:hover {
      background: var(--bg-card-hover);
      border-color: var(--border-light);
    }

    .user-avatar {
      width: 28px;
      height: 28px;
      border-radius: 50%;
      background: var(--accent-gradient);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.75rem;
      font-weight: 600;
      color: white;
      overflow: hidden;
    }

    .user-avatar img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .user-name {
      font-size: 0.875rem;
      font-weight: 500;
      color: var(--text-primary);
      max-width: 120px;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }

    .user-tier {
      font-size: 0.625rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      padding: 0.125rem 0.375rem;
      border-radius: 4px;
    }

    .user-tier-free {
      background: var(--bg-tertiary);
      color: var(--text-tertiary);
    }

    .user-tier-pro {
      background: var(--accent-gradient);
      color: white;
    }

    .user-dropdown {
      position: absolute;
      top: calc(100% + 0.5rem);
      right: 0;
      min-width: 200px;
      background: var(--bg-secondary);
      border: 1px solid var(--border-color);
      border-radius: var(--radius-md);
      box-shadow: var(--shadow-lg);
      opacity: 0;
      visibility: hidden;
      transform: translateY(-8px);
      transition: var(--transition-fast);
      z-index: 1000;
    }

    .user-menu.active .user-dropdown {
      opacity: 1;
      visibility: visible;
      transform: translateY(0);
    }

    .user-dropdown-item {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      padding: 0.75rem 1rem;
      font-size: 0.875rem;
      color: var(--text-secondary);
      text-decoration: none;
      cursor: pointer;
      transition: var(--transition-fast);
    }

    .user-dropdown-item:first-child {
      border-radius: var(--radius-md) var(--radius-md) 0 0;
    }

    .user-dropdown-item:last-child {
      border-radius: 0 0 var(--radius-md) var(--radius-md);
    }

    .user-dropdown-item:hover {
      background: var(--bg-card-hover);
      color: var(--text-primary);
    }

    .user-dropdown-divider {
      height: 1px;
      background: var(--border-color);
      margin: 0.25rem 0;
    }

    .auth-loading {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      color: var(--text-tertiary);
      font-size: 0.875rem;
    }

    .auth-loading-spinner {
      width: 16px;
      height: 16px;
      border: 2px solid var(--border-color);
      border-top-color: var(--accent-primary);
      border-radius: 50%;
      animation: spin 0.8s linear infinite;
    }

    /* App Container */
    .app {
      position: relative;
      z-index: 1;
      max-width: 1400px;
      margin: 0 auto;
      padding: 6rem 2rem 4rem;
    }

    /* Hero Section */
    .hero {
      text-align: center;
      padding: 3rem 0 4rem;
    }

    .hero-badge {
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.5rem 1rem;
      background: var(--bg-tertiary);
      border: 1px solid var(--border-color);
      border-radius: 100px;
      font-size: 0.8125rem;
      color: var(--text-secondary);
      margin-bottom: 1.5rem;
    }

    .hero-badge-dot {
      width: 6px;
      height: 6px;
      background: var(--success);
      border-radius: 50%;
      animation: pulse 2s ease-in-out infinite;
    }

    @keyframes pulse {
      0%, 100% { opacity: 1; transform: scale(1); }
      50% { opacity: 0.6; transform: scale(0.9); }
    }

    .hero-title {
      font-size: clamp(2.5rem, 5vw, 4rem);
      font-weight: 800;
      line-height: 1.1;
      letter-spacing: -0.03em;
      margin-bottom: 1.25rem;
    }

    .hero-title-gradient {
      background: var(--accent-gradient);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }

    .hero-subtitle {
      font-size: 1.25rem;
      color: var(--text-secondary);
      max-width: 600px;
      margin: 0 auto 2rem;
      line-height: 1.7;
    }

    .hero-stats {
      display: flex;
      justify-content: center;
      gap: 3rem;
      flex-wrap: wrap;
    }

    .hero-stat {
      text-align: center;
    }

    .hero-stat-value {
      font-size: 1.5rem;
      font-weight: 700;
      color: var(--text-primary);
    }

    .hero-stat-label {
      font-size: 0.8125rem;
      color: var(--text-tertiary);
    }

    /* Tabs */
    .tabs {
      display: flex;
      gap: 0.25rem;
      padding: 0.25rem;
      background: var(--bg-secondary);
      border: 1px solid var(--border-color);
      border-radius: var(--radius-lg);
      margin-bottom: 2rem;
      width: fit-content;
      margin-left: auto;
      margin-right: auto;
    }

    .tab {
      padding: 0.75rem 1.5rem;
      font-size: 0.875rem;
      font-weight: 500;
      color: var(--text-secondary);
      background: transparent;
      border: none;
      border-radius: var(--radius-md);
      cursor: pointer;
      transition: var(--transition-fast);
    }

    .tab:hover {
      color: var(--text-primary);
    }

    .tab.active {
      color: var(--text-primary);
      background: var(--bg-tertiary);
      box-shadow: var(--shadow-sm);
    }

    /* Panels */
    .panel {
      display: none;
    }

    .panel.active {
      display: block;
      animation: fadeIn 0.3s ease;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(8px); }
      to { opacity: 1; transform: translateY(0); }
    }

    /* Main Card */
    .main-card {
      background: var(--bg-card);
      border: 1px solid var(--border-color);
      border-radius: var(--radius-2xl);
      padding: 2.5rem;
      backdrop-filter: blur(20px);
      box-shadow: var(--shadow-lg), var(--shadow-glow);
    }

    /* Form Styles */
    .form-section {
      margin-bottom: 2rem;
    }

    .form-label {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      font-size: 0.875rem;
      font-weight: 600;
      color: var(--text-primary);
      margin-bottom: 0.75rem;
    }

    .form-label-optional {
      font-weight: 400;
      color: var(--text-tertiary);
    }

    .form-input {
      width: 100%;
      background: var(--bg-secondary);
      border: 1px solid var(--border-color);
      border-radius: var(--radius-md);
      padding: 1rem 1.25rem;
      font-size: 1rem;
      color: var(--text-primary);
      font-family: inherit;
      transition: var(--transition-fast);
      resize: none;
    }

    .form-input:focus {
      outline: none;
      border-color: var(--accent-primary);
      box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.12);
    }

    .form-input::placeholder {
      color: var(--text-tertiary);
    }

    textarea.form-input {
      min-height: 100px;
    }

    .form-input-wrapper {
      position: relative;
    }

    .char-counter {
      position: absolute;
      right: 1rem;
      bottom: 0.75rem;
      font-size: 0.75rem;
      color: var(--text-tertiary);
      font-family: 'JetBrains Mono', monospace;
    }

    /* Templates */
    .templates-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
      gap: 0.75rem;
      margin-bottom: 1.5rem;
    }

    .template-btn {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 0.5rem;
      padding: 1rem;
      background: var(--bg-secondary);
      border: 1px solid var(--border-color);
      border-radius: var(--radius-md);
      cursor: pointer;
      transition: var(--transition-fast);
      text-align: center;
    }

    .template-btn:hover {
      border-color: var(--border-light);
      background: var(--bg-card-hover);
      transform: translateY(-2px);
    }

    .template-btn.selected {
      border-color: var(--accent-primary);
      background: rgba(99, 102, 241, 0.1);
    }

    .template-icon {
      width: 24px;
      height: 24px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .template-icon svg {
      width: 100%;
      height: 100%;
      stroke: var(--accent-primary);
      stroke-width: 1.5;
      fill: none;
    }

    .template-btn:hover .template-icon svg {
      stroke: var(--text-primary);
    }

    .template-btn.active .template-icon svg {
      stroke: var(--text-primary);
    }

    .template-name {
      font-size: 0.8125rem;
      font-weight: 500;
      color: var(--text-primary);
    }

    /* Options Row */
    .options-row {
      display: flex;
      gap: 1rem;
      flex-wrap: wrap;
      margin-bottom: 1.5rem;
    }

    .option-toggle {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      padding: 0.75rem 1rem;
      background: var(--bg-secondary);
      border: 1px solid var(--border-color);
      border-radius: var(--radius-md);
      cursor: pointer;
      transition: var(--transition-fast);
    }

    .option-toggle:hover {
      border-color: var(--border-light);
    }

    .option-toggle.active {
      border-color: var(--accent-primary);
      background: rgba(99, 102, 241, 0.08);
    }

    .toggle-switch {
      width: 40px;
      height: 22px;
      background: var(--bg-tertiary);
      border-radius: 11px;
      position: relative;
      transition: var(--transition-fast);
    }

    .toggle-switch::after {
      content: '';
      position: absolute;
      width: 18px;
      height: 18px;
      background: var(--text-secondary);
      border-radius: 50%;
      top: 2px;
      left: 2px;
      transition: var(--transition-fast);
    }

    .option-toggle.active .toggle-switch {
      background: var(--accent-primary);
    }

    .option-toggle.active .toggle-switch::after {
      transform: translateX(18px);
      background: white;
    }

    .option-label {
      font-size: 0.875rem;
      color: var(--text-secondary);
    }

    .option-toggle.active .option-label {
      color: var(--text-primary);
    }

    /* Tooltips */
    .has-tooltip {
      position: relative;
    }

    .tooltip {
      position: absolute;
      bottom: calc(100% + 8px);
      left: 50%;
      transform: translateX(-50%);
      background: var(--bg-tertiary);
      border: 1px solid var(--border-light);
      border-radius: var(--radius-sm);
      padding: 0.75rem 1rem;
      font-size: 0.8125rem;
      color: var(--text-secondary);
      white-space: normal;
      width: 280px;
      text-align: left;
      opacity: 0;
      visibility: hidden;
      transition: var(--transition-fast);
      z-index: 100;
      box-shadow: var(--shadow-lg);
      pointer-events: none;
    }

    .tooltip::after {
      content: '';
      position: absolute;
      top: 100%;
      left: 50%;
      transform: translateX(-50%);
      border: 6px solid transparent;
      border-top-color: var(--border-light);
    }

    .has-tooltip:hover .tooltip {
      opacity: 1;
      visibility: visible;
    }

    .tooltip-title {
      font-weight: 600;
      color: var(--text-primary);
      margin-bottom: 0.375rem;
    }

    .help-icon {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      width: 16px;
      height: 16px;
      background: var(--bg-tertiary);
      border-radius: 50%;
      font-size: 0.625rem;
      color: var(--text-tertiary);
      margin-left: 0.375rem;
      cursor: help;
    }

    /* Debate Timeline */
    .debate-timeline {
      margin-top: 2rem;
      padding: 1.5rem;
      background: var(--bg-secondary);
      border: 1px solid var(--border-color);
      border-radius: var(--radius-lg);
    }

    .timeline-title {
      font-size: 1rem;
      font-weight: 600;
      margin-bottom: 1rem;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .timeline-steps {
      position: relative;
      padding-left: 2rem;
    }

    .timeline-steps::before {
      content: '';
      position: absolute;
      left: 7px;
      top: 0;
      bottom: 0;
      width: 2px;
      background: var(--border-color);
    }

    .timeline-step {
      position: relative;
      padding-bottom: 1.25rem;
    }

    .timeline-step:last-child {
      padding-bottom: 0;
    }

    .timeline-step::before {
      content: '';
      position: absolute;
      left: -2rem;
      top: 4px;
      width: 16px;
      height: 16px;
      background: var(--bg-tertiary);
      border: 2px solid var(--border-light);
      border-radius: 50%;
    }

    .timeline-step.completed::before {
      background: var(--success);
      border-color: var(--success);
    }

    .timeline-step.active::before {
      background: var(--accent-primary);
      border-color: var(--accent-primary);
      animation: pulse 1.5s ease-in-out infinite;
    }

    .timeline-step-title {
      font-weight: 500;
      font-size: 0.9375rem;
      margin-bottom: 0.25rem;
    }

    .timeline-step-desc {
      font-size: 0.8125rem;
      color: var(--text-tertiary);
    }

    .timeline-step-details {
      margin-top: 0.5rem;
      padding: 0.75rem;
      background: var(--bg-tertiary);
      border-radius: var(--radius-sm);
      font-size: 0.8125rem;
    }

    .timeline-position {
      display: flex;
      gap: 0.5rem;
      margin-bottom: 0.375rem;
    }

    .timeline-position:last-child {
      margin-bottom: 0;
    }

    .timeline-llm-name {
      font-weight: 500;
      min-width: 60px;
    }

    .timeline-llm-name.gpt { color: var(--gpt-color); }
    .timeline-llm-name.gemini { color: var(--gemini-color); }
    .timeline-llm-name.grok { color: var(--grok-color); }
    .timeline-llm-name.claude { color: var(--claude-color); }

    /* Live Status Indicator */
    .live-indicator {
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.375rem 0.75rem;
      background: var(--error-bg);
      border: 1px solid rgba(239, 68, 68, 0.3);
      border-radius: 100px;
      font-size: 0.75rem;
      font-weight: 600;
      color: var(--error);
    }

    .live-dot {
      width: 8px;
      height: 8px;
      background: var(--error);
      border-radius: 50%;
      animation: livePulse 1s ease-in-out infinite;
    }

    @keyframes livePulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.4; }
    }

    /* Usage Indicator */
    .usage-indicator {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 1rem;
      margin-top: 1rem;
      padding: 0.75rem 1.25rem;
      background: var(--warning-bg);
      border: 1px solid rgba(245, 158, 11, 0.3);
      border-radius: 100px;
      font-size: 0.875rem;
    }

    .usage-text {
      color: var(--warning);
    }

    .upgrade-link {
      color: var(--accent-primary);
      text-decoration: none;
      font-weight: 600;
    }

    .upgrade-link:hover {
      text-decoration: underline;
    }

    .limit-reached {
      background: var(--error-bg);
      border-color: rgba(239, 68, 68, 0.3);
    }

    .limit-reached .usage-text {
      color: var(--error);
    }

    /* Pro Badge */
    .pro-badge {
      display: inline-flex;
      align-items: center;
      gap: 0.25rem;
      padding: 0.25rem 0.5rem;
      background: var(--accent-gradient);
      border-radius: 4px;
      font-size: 0.625rem;
      font-weight: 700;
      color: white;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    /* Buttons */
    .btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 0.625rem;
      padding: 0.875rem 1.75rem;
      font-size: 0.9375rem;
      font-weight: 600;
      font-family: inherit;
      border: none;
      border-radius: var(--radius-md);
      cursor: pointer;
      transition: var(--transition-normal);
      text-decoration: none;
    }

    .btn-primary {
      background: var(--accent-gradient);
      color: white;
      box-shadow: 0 4px 16px rgba(99, 102, 241, 0.3);
    }

    .btn-primary:hover:not(:disabled) {
      transform: translateY(-2px);
      box-shadow: 0 8px 24px rgba(99, 102, 241, 0.4);
    }

    .btn-primary:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      transform: none;
    }

    .btn-secondary {
      background: var(--bg-tertiary);
      color: var(--text-primary);
      border: 1px solid var(--border-color);
    }

    .btn-secondary:hover {
      background: var(--bg-card-hover);
      border-color: var(--border-light);
    }

    .btn-ghost {
      background: transparent;
      color: var(--text-secondary);
      padding: 0.5rem 1rem;
    }

    .btn-ghost:hover {
      color: var(--text-primary);
      background: var(--bg-card-hover);
    }

    .btn-full { width: 100%; }

    .btn-icon {
      width: 20px;
      height: 20px;
    }

    /* Debate Section */
    .debate-container {
      margin-top: 2.5rem;
      display: none;
    }

    .debate-container.active {
      display: block;
      animation: slideUp 0.4s ease;
    }

    @keyframes slideUp {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }

    @keyframes cardUpdate {
      0% { transform: scale(1); box-shadow: 0 0 0 0 rgba(99, 102, 241, 0); }
      50% { transform: scale(1.02); box-shadow: 0 0 0 4px rgba(99, 102, 241, 0.3); }
      100% { transform: scale(1); box-shadow: 0 0 0 0 rgba(99, 102, 241, 0); }
    }

    /* Live Activity Feed */
    .activity-feed {
      background: var(--bg-secondary);
      border: 1px solid var(--border-color);
      border-radius: var(--radius-lg);
      padding: 1.25rem;
      margin-bottom: 1.5rem;
      max-height: 200px;
      overflow-y: auto;
    }

    .activity-feed-header {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      margin-bottom: 1rem;
      padding-bottom: 0.75rem;
      border-bottom: 1px solid var(--border-color);
    }

    .activity-feed-title {
      font-size: 0.875rem;
      font-weight: 600;
      color: var(--text-primary);
    }

    .activity-feed-live {
      display: flex;
      align-items: center;
      gap: 0.375rem;
      padding: 0.25rem 0.5rem;
      background: rgba(239, 68, 68, 0.1);
      border-radius: 100px;
      font-size: 0.6875rem;
      font-weight: 600;
      color: var(--error);
    }

    .activity-feed-live .live-dot {
      width: 6px;
      height: 6px;
    }

    .activity-list {
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
    }

    .activity-item {
      display: flex;
      align-items: flex-start;
      gap: 0.75rem;
      padding: 0.625rem;
      background: var(--bg-tertiary);
      border-radius: var(--radius-sm);
      animation: activitySlideIn 0.3s ease;
    }

    @keyframes activitySlideIn {
      from { opacity: 0; transform: translateX(-10px); }
      to { opacity: 1; transform: translateX(0); }
    }

    .activity-icon {
      width: 28px;
      height: 28px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.75rem;
      flex-shrink: 0;
    }

    .activity-icon.gpt { background: var(--gpt-color); color: white; }
    .activity-icon.gemini { background: var(--gemini-color); color: white; }
    .activity-icon.grok { background: var(--grok-color); color: white; }
    .activity-icon.claude { background: var(--claude-color); color: white; }
    .activity-icon.system { background: var(--accent-primary); color: white; }
    .activity-icon.consensus { background: var(--success); color: white; }

    .activity-content {
      flex: 1;
      min-width: 0;
    }

    .activity-message {
      font-size: 0.8125rem;
      color: var(--text-primary);
      line-height: 1.4;
    }

    .activity-time {
      font-size: 0.6875rem;
      color: var(--text-tertiary);
      margin-top: 0.25rem;
    }

    .activity-typing {
      display: inline-flex;
      gap: 3px;
      margin-left: 4px;
    }

    .activity-typing span {
      width: 4px;
      height: 4px;
      background: var(--text-tertiary);
      border-radius: 50%;
      animation: typingBounce 1.4s infinite ease-in-out;
    }

    .activity-typing span:nth-child(1) { animation-delay: 0s; }
    .activity-typing span:nth-child(2) { animation-delay: 0.2s; }
    .activity-typing span:nth-child(3) { animation-delay: 0.4s; }

    @keyframes typingBounce {
      0%, 80%, 100% { transform: translateY(0); }
      40% { transform: translateY(-4px); }
    }

    /* Expandable Details */
    .llm-details-toggle {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0.375rem;
      width: 100%;
      padding: 0.625rem;
      margin-top: 0.75rem;
      background: var(--bg-tertiary);
      border: 1px solid var(--border-color);
      border-radius: var(--radius-sm);
      font-size: 0.75rem;
      font-weight: 500;
      color: var(--text-secondary);
      cursor: pointer;
      transition: var(--transition-fast);
    }

    .llm-details-toggle:hover {
      background: var(--bg-card-hover);
      color: var(--text-primary);
    }

    .llm-details-toggle svg {
      width: 14px;
      height: 14px;
      transition: transform 0.2s ease;
    }

    .llm-details-toggle.expanded svg {
      transform: rotate(180deg);
    }

    .llm-details-panel {
      display: none;
      margin-top: 0.75rem;
      padding: 1rem;
      background: var(--bg-primary);
      border: 1px solid var(--border-color);
      border-radius: var(--radius-sm);
      animation: detailsExpand 0.3s ease;
    }

    .llm-details-panel.active {
      display: block;
    }

    @keyframes detailsExpand {
      from { opacity: 0; max-height: 0; }
      to { opacity: 1; max-height: 500px; }
    }

    .details-section {
      margin-bottom: 1rem;
    }

    .details-section:last-child {
      margin-bottom: 0;
    }

    .details-label {
      font-size: 0.6875rem;
      font-weight: 600;
      color: var(--text-tertiary);
      text-transform: uppercase;
      letter-spacing: 0.05em;
      margin-bottom: 0.5rem;
    }

    .details-content {
      font-size: 0.8125rem;
      color: var(--text-secondary);
      line-height: 1.6;
      white-space: pre-wrap;
      word-break: break-word;
    }

    .details-content.reasoning {
      background: var(--bg-tertiary);
      padding: 0.75rem;
      border-radius: var(--radius-sm);
      max-height: 150px;
      overflow-y: auto;
    }

    .details-risks, .details-assumptions {
      display: flex;
      flex-wrap: wrap;
      gap: 0.375rem;
    }

    .details-tag {
      padding: 0.25rem 0.5rem;
      background: var(--bg-tertiary);
      border-radius: var(--radius-sm);
      font-size: 0.6875rem;
      color: var(--text-secondary);
    }

    .details-tag.risk {
      background: var(--error-bg);
      color: var(--error);
    }

    .details-tag.assumption {
      background: var(--warning-bg);
      color: var(--warning);
    }

    /* Thinking Status Animation */
    .thinking-status {
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .thinking-text {
      font-size: 0.75rem;
      color: var(--text-tertiary);
      animation: textFade 2s infinite;
    }

    @keyframes textFade {
      0%, 100% { opacity: 0.5; }
      50% { opacity: 1; }
    }

    .debate-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 1.5rem;
      padding-bottom: 1rem;
      border-bottom: 1px solid var(--border-color);
    }

    .debate-title {
      font-size: 1.125rem;
      font-weight: 600;
    }

    .round-indicator {
      display: flex;
      align-items: center;
      gap: 0.75rem;
    }

    .round-dots {
      display: flex;
      gap: 0.375rem;
    }

    .round-dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background: var(--bg-tertiary);
      transition: var(--transition-fast);
    }

    .round-dot.active {
      background: var(--accent-primary);
    }

    .round-dot.completed {
      background: var(--success);
    }

    .round-text {
      font-size: 0.875rem;
      color: var(--text-secondary);
      font-family: 'JetBrains Mono', monospace;
    }

    /* LLM Cards */
    .llm-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 1.25rem;
    }

    .llm-card {
      background: var(--bg-secondary);
      border: 1px solid var(--border-color);
      border-radius: var(--radius-lg);
      overflow: hidden;
      transition: var(--transition-normal);
    }

    .llm-card.active {
      border-color: var(--border-light);
    }

    .llm-card-header {
      padding: 1.25rem;
      display: flex;
      align-items: center;
      gap: 0.875rem;
      border-bottom: 1px solid var(--border-color);
    }

    .llm-avatar {
      width: 44px;
      height: 44px;
      border-radius: var(--radius-md);
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 700;
      font-size: 0.875rem;
      color: white;
    }

    .llm-avatar.gpt { background: var(--gpt-color); }
    .llm-avatar.gemini { background: var(--gemini-color); }
    .llm-avatar.grok { background: var(--grok-color); }
    .llm-avatar.claude { background: var(--claude-color); }

    .llm-info { flex: 1; }

    .llm-name {
      font-weight: 600;
      font-size: 0.9375rem;
    }

    .llm-model {
      font-size: 0.75rem;
      color: var(--text-tertiary);
      font-family: 'JetBrains Mono', monospace;
    }

    .llm-status {
      display: flex;
      align-items: center;
      gap: 0.375rem;
      font-size: 0.75rem;
      color: var(--text-tertiary);
    }

    .status-spinner {
      width: 14px;
      height: 14px;
      border: 2px solid var(--border-color);
      border-top-color: var(--accent-primary);
      border-radius: 50%;
      animation: spin 0.8s linear infinite;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    .llm-card-body {
      padding: 1.25rem;
    }

    .position-box {
      background: var(--bg-tertiary);
      border-radius: var(--radius-sm);
      padding: 1rem;
      margin-bottom: 1rem;
    }

    .position-label {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      font-size: 0.6875rem;
      font-weight: 600;
      color: var(--text-tertiary);
      text-transform: uppercase;
      letter-spacing: 0.05em;
      margin-bottom: 0.5rem;
    }

    .changed-tag {
      background: var(--warning-bg);
      color: var(--warning);
      padding: 0.125rem 0.5rem;
      border-radius: 100px;
      font-size: 0.625rem;
      font-weight: 600;
    }

    /* Decision Badge Styles */
    .decision-badge {
      display: inline-flex;
      align-items: center;
      gap: 0.25rem;
      padding: 0.375rem 0.75rem;
      border-radius: 6px;
      font-size: 0.75rem;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      margin-bottom: 0.5rem;
    }

    .decision-badge.yes {
      background: linear-gradient(135deg, rgba(16, 185, 129, 0.2), rgba(16, 185, 129, 0.1));
      color: #10b981;
      border: 1px solid rgba(16, 185, 129, 0.3);
    }

    .decision-badge.no {
      background: linear-gradient(135deg, rgba(239, 68, 68, 0.2), rgba(239, 68, 68, 0.1));
      color: #ef4444;
      border: 1px solid rgba(239, 68, 68, 0.3);
    }

    .decision-badge.conditional {
      background: linear-gradient(135deg, rgba(245, 158, 11, 0.2), rgba(245, 158, 11, 0.1));
      color: #f59e0b;
      border: 1px solid rgba(245, 158, 11, 0.3);
    }

    .decision-badge.wait {
      background: linear-gradient(135deg, rgba(99, 102, 241, 0.2), rgba(99, 102, 241, 0.1));
      color: #6366f1;
      border: 1px solid rgba(99, 102, 241, 0.3);
    }

    .decision-badge.alternative {
      background: linear-gradient(135deg, rgba(139, 92, 246, 0.2), rgba(139, 92, 246, 0.1));
      color: #8b5cf6;
      border: 1px solid rgba(139, 92, 246, 0.3);
    }

    .decision-badge.unknown {
      background: rgba(107, 114, 128, 0.2);
      color: #6b7280;
      border: 1px solid rgba(107, 114, 128, 0.3);
    }

    /* Reasoning preview on card */
    .reasoning-preview {
      font-size: 0.8125rem;
      color: var(--text-secondary);
      line-height: 1.5;
      margin-top: 0.75rem;
      padding-top: 0.75rem;
      border-top: 1px solid var(--border-color);
      max-height: 100px;
      overflow: hidden;
      position: relative;
    }

    .reasoning-preview::after {
      content: '';
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      height: 30px;
      background: linear-gradient(transparent, var(--card-bg));
    }

    .position-text {
      font-size: 0.9375rem;
      color: var(--text-primary);
      line-height: 1.5;
    }

    .confidence-meter {
      margin-top: 1rem;
    }

    .confidence-header {
      display: flex;
      justify-content: space-between;
      margin-bottom: 0.5rem;
    }

    .confidence-label {
      font-size: 0.75rem;
      color: var(--text-tertiary);
    }

    .confidence-value {
      font-size: 0.75rem;
      font-weight: 600;
      color: var(--text-primary);
      font-family: 'JetBrains Mono', monospace;
    }

    .confidence-bar {
      height: 6px;
      background: var(--bg-tertiary);
      border-radius: 3px;
      overflow: hidden;
    }

    .confidence-fill {
      height: 100%;
      border-radius: 3px;
      transition: width 0.6s cubic-bezier(0.4, 0, 0.2, 1);
    }

    .confidence-fill.gpt { background: var(--gpt-color); }
    .confidence-fill.gemini { background: var(--gemini-color); }
    .confidence-fill.grok { background: var(--grok-color); }
    .confidence-fill.claude { background: var(--claude-color); }

    .key-argument {
      margin-top: 1rem;
      padding-top: 1rem;
      border-top: 1px solid var(--border-color);
      font-size: 0.8125rem;
      color: var(--text-secondary);
      font-style: italic;
    }

    /* Alternative Positions Panel */
    .alternatives-panel {
      margin-top: 2rem;
      padding: 1.5rem;
      background: var(--bg-secondary);
      border: 1px solid var(--border-color);
      border-radius: var(--radius-lg);
      display: none;
    }

    .alternatives-panel.active {
      display: block;
    }

    .alternatives-title {
      font-size: 1rem;
      font-weight: 600;
      margin-bottom: 1rem;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .alternatives-grid {
      display: grid;
      gap: 1rem;
    }

    .alternative-item {
      display: flex;
      gap: 1rem;
      padding: 1rem;
      background: var(--bg-tertiary);
      border-radius: var(--radius-md);
      border-left: 3px solid var(--border-color);
    }

    .alternative-item.majority {
      border-left-color: var(--success);
      background: rgba(16, 185, 129, 0.05);
    }

    .alternative-votes {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 0.25rem;
    }

    .vote-count {
      font-size: 1.25rem;
      font-weight: 700;
      color: var(--text-primary);
    }

    .vote-label {
      font-size: 0.625rem;
      color: var(--text-tertiary);
      text-transform: uppercase;
    }

    .alternative-content {
      flex: 1;
    }

    .alternative-position {
      font-weight: 500;
      margin-bottom: 0.375rem;
    }

    .alternative-supporters {
      font-size: 0.75rem;
      color: var(--text-tertiary);
    }

    /* Result Card - Hero Decision */
    .result-card {
      margin-top: 2rem;
      display: none;
    }

    .result-card.active {
      display: block;
      animation: resultPop 0.6s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    }

    @keyframes resultPop {
      from { opacity: 0; transform: scale(0.95); }
      to { opacity: 1; transform: scale(1); }
    }

    /* Hero Decision Section */
    .hero-decision {
      position: relative;
      padding: 3rem;
      background: linear-gradient(135deg, rgba(99, 102, 241, 0.12) 0%, rgba(139, 92, 246, 0.12) 50%, rgba(168, 85, 247, 0.08) 100%);
      border: 1px solid rgba(99, 102, 241, 0.3);
      border-radius: var(--radius-xl);
      text-align: center;
      overflow: hidden;
    }

    .hero-decision::before {
      content: '';
      position: absolute;
      top: -50%;
      left: -50%;
      width: 200%;
      height: 200%;
      background: radial-gradient(circle, rgba(99, 102, 241, 0.1) 0%, transparent 50%);
      animation: heroGlow 4s ease-in-out infinite;
    }

    @keyframes heroGlow {
      0%, 100% { transform: translate(0, 0); }
      50% { transform: translate(5%, 5%); }
    }

    .hero-decision-content {
      position: relative;
      z-index: 1;
    }

    .verdict-label {
      font-size: 0.75rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 2px;
      color: var(--text-tertiary);
      margin-bottom: 1rem;
    }

    .verdict-main {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 1rem;
      margin-bottom: 1.5rem;
    }

    .verdict-icon {
      width: 64px;
      height: 64px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 2rem;
      animation: iconPulse 2s ease-in-out infinite;
    }

    .verdict-icon.yes { background: linear-gradient(135deg, #10b981 0%, #059669 100%); }
    .verdict-icon.no { background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%); }
    .verdict-icon.conditional { background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%); }
    .verdict-icon.wait { background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%); }
    .verdict-icon.alternative { background: linear-gradient(135deg, #6366f1 0%, #4f46e5 100%); }

    @keyframes iconPulse {
      0%, 100% { transform: scale(1); box-shadow: 0 0 0 0 rgba(99, 102, 241, 0.4); }
      50% { transform: scale(1.05); box-shadow: 0 0 30px 10px rgba(99, 102, 241, 0.2); }
    }

    .verdict-decision {
      font-size: 3rem;
      font-weight: 800;
      background: var(--accent-gradient);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      text-transform: uppercase;
      letter-spacing: 2px;
    }

    .verdict-consensus {
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.5rem 1rem;
      background: rgba(16, 185, 129, 0.15);
      border: 1px solid rgba(16, 185, 129, 0.3);
      border-radius: 100px;
      font-size: 0.875rem;
      font-weight: 600;
      color: var(--success);
      margin-bottom: 1.5rem;
    }

    .verdict-consensus.split {
      background: rgba(245, 158, 11, 0.15);
      border-color: rgba(245, 158, 11, 0.3);
      color: var(--warning);
    }

    .verdict-summary {
      font-size: 1.25rem;
      font-weight: 500;
      line-height: 1.6;
      color: var(--text-primary);
      max-width: 600px;
      margin: 0 auto 2rem;
    }

    /* Confidence Gauge */
    .confidence-gauge {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 1.5rem;
      padding: 1.5rem;
      background: var(--bg-card);
      border-radius: var(--radius-lg);
      margin-bottom: 2rem;
    }

    .gauge-visual {
      position: relative;
      width: 100px;
      height: 100px;
    }

    .gauge-circle {
      width: 100%;
      height: 100%;
      border-radius: 50%;
      background: conic-gradient(
        var(--accent-primary) calc(var(--confidence, 80) * 1%),
        rgba(255, 255, 255, 0.1) 0
      );
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .gauge-inner {
      width: 70px;
      height: 70px;
      background: var(--bg-secondary);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.5rem;
      font-weight: 700;
      color: var(--text-primary);
    }

    .gauge-info {
      text-align: left;
    }

    .gauge-title {
      font-size: 1rem;
      font-weight: 600;
      color: var(--text-primary);
      margin-bottom: 0.25rem;
    }

    .gauge-subtitle {
      font-size: 0.875rem;
      color: var(--text-tertiary);
    }

    /* AI Agreement Section */
    .ai-agreement {
      padding: 1.5rem;
      background: var(--bg-secondary);
      border: 1px solid var(--border-color);
      border-radius: var(--radius-lg);
      margin-bottom: 2rem;
    }

    .ai-agreement-header {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      margin-bottom: 1rem;
    }

    .ai-avatars {
      display: flex;
    }

    .ai-avatar {
      width: 32px;
      height: 32px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.625rem;
      font-weight: 700;
      color: white;
      border: 2px solid var(--bg-secondary);
      margin-left: -8px;
    }

    .ai-avatar:first-child { margin-left: 0; }
    .ai-avatar.gpt { background: var(--gpt-color); }
    .ai-avatar.gemini { background: var(--gemini-color); }
    .ai-avatar.grok { background: var(--grok-color); }
    .ai-avatar.claude { background: var(--claude-color); }

    .ai-agreement-title {
      font-size: 1rem;
      font-weight: 600;
      color: var(--text-primary);
    }

    .key-insights {
      display: grid;
      gap: 0.75rem;
    }

    .key-insight {
      display: flex;
      align-items: flex-start;
      gap: 0.75rem;
      padding: 0.75rem;
      background: var(--bg-card);
      border-radius: var(--radius-md);
    }

    .key-insight-icon {
      width: 20px;
      height: 20px;
      border-radius: 50%;
      background: var(--accent-gradient);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.625rem;
      color: white;
      flex-shrink: 0;
      margin-top: 2px;
    }

    .key-insight-text {
      font-size: 0.875rem;
      color: var(--text-secondary);
      line-height: 1.5;
    }

    /* Pro Teaser */
    .pro-teaser {
      padding: 1.5rem;
      background: linear-gradient(135deg, rgba(99, 102, 241, 0.08) 0%, rgba(168, 85, 247, 0.08) 100%);
      border: 1px dashed rgba(99, 102, 241, 0.3);
      border-radius: var(--radius-lg);
      text-align: center;
      margin-bottom: 2rem;
    }

    .pro-teaser-badge {
      display: inline-flex;
      align-items: center;
      gap: 0.375rem;
      padding: 0.25rem 0.75rem;
      background: var(--accent-gradient);
      border-radius: 100px;
      font-size: 0.6875rem;
      font-weight: 700;
      color: white;
      text-transform: uppercase;
      letter-spacing: 1px;
      margin-bottom: 0.75rem;
    }

    .pro-teaser-title {
      font-size: 1rem;
      font-weight: 600;
      color: var(--text-primary);
      margin-bottom: 0.5rem;
    }

    .pro-teaser-features {
      display: flex;
      justify-content: center;
      gap: 1.5rem;
      margin-bottom: 1rem;
      flex-wrap: wrap;
    }

    .pro-feature {
      display: flex;
      align-items: center;
      gap: 0.375rem;
      font-size: 0.8125rem;
      color: var(--text-secondary);
    }

    .pro-feature-icon {
      color: var(--accent-primary);
    }

    /* Site Footer */
    .site-footer {
      background: var(--bg-secondary);
      border-top: 1px solid rgba(255, 255, 255, 0.08);
      padding: 2rem 0;
      margin-top: 4rem;
    }

    .footer-content {
      max-width: 1200px;
      margin: 0 auto;
      padding: 0 2rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
      gap: 1rem;
    }

    .footer-brand {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      font-weight: 600;
      color: var(--text-primary);
    }

    .footer-brand-icon {
      width: 24px;
      height: 24px;
      background: var(--accent-gradient);
      border-radius: 6px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.75rem;
    }

    .footer-links {
      display: flex;
      gap: 1.5rem;
      flex-wrap: wrap;
    }

    .footer-links a {
      color: var(--text-secondary);
      text-decoration: none;
      font-size: 0.875rem;
      transition: color 0.2s;
    }

    .footer-links a:hover {
      color: var(--accent-primary);
    }

    .footer-copyright {
      color: var(--text-tertiary);
      font-size: 0.75rem;
    }

    .footer-disclaimer {
      width: 100%;
      margin-top: 1rem;
      padding-top: 1rem;
      border-top: 1px solid rgba(255, 255, 255, 0.05);
      font-size: 0.75rem;
      color: var(--text-tertiary);
      text-align: center;
      line-height: 1.5;
    }

    .result-badge, .result-recommendation, .result-meta {
      display: none;
    }

    .result-actions {
      display: flex;
      justify-content: center;
      gap: 1rem;
      margin-top: 2rem;
      flex-wrap: wrap;
    }

    /* Action Plan Section */
    .action-plan {
      margin-top: 2rem;
      padding: 2rem;
      background: var(--bg-secondary);
      border: 1px solid var(--border-color);
      border-radius: var(--radius-lg);
      display: none;
    }

    .action-plan.active {
      display: block;
      animation: fadeIn 0.4s ease;
    }

    .action-plan-header {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      margin-bottom: 1.5rem;
    }

    .action-plan-icon {
      width: 40px;
      height: 40px;
      background: var(--accent-gradient);
      border-radius: var(--radius-sm);
      display: flex;
      padding: 8px;
    }

    .action-plan-icon svg {
      width: 100%;
      height: 100%;
      stroke: white;
      stroke-width: 1.5;
      fill: none;
    }

    .action-plan-title {
      font-size: 1.25rem;
      font-weight: 700;
    }

    .action-plan-subtitle {
      font-size: 0.875rem;
      color: var(--text-tertiary);
    }

    .executive-summary {
      padding: 1.25rem;
      background: var(--bg-card);
      border: 1px solid var(--border-color);
      border-radius: var(--radius-md);
      margin-bottom: 1.5rem;
      font-size: 1rem;
      line-height: 1.7;
      color: var(--text-secondary);
    }

    .action-plan-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 1.25rem;
    }

    @media (max-width: 768px) {
      .action-plan-grid {
        grid-template-columns: 1fr;
      }
    }

    .action-section {
      padding: 1.25rem;
      background: var(--bg-card);
      border: 1px solid var(--border-color);
      border-radius: var(--radius-md);
    }

    .action-section-header {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      margin-bottom: 1rem;
    }

    .action-section-icon {
      width: 16px;
      height: 16px;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      flex-shrink: 0;
    }

    .action-section-icon svg {
      width: 100%;
      height: 100%;
      stroke: currentColor;
      stroke-width: 1.5;
      fill: none;
    }

    .action-section-title {
      font-size: 0.875rem;
      font-weight: 600;
      color: var(--text-primary);
    }

    .action-list {
      list-style: none;
      padding: 0;
      margin: 0;
    }

    .action-list li {
      display: flex;
      align-items: flex-start;
      gap: 0.75rem;
      padding: 0.5rem 0;
      font-size: 0.875rem;
      color: var(--text-secondary);
      line-height: 1.5;
    }

    .action-list li::before {
      content: '';
      width: 6px;
      height: 6px;
      border-radius: 50%;
      background: var(--accent-primary);
      margin-top: 0.5rem;
      flex-shrink: 0;
    }

    .action-section.immediate .action-list li::before {
      background: var(--success);
    }

    .action-section.risks .action-list li::before {
      background: var(--warning);
    }

    .action-section.before .action-list li::before {
      background: var(--info);
    }

    .action-section.success .action-list li::before {
      background: var(--accent-secondary);
    }

    .timeline-box {
      grid-column: 1 / -1;
      padding: 1.25rem;
      background: linear-gradient(135deg, rgba(99, 102, 241, 0.1) 0%, rgba(139, 92, 246, 0.1) 100%);
      border: 1px solid rgba(99, 102, 241, 0.2);
      border-radius: var(--radius-md);
    }

    .timeline-box .action-section-title {
      color: var(--accent-primary);
    }

    .timeline-text {
      font-size: 0.875rem;
      color: var(--text-secondary);
      line-height: 1.6;
    }

    .dissent-box {
      grid-column: 1 / -1;
      padding: 1.25rem;
      background: rgba(245, 158, 11, 0.05);
      border: 1px solid rgba(245, 158, 11, 0.2);
      border-radius: var(--radius-md);
    }

    .dissent-box .action-section-title {
      color: var(--warning);
    }

    .dissent-text {
      font-size: 0.875rem;
      color: var(--text-secondary);
      line-height: 1.6;
    }

    /* Follow-up Section */
    .followup-section {
      margin-top: 2rem;
      padding: 1.5rem;
      background: var(--bg-secondary);
      border: 1px solid var(--border-color);
      border-radius: var(--radius-lg);
      display: none;
    }

    .followup-section.active {
      display: block;
    }

    .followup-title {
      font-size: 1rem;
      font-weight: 600;
      margin-bottom: 1rem;
    }

    .followup-input-row {
      display: flex;
      gap: 0.75rem;
    }

    .followup-input {
      flex: 1;
    }

    /* History Panel */
    .history-panel {
      margin-top: 3rem;
    }

    .history-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 1.5rem;
    }

    .history-title {
      font-size: 1.25rem;
      font-weight: 600;
    }

    .history-grid {
      display: grid;
      gap: 1rem;
    }

    .history-card {
      display: flex;
      gap: 1.25rem;
      padding: 1.25rem;
      background: var(--bg-card);
      border: 1px solid var(--border-color);
      border-radius: var(--radius-lg);
      cursor: pointer;
      transition: var(--transition-fast);
    }

    .history-card:hover {
      border-color: var(--border-light);
      background: var(--bg-card-hover);
    }

    .history-date {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      min-width: 60px;
      padding: 0.75rem;
      background: var(--bg-tertiary);
      border-radius: var(--radius-md);
    }

    .history-day {
      font-size: 1.25rem;
      font-weight: 700;
      line-height: 1;
    }

    .history-month {
      font-size: 0.6875rem;
      color: var(--text-tertiary);
      text-transform: uppercase;
    }

    .history-content {
      flex: 1;
      min-width: 0;
    }

    .history-question {
      font-weight: 500;
      margin-bottom: 0.5rem;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .history-answer {
      font-size: 0.875rem;
      color: var(--text-secondary);
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .history-meta {
      display: flex;
      align-items: center;
      gap: 1rem;
      margin-top: 0.5rem;
    }

    .history-tag {
      display: inline-flex;
      align-items: center;
      gap: 0.375rem;
      font-size: 0.75rem;
      padding: 0.25rem 0.625rem;
      border-radius: 100px;
    }

    .history-tag.consensus {
      background: var(--success-bg);
      color: var(--success);
    }

    .history-tag.split {
      background: var(--warning-bg);
      color: var(--warning);
    }

    .history-tag.cost {
      background: var(--bg-tertiary);
      color: var(--text-tertiary);
    }

    /* History Detail Modal */
    .modal-overlay {
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.7);
      backdrop-filter: blur(8px);
      z-index: 100;
      display: none;
      align-items: center;
      justify-content: center;
      padding: 2rem;
    }

    .modal-overlay.active {
      display: flex;
    }

    .modal {
      background: var(--bg-secondary);
      border: 1px solid var(--border-color);
      border-radius: var(--radius-xl);
      max-width: 800px;
      width: 100%;
      max-height: 80vh;
      overflow-y: auto;
    }

    .modal-header {
      padding: 1.5rem;
      border-bottom: 1px solid var(--border-color);
      display: flex;
      align-items: center;
      justify-content: space-between;
      position: sticky;
      top: 0;
      background: var(--bg-secondary);
    }

    .modal-title {
      font-size: 1.125rem;
      font-weight: 600;
    }

    .modal-close {
      width: 32px;
      height: 32px;
      display: flex;
      align-items: center;
      justify-content: center;
      background: var(--bg-tertiary);
      border: none;
      border-radius: var(--radius-sm);
      color: var(--text-secondary);
      cursor: pointer;
      transition: var(--transition-fast);
    }

    .modal-close:hover {
      background: var(--bg-card-hover);
      color: var(--text-primary);
    }

    .modal-body {
      padding: 1.5rem;
    }

    .modal-section {
      margin-bottom: 1.5rem;
    }

    .modal-section-title {
      font-size: 0.75rem;
      font-weight: 600;
      color: var(--text-tertiary);
      text-transform: uppercase;
      letter-spacing: 0.05em;
      margin-bottom: 0.75rem;
    }

    .modal-question {
      font-size: 1.125rem;
      font-weight: 500;
      margin-bottom: 0.5rem;
    }

    .modal-context {
      font-size: 0.9375rem;
      color: var(--text-secondary);
    }

    .modal-round {
      padding: 1rem;
      background: var(--bg-tertiary);
      border-radius: var(--radius-md);
      margin-bottom: 0.75rem;
    }

    .modal-round-header {
      font-weight: 600;
      margin-bottom: 0.75rem;
      font-size: 0.875rem;
    }

    .modal-position {
      display: flex;
      gap: 0.75rem;
      margin-bottom: 0.5rem;
      font-size: 0.875rem;
    }

    .modal-position-llm {
      font-weight: 500;
      min-width: 80px;
    }

    /* Limit Reached Modal */
    .limit-modal {
      max-width: 450px;
      text-align: center;
    }

    .limit-modal-content {
      padding: 2rem;
    }

    .limit-modal-icon {
      font-size: 4rem;
      margin-bottom: 1rem;
    }

    .limit-modal-title {
      font-size: 1.5rem;
      font-weight: 700;
      margin-bottom: 0.5rem;
    }

    .limit-modal-subtitle {
      color: var(--text-secondary);
      font-size: 1rem;
      margin-bottom: 1.5rem;
    }

    .limit-modal-info {
      background: var(--bg-tertiary);
      border-radius: var(--radius-md);
      padding: 1rem;
      margin-bottom: 1.5rem;
    }

    .limit-modal-reset {
      font-size: 0.875rem;
      color: var(--text-secondary);
    }

    .limit-modal-reset strong {
      color: var(--text-primary);
    }

    .limit-modal-actions {
      display: flex;
      flex-direction: column;
      gap: 0.75rem;
    }

    .limit-modal-upgrade {
      padding: 0.875rem 1.5rem;
      background: linear-gradient(135deg, var(--accent-primary) 0%, var(--accent-secondary) 100%);
      border: none;
      border-radius: var(--radius-md);
      color: white;
      font-weight: 600;
      font-size: 1rem;
      cursor: pointer;
      transition: var(--transition-normal);
    }

    .limit-modal-upgrade:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(99, 102, 241, 0.3);
    }

    .limit-modal-dismiss {
      background: none;
      border: none;
      color: var(--text-tertiary);
      font-size: 0.875rem;
      cursor: pointer;
      padding: 0.5rem;
    }

    .limit-modal-dismiss:hover {
      color: var(--text-secondary);
    }

    /* Onboarding Modal */
    .onboarding-modal {
      max-width: 650px;
    }

    .onboarding-hero {
      text-align: center;
      padding: 2rem 1.5rem;
      background: linear-gradient(135deg, rgba(99, 102, 241, 0.1) 0%, rgba(139, 92, 246, 0.1) 100%);
      border-bottom: 1px solid var(--border-color);
    }

    .onboarding-hero-icon {
      font-size: 3rem;
      margin-bottom: 1rem;
    }

    .onboarding-hero-title {
      font-size: 1.5rem;
      font-weight: 700;
      margin-bottom: 0.5rem;
    }

    .onboarding-hero-subtitle {
      color: var(--text-secondary);
      font-size: 1rem;
    }

    .onboarding-steps {
      padding: 1.5rem;
    }

    .onboarding-step {
      display: flex;
      gap: 1rem;
      margin-bottom: 1.25rem;
      padding: 1rem;
      background: var(--bg-tertiary);
      border-radius: var(--radius-md);
      transition: var(--transition-fast);
    }

    .onboarding-step:hover {
      background: var(--bg-card-hover);
    }

    .onboarding-step-number {
      width: 32px;
      height: 32px;
      background: linear-gradient(135deg, var(--accent-primary) 0%, var(--accent-secondary) 100%);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 700;
      font-size: 0.875rem;
      flex-shrink: 0;
    }

    .onboarding-step-content h4 {
      font-size: 1rem;
      font-weight: 600;
      margin-bottom: 0.25rem;
    }

    .onboarding-step-content p {
      font-size: 0.875rem;
      color: var(--text-secondary);
      line-height: 1.5;
    }

    .onboarding-features {
      padding: 1.5rem;
      border-top: 1px solid var(--border-color);
    }

    .onboarding-features-title {
      font-size: 0.75rem;
      font-weight: 600;
      color: var(--text-tertiary);
      text-transform: uppercase;
      letter-spacing: 0.05em;
      margin-bottom: 1rem;
    }

    .onboarding-feature {
      display: flex;
      align-items: flex-start;
      gap: 0.75rem;
      margin-bottom: 1rem;
      padding: 0.75rem;
      background: var(--bg-tertiary);
      border-radius: var(--radius-sm);
    }

    .onboarding-feature-icon {
      width: 20px;
      height: 20px;
      flex-shrink: 0;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .onboarding-feature-icon svg {
      width: 100%;
      height: 100%;
      stroke: var(--accent-primary);
      stroke-width: 1.5;
      fill: none;
    }

    .onboarding-feature-content {
      flex: 1;
    }

    .onboarding-feature-content strong {
      display: block;
      font-size: 0.875rem;
      margin-bottom: 0.25rem;
    }

    .onboarding-feature-content span {
      font-size: 0.8125rem;
      color: var(--text-secondary);
    }

    .onboarding-footer {
      padding: 1rem 1.5rem;
      border-top: 1px solid var(--border-color);
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 1rem;
    }

    .onboarding-skip {
      background: none;
      border: none;
      color: var(--text-tertiary);
      font-size: 0.875rem;
      cursor: pointer;
      transition: var(--transition-fast);
    }

    .onboarding-skip:hover {
      color: var(--text-secondary);
    }

    .onboarding-start {
      padding: 0.75rem 2rem;
      background: linear-gradient(135deg, var(--accent-primary) 0%, var(--accent-secondary) 100%);
      border: none;
      border-radius: var(--radius-md);
      color: white;
      font-weight: 600;
      font-size: 1rem;
      cursor: pointer;
      transition: var(--transition-normal);
    }

    .onboarding-start:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(99, 102, 241, 0.3);
    }

    /* How It Works Section */
    .how-it-works {
      background: var(--bg-tertiary);
      border: 1px solid var(--border-color);
      border-radius: var(--radius-lg);
      margin-bottom: 1.5rem;
      overflow: hidden;
    }

    .how-it-works-toggle {
      width: 100%;
      padding: 1rem 1.25rem;
      background: none;
      border: none;
      display: flex;
      align-items: center;
      justify-content: space-between;
      cursor: pointer;
      color: var(--text-primary);
      font-size: 0.9375rem;
      font-weight: 500;
      transition: var(--transition-fast);
    }

    .how-it-works-toggle:hover {
      background: var(--bg-card-hover);
    }

    .how-it-works-toggle-left {
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .how-it-works-toggle svg {
      transition: transform 0.3s ease;
    }

    .how-it-works.expanded .how-it-works-toggle svg:last-child {
      transform: rotate(180deg);
    }

    .how-it-works-content {
      max-height: 0;
      overflow: hidden;
      transition: max-height 0.3s ease;
    }

    .how-it-works.expanded .how-it-works-content {
      max-height: 500px;
    }

    .how-it-works-inner {
      padding: 0 1.25rem 1.25rem;
    }

    .how-it-works-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 1rem;
    }

    .how-it-works-item {
      text-align: center;
      padding: 1rem 0.75rem;
    }

    .how-it-works-item-icon {
      font-size: 1.5rem;
      margin-bottom: 0.5rem;
    }

    .how-it-works-item-title {
      font-size: 0.875rem;
      font-weight: 600;
      margin-bottom: 0.25rem;
    }

    .how-it-works-item-desc {
      font-size: 0.75rem;
      color: var(--text-secondary);
      line-height: 1.4;
    }

    /* Improved Options */
    .options-section {
      background: var(--bg-tertiary);
      border: 1px solid var(--border-color);
      border-radius: var(--radius-lg);
      padding: 1rem;
      margin-bottom: 1rem;
    }

    .options-section-title {
      font-size: 0.75rem;
      font-weight: 600;
      color: var(--text-tertiary);
      text-transform: uppercase;
      letter-spacing: 0.05em;
      margin-bottom: 0.75rem;
    }

    .option-card {
      background: var(--bg-card);
      border: 1px solid var(--border-color);
      border-radius: var(--radius-md);
      padding: 0.875rem;
      margin-bottom: 0.625rem;
      cursor: pointer;
      transition: var(--transition-fast);
      display: flex;
      align-items: flex-start;
      gap: 0.75rem;
    }

    .option-card:last-child {
      margin-bottom: 0;
    }

    .option-card:hover {
      border-color: var(--border-light);
      background: var(--bg-card-hover);
    }

    .option-card.active {
      border-color: var(--accent-primary);
      background: rgba(99, 102, 241, 0.1);
    }

    .option-card-toggle {
      width: 20px;
      height: 20px;
      border: 2px solid var(--border-light);
      border-radius: 4px;
      flex-shrink: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: var(--transition-fast);
      margin-top: 2px;
    }

    .option-card.active .option-card-toggle {
      background: var(--accent-primary);
      border-color: var(--accent-primary);
    }

    .option-card-toggle svg {
      opacity: 0;
      color: white;
      transition: opacity 0.15s ease;
    }

    .option-card.active .option-card-toggle svg {
      opacity: 1;
    }

    .option-card-content {
      flex: 1;
    }

    .option-card-header {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      margin-bottom: 0.25rem;
    }

    .option-card-icon {
      width: 20px;
      height: 20px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .option-card-icon svg {
      width: 100%;
      height: 100%;
      stroke: var(--accent-primary);
      stroke-width: 1.5;
      fill: none;
    }

    .option-card-title {
      font-size: 0.9375rem;
      font-weight: 600;
    }

    .option-card-desc {
      font-size: 0.8125rem;
      color: var(--text-secondary);
      line-height: 1.4;
    }

    @media (max-width: 600px) {
      .how-it-works-grid {
        grid-template-columns: 1fr;
        gap: 0.5rem;
      }

      .how-it-works-item {
        display: flex;
        align-items: center;
        gap: 0.75rem;
        text-align: left;
        padding: 0.75rem;
        background: var(--bg-card);
        border-radius: var(--radius-sm);
      }

      .how-it-works-item-icon {
        margin-bottom: 0;
      }
    }

    /* Pricing Section */
    .pricing-section {
      padding: 4rem 0;
    }

    .pricing-header {
      text-align: center;
      margin-bottom: 3rem;
    }

    .pricing-title {
      font-size: 2rem;
      font-weight: 700;
      margin-bottom: 0.75rem;
    }

    .pricing-subtitle {
      color: var(--text-secondary);
      font-size: 1.125rem;
    }

    .pricing-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 1.5rem;
      max-width: 1000px;
      margin: 0 auto;
    }

    .pricing-card {
      background: var(--bg-card);
      border: 1px solid var(--border-color);
      border-radius: var(--radius-xl);
      padding: 2rem;
      position: relative;
      transition: var(--transition-normal);
    }

    .pricing-card:hover {
      border-color: var(--border-light);
      transform: translateY(-4px);
    }

    .pricing-card.featured {
      border-color: var(--accent-primary);
      background: linear-gradient(135deg, rgba(99, 102, 241, 0.05) 0%, rgba(139, 92, 246, 0.05) 100%);
    }

    .pricing-card.featured::before {
      content: 'Most Popular';
      position: absolute;
      top: -12px;
      left: 50%;
      transform: translateX(-50%);
      background: var(--accent-gradient);
      color: white;
      font-size: 0.75rem;
      font-weight: 600;
      padding: 0.375rem 1rem;
      border-radius: 100px;
    }

    .pricing-plan {
      font-size: 1.25rem;
      font-weight: 700;
      margin-bottom: 0.5rem;
    }

    .pricing-desc {
      font-size: 0.875rem;
      color: var(--text-secondary);
      margin-bottom: 1.5rem;
    }

    .pricing-price {
      margin-bottom: 1.5rem;
    }

    .pricing-amount {
      font-size: 3rem;
      font-weight: 800;
      line-height: 1;
    }

    .pricing-period {
      font-size: 0.875rem;
      color: var(--text-tertiary);
    }

    .pricing-features {
      list-style: none;
      margin-bottom: 2rem;
    }

    .pricing-feature {
      display: flex;
      align-items: flex-start;
      gap: 0.75rem;
      font-size: 0.875rem;
      color: var(--text-secondary);
      margin-bottom: 0.75rem;
    }

    .pricing-feature-icon {
      color: var(--success);
      font-weight: bold;
      flex-shrink: 0;
    }

    /* Loading Overlay */
    .loading-overlay {
      position: fixed;
      inset: 0;
      background: rgba(9, 9, 11, 0.85);
      backdrop-filter: blur(12px);
      z-index: 100;
      display: none;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: 1.5rem;
    }

    .loading-overlay.active {
      display: flex;
    }

    .loading-spinner-large {
      width: 56px;
      height: 56px;
      border: 3px solid var(--border-color);
      border-top-color: var(--accent-primary);
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }

    .loading-text {
      font-size: 1rem;
      color: var(--text-secondary);
    }

    .loading-substatus {
      font-size: 0.875rem;
      color: var(--text-tertiary);
    }

    /* Toast */
    .toast {
      position: fixed;
      bottom: 2rem;
      right: 2rem;
      padding: 1rem 1.5rem;
      background: var(--bg-secondary);
      border: 1px solid var(--border-color);
      border-radius: var(--radius-md);
      box-shadow: var(--shadow-lg);
      transform: translateY(100px);
      opacity: 0;
      transition: var(--transition-normal);
      z-index: 200;
      display: flex;
      align-items: center;
      gap: 0.75rem;
    }

    .toast.show {
      transform: translateY(0);
      opacity: 1;
    }

    .toast.success { border-color: var(--success); }
    .toast.error { border-color: var(--error); }

    .toast-icon {
      width: 20px;
      height: 20px;
    }

    /* Tier Toggle */
    .tier-selector {
      display: flex;
      align-items: center;
      gap: 1rem;
      padding: 1rem 1.25rem;
      background: var(--bg-secondary);
      border: 1px solid var(--border-color);
      border-radius: var(--radius-lg);
      margin-bottom: 1.5rem;
    }

    .tier-label {
      font-size: 0.875rem;
      font-weight: 600;
      color: var(--text-primary);
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .tier-toggle-track {
      display: flex;
      background: var(--bg-tertiary);
      border-radius: var(--radius-md);
      padding: 0.25rem;
      gap: 0.25rem;
    }

    .tier-btn {
      padding: 0.5rem 1rem;
      font-size: 0.8125rem;
      font-weight: 500;
      color: var(--text-tertiary);
      background: transparent;
      border: none;
      border-radius: var(--radius-sm);
      cursor: pointer;
      transition: var(--transition-fast);
      display: flex;
      align-items: center;
      gap: 0.375rem;
    }

    .tier-btn:hover {
      color: var(--text-secondary);
    }

    .tier-btn.active {
      background: var(--accent-gradient);
      color: white;
      box-shadow: var(--shadow-sm);
    }

    .tier-btn.active.budget {
      background: linear-gradient(135deg, #10b981 0%, #059669 100%);
    }

    .tier-btn.active.premium {
      background: var(--accent-gradient);
    }

    .tier-models {
      flex: 1;
      display: flex;
      justify-content: flex-end;
      gap: 0.5rem;
      flex-wrap: wrap;
    }

    .tier-model-tag {
      padding: 0.25rem 0.625rem;
      font-size: 0.6875rem;
      font-family: 'JetBrains Mono', monospace;
      background: var(--bg-tertiary);
      border-radius: 100px;
      color: var(--text-tertiary);
    }

    .tier-model-tag.gpt { border-left: 2px solid var(--gpt-color); }
    .tier-model-tag.gemini { border-left: 2px solid var(--gemini-color); }
    .tier-model-tag.grok { border-left: 2px solid var(--grok-color); }
    .tier-model-tag.claude { border-left: 2px solid var(--claude-color); }

    /* Empty State */
    .empty-state {
      text-align: center;
      padding: 3rem;
      color: var(--text-tertiary);
    }

    .empty-icon {
      width: 48px;
      height: 48px;
      margin-bottom: 1rem;
      opacity: 0.5;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .empty-icon svg {
      width: 100%;
      height: 100%;
      stroke: var(--text-tertiary);
      stroke-width: 1.5;
      fill: none;
    }

    .section-icon {
      width: 18px;
      height: 18px;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      vertical-align: middle;
    }

    .section-icon svg {
      width: 100%;
      height: 100%;
      stroke: currentColor;
      stroke-width: 1.5;
      fill: none;
    }

    /* Responsive */
    @media (max-width: 768px) {
      .app { padding: 5rem 1rem 2rem; }
      .nav-links { display: none; }
      .main-card { padding: 1.5rem; }
      .hero-title { font-size: 2rem; }
      .hero-stats { gap: 1.5rem; }
      .llm-grid { grid-template-columns: 1fr; }
      .templates-grid { grid-template-columns: repeat(2, 1fr); }
      .result-meta { gap: 1.5rem; }
      .pricing-grid { grid-template-columns: 1fr; }
    }
  </style>
</head>
<body>
  <div class="bg-effects">
    <div class="bg-gradient-orb orb-1"></div>
    <div class="bg-gradient-orb orb-2"></div>
    <div class="bg-gradient-orb orb-3"></div>
    <div class="grid-overlay"></div>
  </div>

  <nav>
    <div class="nav-inner">
      <a href="#" class="nav-logo">
        <div class="nav-logo-icon">C</div>
        <span class="nav-logo-text">ConsensusAI</span>
      </a>
      <div class="nav-links">
        <a href="#debate" class="nav-link active" data-tab="debate">Debate</a>
        <a href="#history" class="nav-link" data-tab="history">History</a>
        <a href="#pricing" class="nav-link" data-tab="pricing">Pricing</a>
        <a href="#" class="nav-link" onclick="showOnboarding(); return false;" title="How to use">Help</a>
      </div>

      <!-- Auth UI -->
      <div class="nav-auth" id="navAuth">
        <!-- Loading state -->
        <div class="auth-loading" id="authLoading">
          <div class="auth-loading-spinner"></div>
        </div>

        <!-- Signed out state -->
        <div id="authSignedOut" style="display: none;">
          <button class="auth-btn auth-btn-signin" onclick="handleSignIn()">Sign In</button>
          <button class="auth-btn auth-btn-signup" onclick="handleSignUp()">Sign Up Free</button>
        </div>

        <!-- Signed in state -->
        <div id="authSignedIn" style="display: none; position: relative;">
          <div class="user-menu" id="userMenu" onclick="toggleUserMenu()">
            <div class="user-avatar" id="userAvatar">
              <!-- Will be populated by JS -->
            </div>
            <span class="user-name" id="userName">User</span>
            <span class="user-tier user-tier-free" id="userTier">FREE</span>

            <div class="user-dropdown">
              <div class="user-dropdown-item" onclick="handleManageAccount()">
                <span>Account Settings</span>
              </div>
              <div class="user-dropdown-divider"></div>
              <div class="user-dropdown-item" onclick="handleSignOut()">
                <span>Sign Out</span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </nav>

  <div class="app">
    <!-- Hero -->
    <header class="hero">
      <div class="hero-badge">
        <span class="hero-badge-dot"></span>
        <span>3 AI Models Active</span>
      </div>
      <h1 class="hero-title">
        Make Better Decisions with<br>
        <span class="hero-title-gradient">ConsensusAI</span>
      </h1>
      <p class="hero-subtitle">
        Unlike side-by-side comparisons, our AIs <strong>debate each other</strong>.
        They read, critique, and refine their positions until reaching consensus.
      </p>
      <div class="usage-indicator" id="usageIndicator" style="display: none;">
        <span class="usage-text">Free tier: <span id="usageRemaining">3</span>/3 debates remaining today</span>
        <a href="#" class="upgrade-link" onclick="showUpgradeModal()">Upgrade to Pro</a>
      </div>
      <div class="hero-stats" id="heroStats">
        <div class="hero-stat">
          <div class="hero-stat-value" id="statDecisions">0</div>
          <div class="hero-stat-label">Decisions Made</div>
        </div>
        <div class="hero-stat">
          <div class="hero-stat-value" id="statConsensus">0%</div>
          <div class="hero-stat-label">Consensus Rate</div>
        </div>
        <div class="hero-stat">
          <div class="hero-stat-value" id="statCost">$0.00</div>
          <div class="hero-stat-label">Avg Cost</div>
        </div>
      </div>
    </header>

    <!-- Main Panel -->
    <div class="panel active" id="debatePanel">
      <div class="main-card">
        <form id="debateForm">
          <!-- How It Works Section -->
          <div class="how-it-works" id="howItWorks">
            <button type="button" class="how-it-works-toggle" onclick="toggleHowItWorks()">
              <span class="how-it-works-toggle-left">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <circle cx="12" cy="12" r="10"></circle>
                  <path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"></path>
                  <line x1="12" y1="17" x2="12.01" y2="17"></line>
                </svg>
                How It Works - First time? Click to learn
              </span>
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <polyline points="6 9 12 15 18 9"></polyline>
              </svg>
            </button>
            <div class="how-it-works-content">
              <div class="how-it-works-inner">
                <div class="how-it-works-grid">
                  <div class="how-it-works-item">
                    <div class="how-it-works-item-icon">1. Ask</div>
                    <div class="how-it-works-item-title">Submit Your Question</div>
                    <div class="how-it-works-item-desc">Enter any decision or dilemma you're facing</div>
                  </div>
                  <div class="how-it-works-item">
                    <div class="how-it-works-item-icon">2. Debate</div>
                    <div class="how-it-works-item-title">AIs Discuss & Challenge</div>
                    <div class="how-it-works-item-desc">4 AIs debate in 3 rounds, reading & responding to each other</div>
                  </div>
                  <div class="how-it-works-item">
                    <div class="how-it-works-item-icon">3. Decide</div>
                    <div class="how-it-works-item-title">Get Consensus Answer</div>
                    <div class="how-it-works-item-desc">See the final recommendation with confidence scores</div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Tier Selector -->
          <div class="tier-selector has-tooltip" id="tierSelector">
            <div class="tier-label">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M12 2L2 7l10 5 10-5-10-5z"></path>
                <path d="M2 17l10 5 10-5"></path>
                <path d="M2 12l10 5 10-5"></path>
              </svg>
              Model Tier
              <span class="help-icon">?</span>
            </div>
            <div class="tooltip" style="left: 120px;">
              <div class="tooltip-title">Model Tier Selection</div>
              <strong>Budget:</strong> Faster, cheaper models ideal for testing and exploration.<br><br>
              <strong>Premium:</strong> Most advanced models with best reasoning capabilities for important decisions.
            </div>
            <div class="tier-toggle-track">
              <button type="button" class="tier-btn budget active" data-tier="budget">
                <span>$</span> Budget
              </button>
              <button type="button" class="tier-btn premium" data-tier="premium">
                <span>$$</span> Premium
              </button>
            </div>
            <div class="tier-models" id="tierModels">
              <!-- Populated by JS -->
            </div>
          </div>

          <!-- Templates -->
          <div class="form-section">
            <label class="form-label">Quick Templates</label>
            <div class="templates-grid">
              <button type="button" class="template-btn" data-template="investment">
                <span class="template-icon">
                  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                    <polyline points="22 7 13.5 15.5 8.5 10.5 2 17"></polyline>
                    <polyline points="16 7 22 7 22 13"></polyline>
                  </svg>
                </span>
                <span class="template-name">Investment</span>
              </button>
              <button type="button" class="template-btn" data-template="career">
                <span class="template-icon">
                  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                    <rect x="2" y="7" width="20" height="14" rx="2" ry="2"></rect>
                    <path d="M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16"></path>
                  </svg>
                </span>
                <span class="template-name">Career</span>
              </button>
              <button type="button" class="template-btn" data-template="tech">
                <span class="template-icon">
                  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                    <polyline points="16 18 22 12 16 6"></polyline>
                    <polyline points="8 6 2 12 8 18"></polyline>
                  </svg>
                </span>
                <span class="template-name">Tech Stack</span>
              </button>
              <button type="button" class="template-btn" data-template="purchase">
                <span class="template-icon">
                  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                    <circle cx="9" cy="21" r="1"></circle>
                    <circle cx="20" cy="21" r="1"></circle>
                    <path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"></path>
                  </svg>
                </span>
                <span class="template-name">Purchase</span>
              </button>
              <button type="button" class="template-btn" data-template="strategy">
                <span class="template-icon">
                  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                    <circle cx="12" cy="12" r="10"></circle>
                    <circle cx="12" cy="12" r="6"></circle>
                    <circle cx="12" cy="12" r="2"></circle>
                  </svg>
                </span>
                <span class="template-name">Strategy</span>
              </button>
              <button type="button" class="template-btn" data-template="custom">
                <span class="template-icon">
                  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                    <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon>
                  </svg>
                </span>
                <span class="template-name">Custom</span>
              </button>
            </div>
          </div>

          <!-- Question Input -->
          <div class="form-section">
            <label class="form-label">Your Decision or Question</label>
            <div class="form-input-wrapper">
              <textarea
                class="form-input"
                id="questionInput"
                placeholder="e.g., Should I invest in Bitcoin now or wait for a dip?"
                maxlength="500"
                required
              ></textarea>
              <span class="char-counter"><span id="questionCount">0</span>/500</span>
            </div>
          </div>

          <!-- Context Input -->
          <div class="form-section">
            <label class="form-label">Context & Constraints <span class="form-label-optional">(Optional)</span></label>
            <div class="form-input-wrapper">
              <textarea
                class="form-input"
                id="contextInput"
                placeholder="e.g., I have $5000 to invest, long-term horizon (5+ years), moderate risk tolerance"
                maxlength="300"
              ></textarea>
              <span class="char-counter"><span id="contextCount">0</span>/300</span>
            </div>
          </div>

          <!-- Debate Options -->
          <div class="options-section">
            <div class="options-section-title">Debate Settings</div>

            <div class="option-card" id="devilsAdvocateCard" data-active="false" onclick="toggleOptionCard('devilsAdvocateCard')">
              <div class="option-card-toggle">
                <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3">
                  <polyline points="20 6 9 17 4 12"></polyline>
                </svg>
              </div>
              <div class="option-card-content">
                <div class="option-card-header">
                  <span class="option-card-icon">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                      <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2z"></path>
                      <path d="M8 14s1.5 2 4 2 4-2 4-2"></path>
                      <line x1="9" y1="9" x2="9.01" y2="9"></line>
                      <line x1="15" y1="9" x2="15.01" y2="9"></line>
                      <path d="M7 4L9 6M17 4L15 6"></path>
                    </svg>
                  </span>
                  <span class="option-card-title">Devil's Advocate Mode</span>
                </div>
                <div class="option-card-desc">
                  One AI will intentionally challenge the majority to stress-test the recommendation.
                  Great for important decisions where you want to uncover hidden risks.
                </div>
              </div>
            </div>

            <div class="option-card active" id="showAlternativesCard" data-active="true" onclick="toggleOptionCard('showAlternativesCard')">
              <div class="option-card-toggle">
                <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3">
                  <polyline points="20 6 9 17 4 12"></polyline>
                </svg>
              </div>
              <div class="option-card-content">
                <div class="option-card-header">
                  <span class="option-card-icon">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                      <line x1="18" y1="20" x2="18" y2="10"></line>
                      <line x1="12" y1="20" x2="12" y2="4"></line>
                      <line x1="6" y1="20" x2="6" y2="14"></line>
                    </svg>
                  </span>
                  <span class="option-card-title">Show All Positions</span>
                </div>
                <div class="option-card-desc">
                  Display every unique viewpoint, even minority opinions. Useful when exploring
                  alternatives or when you want to see the full spectrum of perspectives.
                </div>
              </div>
            </div>
          </div>

          <!-- Submit -->
          <button type="submit" class="btn btn-primary btn-full" id="submitBtn">
            <svg class="btn-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"></polygon>
            </svg>
            Start AI Debate
          </button>
        </form>

        <!-- Debate Progress -->
        <div class="debate-container" id="debateContainer">
          <div class="debate-header">
            <h2 class="debate-title">AI Debate in Progress</h2>
            <div style="display: flex; align-items: center; gap: 1rem;">
              <div class="live-indicator" id="liveIndicator">
                <div class="live-dot"></div>
                LIVE
              </div>
              <div class="round-indicator">
                <div class="round-dots" id="roundDots">
                  <div class="round-dot"></div>
                  <div class="round-dot"></div>
                  <div class="round-dot"></div>
                </div>
                <span class="round-text" id="roundText">Round 1/3</span>
              </div>
            </div>
          </div>

          <!-- Live Activity Feed -->
          <div class="activity-feed" id="activityFeed">
            <div class="activity-feed-header">
              <span class="activity-feed-title">Live Activity</span>
              <span class="activity-feed-live">
                <span class="live-dot"></span>
                LIVE
              </span>
            </div>
            <div class="activity-list" id="activityList">
              <!-- Activity items populated by JS -->
            </div>
          </div>

          <div class="llm-grid" id="llmGrid"></div>

          <!-- Alternatives Panel -->
          <div class="alternatives-panel" id="alternativesPanel">
            <h3 class="alternatives-title">
              <span class="section-icon"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><line x1="18" y1="20" x2="18" y2="10"></line><line x1="12" y1="20" x2="12" y2="4"></line><line x1="6" y1="20" x2="6" y2="14"></line></svg></span> All Positions
            </h3>
            <div class="alternatives-grid" id="alternativesGrid"></div>
          </div>

          <!-- Debate Timeline -->
          <div class="debate-timeline" id="debateTimeline" style="display: none;">
            <h3 class="timeline-title">
              <span class="section-icon"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2"></path><rect x="9" y="3" width="6" height="4" rx="1"></rect><line x1="9" y1="12" x2="15" y2="12"></line><line x1="9" y1="16" x2="15" y2="16"></line></svg></span> How This Decision Was Made
            </h3>
            <div class="timeline-steps" id="timelineSteps">
              <!-- Populated by JS -->
            </div>
          </div>
        </div>

        <!-- Result -->
        <div class="result-card" id="resultCard">
          <!-- Hidden elements for backward compatibility -->
          <div class="result-badge" id="resultBadge" style="display:none;"></div>
          <p class="result-recommendation" id="resultRecommendation" style="display:none;"></p>
          <div id="resultRounds" style="display:none;"></div>
          <div id="resultConfidence" style="display:none;"></div>

          <!-- Hero Decision Section -->
          <div class="hero-decision">
            <div class="hero-decision-content">
              <div class="verdict-label">The Verdict</div>
              <div class="verdict-main">
                <div class="verdict-icon yes" id="verdictIcon">&#x2713;</div>
                <div class="verdict-decision" id="verdictDecision">YES</div>
              </div>
              <div class="verdict-consensus" id="verdictConsensus">
                <span>&#x2713;</span> All 4 AIs Agree
              </div>
              <p class="verdict-summary" id="verdictSummary">Loading recommendation...</p>

              <!-- Confidence Gauge -->
              <div class="confidence-gauge">
                <div class="gauge-visual">
                  <div class="gauge-circle" id="gaugeCircle" style="--confidence: 80;">
                    <div class="gauge-inner" id="gaugeValue">8</div>
                  </div>
                </div>
                <div class="gauge-info">
                  <div class="gauge-title">Confidence Score</div>
                  <div class="gauge-subtitle" id="gaugeSubtitle">High confidence recommendation</div>
                </div>
              </div>
            </div>
          </div>

          <!-- AI Agreement Section -->
          <div class="ai-agreement" id="aiAgreement">
            <div class="ai-agreement-header">
              <div class="ai-avatars" id="aiAvatars">
                <div class="ai-avatar gpt">GPT</div>
                <div class="ai-avatar gemini">GEM</div>
                <div class="ai-avatar grok">GRK</div>
                <div class="ai-avatar claude">CLD</div>
              </div>
              <div class="ai-agreement-title" id="aiAgreementTitle">Key Arguments from All AIs</div>
            </div>
            <div class="key-insights" id="keyInsights">
              <!-- Populated dynamically -->
            </div>
          </div>

          <!-- Pro Teaser -->
          <div class="pro-teaser">
            <div class="pro-teaser-badge">&#x2B50; PRO</div>
            <div class="pro-teaser-title">Unlock Deeper Analysis</div>
            <div class="pro-teaser-features">
              <div class="pro-feature">
                <span class="pro-feature-icon">&#x2713;</span>
                Premium AI Models
              </div>
              <div class="pro-feature">
                <span class="pro-feature-icon">&#x2713;</span>
                Unlimited Debates
              </div>
              <div class="pro-feature">
                <span class="pro-feature-icon">&#x2713;</span>
                Extended Analysis
              </div>
            </div>
            <button class="btn btn-primary" onclick="switchTab('pricing')">Upgrade to Pro</button>
          </div>

          <!-- Actions -->
          <div class="result-actions">
            <button class="btn btn-secondary" onclick="exportPDF()">
              <svg class="btn-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                <polyline points="7 10 12 15 17 10"></polyline>
                <line x1="12" y1="15" x2="12" y2="3"></line>
              </svg>
              Export
            </button>
            <button class="btn btn-secondary" onclick="copyShareLink()">
              <svg class="btn-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="18" cy="5" r="3"></circle>
                <circle cx="6" cy="12" r="3"></circle>
                <circle cx="18" cy="19" r="3"></circle>
                <line x1="8.59" y1="13.51" x2="15.42" y2="17.49"></line>
                <line x1="15.41" y1="6.51" x2="8.59" y2="10.49"></line>
              </svg>
              Share
            </button>
            <button class="btn btn-primary" onclick="askFollowup()">
              Ask Follow-up
            </button>
          </div>
        </div>

        <!-- Action Plan Section -->
        <div class="action-plan" id="actionPlan">
          <div class="action-plan-header">
            <div class="action-plan-icon"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2"></path><rect x="9" y="3" width="6" height="4" rx="1"></rect><path d="M9 12l2 2 4-4"></path></svg></div>
            <div>
              <div class="action-plan-title">Your Action Plan</div>
              <div class="action-plan-subtitle">Synthesized insights from all AI perspectives</div>
            </div>
          </div>

          <div class="executive-summary" id="executiveSummary">
            Loading action plan...
          </div>

          <div class="action-plan-grid">
            <div class="action-section immediate">
              <div class="action-section-header">
                <span class="action-section-icon"><svg viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"></circle><path d="M9 12l2 2 4-4"></path></svg></span>
                <span class="action-section-title">Immediate Actions</span>
              </div>
              <ul class="action-list" id="immediateActions"></ul>
            </div>

            <div class="action-section before">
              <div class="action-section-header">
                <span class="action-section-icon"><svg viewBox="0 0 24 24"><circle cx="11" cy="11" r="8"></circle><path d="M21 21l-4.35-4.35"></path></svg></span>
                <span class="action-section-title">Before Proceeding</span>
              </div>
              <ul class="action-list" id="beforeProceeding"></ul>
            </div>

            <div class="action-section risks">
              <div class="action-section-header">
                <span class="action-section-icon"><svg viewBox="0 0 24 24"><path d="M10.29 3.86L1.82 18a2 2 0 001.71 3h16.94a2 2 0 001.71-3L13.71 3.86a2 2 0 00-3.42 0z"></path><line x1="12" y1="9" x2="12" y2="13"></line><line x1="12" y1="17" x2="12.01" y2="17"></line></svg></span>
                <span class="action-section-title">Risk Mitigation</span>
              </div>
              <ul class="action-list" id="riskMitigation"></ul>
            </div>

            <div class="action-section success">
              <div class="action-section-header">
                <span class="action-section-icon"><svg viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"></circle><circle cx="12" cy="12" r="6"></circle><circle cx="12" cy="12" r="2"></circle></svg></span>
                <span class="action-section-title">Success Indicators</span>
              </div>
              <ul class="action-list" id="successIndicators"></ul>
            </div>

            <div class="timeline-box">
              <div class="action-section-header">
                <span class="action-section-icon"><svg viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline></svg></span>
                <span class="action-section-title">Timeline Suggestion</span>
              </div>
              <p class="timeline-text" id="timelineSuggestion"></p>
            </div>

            <div class="dissent-box" id="dissentBox" style="display: none;">
              <div class="action-section-header">
                <span class="action-section-icon"><svg viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"></circle><path d="M9.09 9a3 3 0 015.83 1c0 2-3 3-3 3"></path><line x1="12" y1="17" x2="12.01" y2="17"></line></svg></span>
                <span class="action-section-title">Dissenting View to Consider</span>
              </div>
              <p class="dissent-text" id="dissentText"></p>
            </div>
          </div>
        </div>

        <!-- Follow-up Section -->
        <div class="followup-section" id="followupSection">
          <h3 class="followup-title">Ask a Follow-up Question</h3>
          <div class="followup-input-row">
            <input type="text" class="form-input followup-input" id="followupInput" placeholder="e.g., What about if I have a shorter time horizon?">
            <button class="btn btn-primary" onclick="submitFollowup()">Ask</button>
          </div>
        </div>
      </div>
    </div>

    <!-- History Panel -->
    <div class="panel" id="historyPanel">
      <div class="history-panel">
        <div class="history-header">
          <h2 class="history-title">Decision History</h2>
          <button class="btn btn-secondary" onclick="loadHistory()">
            <svg class="btn-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <polyline points="23 4 23 10 17 10"></polyline>
              <path d="M20.49 15a9 9 0 1 1-2.12-9.36L23 10"></path>
            </svg>
            Refresh
          </button>
        </div>
        <div class="history-grid" id="historyGrid">
          <div class="empty-state">
            <div class="empty-icon"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2"></path><rect x="9" y="3" width="6" height="4" rx="1"></rect></svg></div>
            <p>No decisions yet. Start your first debate!</p>
          </div>
        </div>
      </div>
    </div>

    <!-- Pricing Panel -->
    <div class="panel" id="pricingPanel">
      <section class="pricing-section">
        <div class="pricing-header">
          <h2 class="pricing-title">Simple, Transparent Pricing</h2>
          <p class="pricing-subtitle">Start free. Scale as you grow.</p>
        </div>
        <div class="pricing-grid">
          <div class="pricing-card">
            <div class="pricing-plan">Free</div>
            <div class="pricing-desc">For exploring AI consensus</div>
            <div class="pricing-price">
              <span class="pricing-amount">$0</span>
              <span class="pricing-period">/month</span>
            </div>
            <ul class="pricing-features">
              <li class="pricing-feature">
                <span class="pricing-feature-icon"></span>
                <span>3 debates per day</span>
              </li>
              <li class="pricing-feature">
                <span class="pricing-feature-icon"></span>
                <span>4 LLMs (GPT, Gemini, Grok, Claude)</span>
              </li>
              <li class="pricing-feature">
                <span class="pricing-feature-icon"></span>
                <span>Budget models</span>
              </li>
              <li class="pricing-feature">
                <span class="pricing-feature-icon"></span>
                <span>Basic history</span>
              </li>
            </ul>
            <button class="btn btn-secondary btn-full">Get Started</button>
          </div>

          <div class="pricing-card featured">
            <div class="pricing-plan">Pro</div>
            <div class="pricing-desc">For power users & professionals</div>
            <div class="pricing-price">
              <span class="pricing-amount">$9</span>
              <span class="pricing-period">/month</span>
            </div>
            <ul class="pricing-features">
              <li class="pricing-feature">
                <span class="pricing-feature-icon"></span>
                <span>50 debates per month</span>
              </li>
              <li class="pricing-feature">
                <span class="pricing-feature-icon"></span>
                <span>4 LLMs (GPT, Gemini, Grok, Claude)</span>
              </li>
              <li class="pricing-feature">
                <span class="pricing-feature-icon"></span>
                <span>Premium models (GPT-4.1, Gemini Pro, etc.)</span>
              </li>
              <li class="pricing-feature">
                <span class="pricing-feature-icon"></span>
                <span>Unlimited history</span>
              </li>
              <li class="pricing-feature">
                <span class="pricing-feature-icon"></span>
                <span>Export & Share</span>
              </li>
              <li class="pricing-feature">
                <span class="pricing-feature-icon"></span>
                <span>Follow-up questions</span>
              </li>
            </ul>
            <button class="btn btn-primary btn-full" onclick="showUpgradeModal()">Upgrade to Pro</button>
          </div>

          <div class="pricing-card">
            <div class="pricing-plan">Pro+</div>
            <div class="pricing-desc">For heavy users & businesses</div>
            <div class="pricing-price">
              <span class="pricing-amount">$19</span>
              <span class="pricing-period">/month</span>
            </div>
            <ul class="pricing-features">
              <li class="pricing-feature">
                <span class="pricing-feature-icon"></span>
                <span>150 debates per month</span>
              </li>
              <li class="pricing-feature">
                <span class="pricing-feature-icon"></span>
                <span>All premium models</span>
              </li>
              <li class="pricing-feature">
                <span class="pricing-feature-icon"></span>
                <span>Priority API access</span>
              </li>
              <li class="pricing-feature">
                <span class="pricing-feature-icon"></span>
                <span>API access</span>
              </li>
              <li class="pricing-feature">
                <span class="pricing-feature-icon"></span>
                <span>Custom templates</span>
              </li>
              <li class="pricing-feature">
                <span class="pricing-feature-icon"></span>
                <span>Priority support</span>
              </li>
            </ul>
            <button class="btn btn-secondary btn-full">Upgrade to Pro+</button>
          </div>
        </div>
      </section>
    </div>
  </div>

  <!-- History Detail Modal -->
  <div class="modal-overlay" id="historyModal">
    <div class="modal">
      <div class="modal-header">
        <h3 class="modal-title">Decision Details</h3>
        <button class="modal-close" onclick="closeModal()">&times;</button>
      </div>
      <div class="modal-body" id="modalBody"></div>
    </div>
  </div>

  <!-- Onboarding Modal -->
  <div class="modal-overlay" id="onboardingModal">
    <div class="modal onboarding-modal">
      <div class="onboarding-hero">
        <div class="onboarding-hero-icon"></div>
        <div class="onboarding-hero-title">Welcome to ConsensusAI</div>
        <div class="onboarding-hero-subtitle">Make better decisions with AI debate</div>
      </div>

      <div class="onboarding-steps">
        <div class="onboarding-step">
          <div class="onboarding-step-number">1</div>
          <div class="onboarding-step-content">
            <h4>Ask Your Question</h4>
            <p>Type any decision or dilemma you're facing. Add context like budget, timeline, or constraints for more relevant advice.</p>
          </div>
        </div>
        <div class="onboarding-step">
          <div class="onboarding-step-number">2</div>
          <div class="onboarding-step-content">
            <h4>AIs Debate Each Other</h4>
            <p>4 different AI models (GPT, Gemini, Grok, Claude) discuss your question in 3 rounds, reading and responding to each other's arguments.</p>
          </div>
        </div>
        <div class="onboarding-step">
          <div class="onboarding-step-number">3</div>
          <div class="onboarding-step-content">
            <h4>Get Consensus Recommendation</h4>
            <p>See which position the AIs converge on, with confidence scores and the key reasoning behind the recommendation.</p>
          </div>
        </div>
      </div>

      <div class="onboarding-features">
        <div class="onboarding-features-title">Optional Modes</div>
        <div class="onboarding-feature">
          <span class="onboarding-feature-icon"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M12 2L9 7l-6 1 4.5 4-1 6L12 15l5.5 3-1-6 4.5-4-6-1-3-5z"></path><circle cx="9" cy="10" r="1" fill="currentColor"></circle><circle cx="15" cy="10" r="1" fill="currentColor"></circle><path d="M9 14s1.5 2 3 2 3-2 3-2"></path></svg></span>
          <div class="onboarding-feature-content">
            <strong>Devil's Advocate</strong>
            <span>One AI challenges the consensus to stress-test the recommendation. Best for critical decisions.</span>
          </div>
        </div>
        <div class="onboarding-feature">
          <span class="onboarding-feature-icon"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><line x1="18" y1="20" x2="18" y2="10"></line><line x1="12" y1="20" x2="12" y2="4"></line><line x1="6" y1="20" x2="6" y2="14"></line></svg></span>
          <div class="onboarding-feature-content">
            <strong>Show All Positions</strong>
            <span>See every unique viewpoint, including minority opinions. Great for exploring alternatives.</span>
          </div>
        </div>
      </div>

      <div class="onboarding-footer">
        <button class="onboarding-skip" onclick="closeOnboarding()">Skip tutorial</button>
        <button class="onboarding-start" onclick="closeOnboarding()">Got it, let's start!</button>
      </div>
    </div>
  </div>

  <!-- Limit Reached Modal -->
  <div class="modal-overlay" id="limitModal">
    <div class="modal limit-modal">
      <div class="limit-modal-content">
        <div class="limit-modal-icon"></div>
        <div class="limit-modal-title">Daily Limit Reached</div>
        <div class="limit-modal-subtitle">You've used all 3 free debates for today</div>

        <div class="limit-modal-info">
          <div class="limit-modal-reset">
            Limit resets at <strong id="limitResetTime">midnight UTC</strong>
          </div>
        </div>

        <div class="limit-modal-actions">
          <button class="limit-modal-upgrade" onclick="switchTab('pricing'); closeLimitModal();">
            Upgrade to Pro - Unlimited Debates
          </button>
          <button class="limit-modal-dismiss" onclick="closeLimitModal()">
            I'll wait until tomorrow
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Loading Overlay -->
  <div class="loading-overlay" id="loadingOverlay">
    <div class="loading-spinner-large"></div>
    <p class="loading-text" id="loadingText">Starting AI debate...</p>
    <p class="loading-substatus" id="loadingSubstatus">Querying 3 models in parallel</p>
  </div>

  <!-- Toast -->
  <div class="toast" id="toast"></div>

  <script>
    // State
    let config = { llms: [], maxRounds: 3, activeTier: 'budget', tiers: {} };
    let currentResult = null;
    let historyData = [];
    let selectedTier = 'budget';

    // Auth state
    let clerkInstance = null;
    let currentUser = null;
    let authConfigured = false;

    // Tier model mappings
    const tierModels = {
      budget: {
        openai: 'gpt-4o-mini',
        gemini: 'gemini-2.0-flash',
        grok: 'grok-3-mini-fast',
        claude: 'claude-3-5-haiku'
      },
      premium: {
        openai: 'gpt-4.1',
        gemini: 'gemini-2.5-pro',
        grok: 'grok-3',
        claude: 'claude-opus-4'
      }
    };

    // Templates
    const templates = {
      investment: {
        question: "Should I invest in [X] now or wait?",
        context: "Budget: $[amount], Time horizon: [short/long]-term, Risk tolerance: [low/moderate/high]"
      },
      career: {
        question: "Should I take job offer A or B?",
        context: "Offer A: [details], Offer B: [details], My priorities: [salary/growth/balance/location]"
      },
      tech: {
        question: "Which technology should I use: [A] or [B]?",
        context: "Project type: [web/mobile/backend], Team size: [X], Timeline: [X months]"
      },
      purchase: {
        question: "Should I buy [X] now or wait?",
        context: "Budget: $[amount], Need urgency: [immediate/can wait], Alternative: [Y]"
      },
      strategy: {
        question: "Should we pursue strategy A or B?",
        context: "Goal: [X], Resources: [limited/moderate/abundant], Timeline: [X months]"
      },
      custom: { question: "", context: "" }
    };

    // ==================== Onboarding & How It Works ====================

    // Check if first-time user and show onboarding
    function checkFirstTimeUser() {
      const hasSeenOnboarding = localStorage.getItem('consensus_onboarding_seen');
      if (!hasSeenOnboarding) {
        showOnboarding();
        // Also expand "How It Works" for first-time users
        document.getElementById('howItWorks').classList.add('expanded');
      }
    }

    // ==================== Auth Functions ====================

    // Initialize Clerk authentication
    async function initAuth() {
      const authLoading = document.getElementById('authLoading');
      const authSignedOut = document.getElementById('authSignedOut');
      const authSignedIn = document.getElementById('authSignedIn');

      try {
        // Get auth config from server
        const configRes = await fetch('/api/config');
        const configData = await configRes.json();

        if (!configData.auth?.configured || !configData.auth?.publishableKey) {
          // Auth not configured - hide auth UI entirely
          authLoading.style.display = 'none';
          authConfigured = false;
          console.log('Clerk not configured - auth disabled');
          return;
        }

        authConfigured = true;
        const publishableKey = configData.auth.publishableKey;

        // Load Clerk script dynamically with the publishable key
        await loadClerkScript(publishableKey);

        // Initialize Clerk
        clerkInstance = window.Clerk;
        await clerkInstance.load();

        // Listen for auth state changes
        clerkInstance.addListener((event) => {
          updateAuthUI();
        });

        // Initial UI update
        updateAuthUI();

      } catch (error) {
        console.error('Auth initialization failed:', error);
        authLoading.style.display = 'none';
        // Show sign-in buttons anyway as fallback
        authSignedOut.style.display = 'flex';
        authConfigured = false;
      }
    }

    // Load Clerk script dynamically
    function loadClerkScript(publishableKey) {
      return new Promise((resolve, reject) => {
        // Check if already loaded
        if (window.Clerk) {
          resolve();
          return;
        }

        const script = document.createElement('script');
        script.src = 'https://cdn.jsdelivr.net/npm/@clerk/clerk-js@latest/dist/clerk.browser.js';
        script.crossOrigin = 'anonymous';
        script.setAttribute('data-clerk-publishable-key', publishableKey);
        script.onload = () => {
          // Wait a tick for Clerk to initialize
          setTimeout(resolve, 100);
        };
        script.onerror = reject;
        document.head.appendChild(script);
      });
    }

    // Wait for Clerk script to load
    function waitForClerk() {
      return new Promise((resolve, reject) => {
        if (window.Clerk) {
          resolve();
          return;
        }

        let attempts = 0;
        const maxAttempts = 50;
        const interval = setInterval(() => {
          attempts++;
          if (window.Clerk) {
            clearInterval(interval);
            resolve();
          } else if (attempts >= maxAttempts) {
            clearInterval(interval);
            reject(new Error('Clerk failed to load'));
          }
        }, 100);
      });
    }

    // Update auth UI based on current state
    function updateAuthUI() {
      const authLoading = document.getElementById('authLoading');
      const authSignedOut = document.getElementById('authSignedOut');
      const authSignedIn = document.getElementById('authSignedIn');
      const userAvatar = document.getElementById('userAvatar');
      const userName = document.getElementById('userName');
      const userTier = document.getElementById('userTier');

      authLoading.style.display = 'none';

      if (!clerkInstance) {
        authSignedOut.style.display = 'none';
        authSignedIn.style.display = 'none';
        return;
      }

      const user = clerkInstance.user;

      if (user) {
        currentUser = user;
        authSignedOut.style.display = 'none';
        authSignedIn.style.display = 'block';

        // Update avatar
        if (user.imageUrl) {
          userAvatar.innerHTML = `<img src="${user.imageUrl}" alt="Avatar">`;
        } else {
          const initials = (user.firstName?.[0] || '') + (user.lastName?.[0] || user.emailAddresses?.[0]?.emailAddress?.[0] || 'U');
          userAvatar.innerHTML = initials.toUpperCase();
        }

        // Update name
        userName.textContent = user.firstName || user.emailAddresses?.[0]?.emailAddress?.split('@')[0] || 'User';

        // Update tier
        const tier = user.publicMetadata?.tier || 'free';
        userTier.textContent = tier.toUpperCase();
        userTier.className = `user-tier user-tier-${tier}`;

      } else {
        currentUser = null;
        authSignedOut.style.display = 'flex';
        authSignedIn.style.display = 'none';
      }
    }

    // Handle sign in
    function handleSignIn() {
      if (clerkInstance) {
        clerkInstance.openSignIn({
          afterSignInUrl: window.location.href,
          afterSignUpUrl: window.location.href
        });
      }
    }

    // Handle sign up
    function handleSignUp() {
      if (clerkInstance) {
        clerkInstance.openSignUp({
          afterSignInUrl: window.location.href,
          afterSignUpUrl: window.location.href
        });
      }
    }

    // Handle sign out
    async function handleSignOut() {
      if (clerkInstance) {
        await clerkInstance.signOut();
        updateAuthUI();
        showToast('Signed out successfully');
      }
    }

    // Handle manage account
    function handleManageAccount() {
      if (clerkInstance) {
        clerkInstance.openUserProfile();
      }
    }

    // Toggle user menu dropdown
    function toggleUserMenu() {
      const userMenu = document.getElementById('userMenu');
      userMenu.classList.toggle('active');
    }

    // Close user menu when clicking outside
    document.addEventListener('click', (e) => {
      const userMenu = document.getElementById('userMenu');
      if (userMenu && !userMenu.contains(e.target)) {
        userMenu.classList.remove('active');
      }
    });

    // Get auth token for API requests
    async function getAuthToken() {
      if (clerkInstance && clerkInstance.session) {
        return await clerkInstance.session.getToken();
      }
      return null;
    }

    // ==================== End Auth Functions ====================

    // Show onboarding modal
    function showOnboarding() {
      document.getElementById('onboardingModal').classList.add('active');
    }

    // Close onboarding modal
    function closeOnboarding() {
      document.getElementById('onboardingModal').classList.remove('active');
      localStorage.setItem('consensus_onboarding_seen', 'true');
    }

    // Toggle How It Works section
    function toggleHowItWorks() {
      const section = document.getElementById('howItWorks');
      section.classList.toggle('expanded');
    }

    // Toggle option card (for debate settings)
    function toggleOptionCard(cardId) {
      const card = document.getElementById(cardId);
      const isActive = card.dataset.active === 'true';
      card.dataset.active = (!isActive).toString();
      card.classList.toggle('active', !isActive);
    }

    // Get option values (for use when submitting)
    function getDebateOptions() {
      return {
        devilsAdvocate: document.getElementById('devilsAdvocateCard')?.dataset.active === 'true',
        showAlternatives: document.getElementById('showAlternativesCard')?.dataset.active === 'true'
      };
    }

    // ==================== Limit Reached Modal ====================

    // Show limit reached modal
    function showLimitReachedModal(result) {
      const modal = document.getElementById('limitModal');
      const resetTimeEl = document.getElementById('limitResetTime');

      // Calculate reset time (midnight UTC)
      if (result.resetAt) {
        const resetDate = new Date(result.resetAt);
        const options = { hour: '2-digit', minute: '2-digit', timeZoneName: 'short' };
        resetTimeEl.textContent = resetDate.toLocaleTimeString(undefined, options);
      } else {
        // Default to midnight UTC
        const tomorrow = new Date();
        tomorrow.setUTCDate(tomorrow.getUTCDate() + 1);
        tomorrow.setUTCHours(0, 0, 0, 0);
        const options = { hour: '2-digit', minute: '2-digit', timeZoneName: 'short' };
        resetTimeEl.textContent = tomorrow.toLocaleTimeString(undefined, options);
      }

      modal.classList.add('active');
    }

    // Close limit modal
    function closeLimitModal() {
      document.getElementById('limitModal').classList.remove('active');
    }

    // DOM Elements
    const questionInput = document.getElementById('questionInput');
    const contextInput = document.getElementById('contextInput');
    const questionCount = document.getElementById('questionCount');
    const contextCount = document.getElementById('contextCount');
    const debateForm = document.getElementById('debateForm');
    const submitBtn = document.getElementById('submitBtn');
    const debateContainer = document.getElementById('debateContainer');
    const llmGrid = document.getElementById('llmGrid');
    const roundDots = document.getElementById('roundDots');
    const roundText = document.getElementById('roundText');
    const alternativesPanel = document.getElementById('alternativesPanel');
    const alternativesGrid = document.getElementById('alternativesGrid');
    const resultCard = document.getElementById('resultCard');
    const historyGrid = document.getElementById('historyGrid');
    const loadingOverlay = document.getElementById('loadingOverlay');
    const loadingText = document.getElementById('loadingText');
    const loadingSubstatus = document.getElementById('loadingSubstatus');
    const toast = document.getElementById('toast');

    // Initialize
    async function init() {
      await loadConfig();
      await loadHistory();
      setupEventListeners();
      updateStats();
      // Initialize authentication (non-blocking)
      initAuth();
      // Check if first-time user and show onboarding
      checkFirstTimeUser();
    }

    // Load config
    async function loadConfig() {
      try {
        const res = await fetch('/api/config');
        config = await res.json();
        document.querySelector('.hero-badge span:last-child').textContent = `${config.llms.length} AI Models Active`;

        // Set initial tier from config
        selectedTier = config.activeTier || 'budget';
        updateTierUI();
        renderTierModels();

        // Show usage indicator for free users
        if (config.user && config.user.tier === 'free') {
          updateUsageIndicator(config.user);
        }

        // Update global stats
        if (config.stats) {
          document.getElementById('statDecisions').textContent = config.stats.totalDebates || 0;
        }
      } catch (err) {
        showToast('Failed to load configuration', 'error');
      }
    }

    // Update usage indicator
    function updateUsageIndicator(userStats) {
      const indicator = document.getElementById('usageIndicator');
      const remaining = document.getElementById('usageRemaining');

      if (userStats.tier === 'free') {
        indicator.style.display = 'flex';
        remaining.textContent = userStats.remaining;

        if (userStats.remaining <= 0) {
          indicator.classList.add('limit-reached');
          remaining.parentElement.innerHTML = `Daily limit reached. Resets at midnight UTC.`;
        } else if (userStats.remaining === 1) {
          indicator.style.background = 'var(--warning-bg)';
        }
      } else {
        indicator.style.display = 'none';
      }
    }

    // Show upgrade modal
    function showUpgradeModal() {
      showToast('Pro subscription coming soon! For now, enjoy 3 free debates per day.', 'info');
    }

    // Update tier UI
    function updateTierUI() {
      document.querySelectorAll('.tier-btn').forEach(btn => {
        btn.classList.remove('active');
        if (btn.dataset.tier === selectedTier) {
          btn.classList.add('active');
        }
      });
    }

    // Render tier model tags
    function renderTierModels() {
      const models = tierModels[selectedTier];
      const tierModelsEl = document.getElementById('tierModels');

      tierModelsEl.innerHTML = config.llms.map(llm => {
        const modelName = models[llm.id] || llm.model;
        const llmClass = llm.id === 'openai' ? 'gpt' : llm.id;
        return `<span class="tier-model-tag ${llmClass}">${modelName}</span>`;
      }).join('');
    }

    // Set tier
    async function setTier(tier) {
      try {
        await fetch('/api/tier', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ tier })
        });
        selectedTier = tier;
        updateTierUI();
        renderTierModels();
        showToast(`Switched to ${tier === 'premium' ? 'Premium' : 'Budget'} models`, 'success');
      } catch (err) {
        showToast('Failed to switch tier', 'error');
      }
    }

    // Setup event listeners
    function setupEventListeners() {
      // Character counters
      questionInput.addEventListener('input', () => questionCount.textContent = questionInput.value.length);
      contextInput.addEventListener('input', () => contextCount.textContent = contextInput.value.length);

      // Form submit
      debateForm.addEventListener('submit', handleSubmit);

      // Tier toggle buttons
      document.querySelectorAll('.tier-btn').forEach(btn => {
        btn.addEventListener('click', () => {
          const tier = btn.dataset.tier;
          if (tier !== selectedTier) {
            setTier(tier);
          }
        });
      });

      // Templates
      document.querySelectorAll('.template-btn').forEach(btn => {
        btn.addEventListener('click', () => {
          document.querySelectorAll('.template-btn').forEach(b => b.classList.remove('selected'));
          btn.classList.add('selected');
          const template = templates[btn.dataset.template];
          questionInput.value = template.question;
          contextInput.value = template.context;
          questionCount.textContent = template.question.length;
          contextCount.textContent = template.context.length;
        });
      });

      // Tab navigation
      document.querySelectorAll('.nav-link').forEach(link => {
        link.addEventListener('click', (e) => {
          e.preventDefault();
          const tab = link.dataset.tab;
          switchTab(tab);
        });
      });
    }

    // Switch tabs
    function switchTab(tab) {
      document.querySelectorAll('.nav-link').forEach(l => l.classList.remove('active'));
      document.querySelectorAll('.panel').forEach(p => p.classList.remove('active'));
      document.querySelector(`[data-tab="${tab}"]`).classList.add('active');
      document.getElementById(`${tab}Panel`).classList.add('active');
    }

    // Activity Feed System
    let activityInterval = null;
    let llmDetailedResults = {}; // Store full results for expandable details

    // Activity messages for different phases
    const activityMessages = {
      analyzing: [
        'Parsing your question...',
        'Identifying key decision factors...',
        'Preparing context for AI models...',
        'Setting up debate parameters...'
      ],
      gpt: [
        'GPT is analyzing the problem space...',
        'GPT is considering multiple angles...',
        'GPT is formulating initial position...',
        'GPT is evaluating risks and benefits...'
      ],
      gemini: [
        'Gemini is processing your query...',
        'Gemini is exploring alternatives...',
        'Gemini is building arguments...',
        'Gemini is assessing confidence levels...'
      ],
      grok: [
        'Grok is diving into the details...',
        'Grok is challenging assumptions...',
        'Grok is forming a perspective...',
        'Grok is identifying edge cases...'
      ],
      claude: [
        'Claude is synthesizing information...',
        'Claude is weighing pros and cons...',
        'Claude is developing reasoning...',
        'Claude is finalizing position...'
      ],
      deliberation: [
        'AIs are reviewing each other\'s positions...',
        'Cross-checking arguments for validity...',
        'Identifying points of agreement...',
        'Evaluating conflicting viewpoints...'
      ],
      consensus: [
        'Calculating consensus strength...',
        'Measuring confidence alignment...',
        'Determining final recommendation...',
        'Preparing detailed report...'
      ]
    };

    // Add activity to feed
    function addActivity(type, message, llmId = null) {
      const activityList = document.getElementById('activityList');
      const llmClass = llmId === 'openai' ? 'gpt' : (llmId || type);
      const iconText = llmId ? (llmId === 'openai' ? 'G' : llmId.charAt(0).toUpperCase()) : (type === 'system' ? 'S' : 'C');

      const item = document.createElement('div');
      item.className = 'activity-item';
      item.innerHTML = `
        <div class="activity-icon ${llmClass}">${iconText}</div>
        <div class="activity-content">
          <div class="activity-message">${message}</div>
          <div class="activity-time">${new Date().toLocaleTimeString()}</div>
        </div>
      `;

      activityList.insertBefore(item, activityList.firstChild);

      // Keep only last 10 items
      while (activityList.children.length > 10) {
        activityList.removeChild(activityList.lastChild);
      }
    }

    // SSE connection for real-time events
    let sseConnection = null;

    // Connect to SSE stream for real-time debate updates
    function connectToSSE(debateId) {
      return new Promise((resolve) => {
        sseConnection = new EventSource(`/api/debate/stream?id=${debateId}`);

        sseConnection.addEventListener('connected', () => {
          resolve(true);
        });

        sseConnection.addEventListener('debate_start', (e) => {
          const data = JSON.parse(e.data);
          addActivity('system', `Debate started with ${data.llms?.length || 4} AI models`);
        });

        sseConnection.addEventListener('round_start', (e) => {
          const data = JSON.parse(e.data);
          addActivity('system', `Round ${data.round} of ${data.totalRounds} starting...`);
        });

        sseConnection.addEventListener('llm_start', (e) => {
          const data = JSON.parse(e.data);
          const llmId = data.llmId === 'openai' ? 'gpt' : data.llmId;
          addActivity(llmId, `${data.llmName} is analyzing...`, data.llmId);
        });

        sseConnection.addEventListener('llm_complete', (e) => {
          const data = JSON.parse(e.data);
          const llmId = data.llmId === 'openai' ? 'gpt' : data.llmId;
          const decision = data.result?.decision || 'Analyzing';
          const keyArg = data.result?.key_argument?.substring(0, 60) || '';
          addActivity(llmId, `${data.llmName}: ${decision}. ${keyArg}...`, data.llmId);
        });

        sseConnection.addEventListener('llm_error', (e) => {
          const data = JSON.parse(e.data);
          addActivity('system', `${data.llmName} encountered an error`);
        });

        sseConnection.addEventListener('round_complete', (e) => {
          const data = JSON.parse(e.data);
          if (data.consensus?.reached) {
            addActivity('consensus', `Consensus reached after round ${data.round}!`);
          }
        });

        sseConnection.addEventListener('synthesis_start', () => {
          addActivity('system', 'Generating your action plan...');
        });

        sseConnection.addEventListener('synthesis_complete', () => {
          addActivity('system', 'Action plan ready!');
        });

        sseConnection.addEventListener('debate_complete', () => {
          addActivity('consensus', 'Debate complete!');
        });

        sseConnection.onerror = () => {
          // Fallback to simulation on SSE error
          resolve(false);
        };

        // Timeout fallback
        setTimeout(() => resolve(false), 2000);
      });
    }

    // Close SSE connection
    function closeSSE() {
      if (sseConnection) {
        sseConnection.close();
        sseConnection = null;
      }
    }

    // Start simulated activity stream (fallback when SSE unavailable)
    function startActivitySimulation(llms) {
      let phase = 0;
      let messageIndex = 0;
      const phases = ['analyzing', ...llms.map(l => l.id === 'openai' ? 'gpt' : l.id)];

      activityInterval = setInterval(() => {
        const currentPhase = phases[phase % phases.length];
        const messages = activityMessages[currentPhase] || activityMessages.analyzing;
        const message = messages[messageIndex % messages.length];

        const llmId = phase > 0 ? llms[(phase - 1) % llms.length]?.id : null;
        addActivity(currentPhase, message, llmId);

        messageIndex++;
        if (messageIndex >= messages.length) {
          messageIndex = 0;
          phase++;
        }
      }, 1500);
    }

    // Stop activity simulation
    function stopActivitySimulation() {
      if (activityInterval) {
        clearInterval(activityInterval);
        activityInterval = null;
      }
      closeSSE();
    }

    // Clear activity feed
    function clearActivityFeed() {
      const activityList = document.getElementById('activityList');
      activityList.innerHTML = '';
    }

    // Toggle LLM details panel
    function toggleLLMDetails(llmId) {
      const panel = document.getElementById(`details-panel-${llmId}`);
      const toggle = document.getElementById(`details-toggle-${llmId}`);

      if (panel && toggle) {
        panel.classList.toggle('active');
        toggle.classList.toggle('expanded');
      }
    }

    // Handle form submit with engaging progress
    async function handleSubmit(e) {
      e.preventDefault();
      const question = questionInput.value.trim();
      const context = contextInput.value.trim();
      if (!question) return;

      // Reset UI
      resultCard.classList.remove('active');
      document.getElementById('followupSection').classList.remove('active');
      document.getElementById('actionPlan').classList.remove('active');
      document.getElementById('debateTimeline').style.display = 'none';
      alternativesPanel.classList.remove('active');
      debateContainer.classList.add('active');
      submitBtn.disabled = true;
      llmDetailedResults = {};

      // Show live indicator and activity feed
      const liveIndicator = document.getElementById('liveIndicator');
      liveIndicator.style.display = 'inline-flex';
      document.getElementById('activityFeed').style.display = 'block';
      clearActivityFeed();

      // Initialize LLM cards
      renderLLMCards();

      // Generate debate ID for SSE connection
      const debateId = Date.now().toString();

      // Try to connect to SSE for real-time updates
      addActivity('system', 'Debate initiated - connecting to AI models...');
      const sseConnected = await connectToSSE(debateId);

      // Fall back to simulation if SSE fails
      if (!sseConnected) {
        startActivitySimulation(config.llms);
      }

      // Scroll to debate section
      debateContainer.scrollIntoView({ behavior: 'smooth', block: 'start' });

      const dots = roundDots.querySelectorAll('.round-dot');

      try {
        // Get auth token if available
        const authToken = await getAuthToken();
        const headers = { 'Content-Type': 'application/json' };
        if (authToken) {
          headers['Authorization'] = `Bearer ${authToken}`;
        }

        // Make the API request (include debateId for SSE correlation)
        const res = await fetch('/api/debate', {
          method: 'POST',
          headers,
          body: JSON.stringify({ question, context, tier: selectedTier, debateId })
        });

        const result = await res.json();

        // Stop simulation
        stopActivitySimulation();

        // Check for rate limit (429) or limit reached flag
        if (res.status === 429 || result.limitReached) {
          liveIndicator.style.display = 'none';
          debateContainer.classList.remove('active');
          document.getElementById('activityFeed').style.display = 'none';
          showLimitReachedModal(result);
          updateUsageIndicator({ tier: 'free', remaining: 0 });
          submitBtn.disabled = false;
          return;
        }

        if (result.error) throw new Error(result.error);

        currentResult = result;

        // Add completion activities
        addActivity('system', `Debate completed in ${result.rounds.length} round(s)`);
        if (result.finalConsensus?.reached) {
          addActivity('consensus', `${result.finalConsensus.type} consensus reached!`);
        } else {
          addActivity('consensus', 'Split decision - showing majority position');
        }

        // Animate through the results with delays for visual effect
        await animateResults(result, dots);

        // Hide live indicator
        liveIndicator.style.display = 'none';

        // Final UI updates
        renderTimeline(result);
        showResult(result);
        loadHistory();
        updateStats();

        // Update usage indicator
        if (result.usage) {
          updateUsageIndicator({
            tier: 'free',
            remaining: result.usage.remaining
          });
        }

        showToast('Debate completed successfully!', 'success');
      } catch (err) {
        stopActivitySimulation();
        liveIndicator.style.display = 'none';
        showToast(err.message || 'Debate failed', 'error');
      } finally {
        submitBtn.disabled = false;
      }
    }

    // Animate results appearing with staggered delays
    async function animateResults(result, dots) {
      const delay = (ms) => new Promise(resolve => setTimeout(resolve, ms));

      for (let roundIdx = 0; roundIdx < result.rounds.length; roundIdx++) {
        const round = result.rounds[roundIdx];
        const roundNum = roundIdx + 1;

        // Update round indicator
        roundText.textContent = `Round ${roundNum}/${config.maxRounds}`;
        if (dots[roundIdx]) {
          dots[roundIdx].classList.add('active');
        }

        // Add round activity
        addActivity('system', `Round ${roundNum}: All AIs submitting positions...`);

        // Animate each LLM result with staggered timing
        for (let i = 0; i < round.results.length; i++) {
          const r = round.results[i];
          await delay(300); // Stagger each card update

          // Store detailed result for expandable panel
          llmDetailedResults[r.llmId] = r;

          // Update card with full details
          updateLLMCardFull(r, roundNum);

          // Add activity for this LLM
          const llmName = r.llmName || r.llmId;
          if (r.error) {
            addActivity(r.llmId, `${llmName} encountered an error`, r.llmId);
          } else {
            const decisionEmoji = {
              'YES': '',
              'NO': '',
              'CONDITIONAL': '',
              'WAIT': '',
              'ALTERNATIVE': ''
            }[r.decision] || '';
            const keyArg = r.key_argument ? ` Key point: "${r.key_argument.substring(0, 60)}${r.key_argument.length > 60 ? '...' : ''}"` : '';
            addActivity(r.llmId, `${llmName} says ${decisionEmoji} ${r.decision || 'Analyzing'}. ${keyArg}`, r.llmId);
          }
        }

        // Mark round complete
        if (dots[roundIdx]) {
          dots[roundIdx].classList.remove('active');
          dots[roundIdx].classList.add('completed');
        }

        // Brief pause between rounds
        if (roundIdx < result.rounds.length - 1) {
          addActivity('system', 'AIs reviewing each other\'s positions...');
          await delay(500);
        }
      }
    }

    // Update LLM card with full details including expandable section
    function updateLLMCardFull(r, roundNum) {
      const card = document.getElementById(`card-${r.llmId}`);
      if (!card) return;

      card.classList.add('active');
      card.style.animation = 'none';
      card.offsetHeight;
      card.style.animation = 'cardUpdate 0.5s ease';

      const statusEl = document.getElementById(`status-${r.llmId}`);
      const positionEl = document.getElementById(`position-${r.llmId}`);
      const confValue = document.getElementById(`conf-value-${r.llmId}`);
      const confFill = document.getElementById(`conf-fill-${r.llmId}`);
      const argumentEl = document.getElementById(`argument-${r.llmId}`);
      const detailsPanel = document.getElementById(`details-panel-${r.llmId}`);

      if (r.error) {
        statusEl.innerHTML = `<span style="color: var(--error)">Error</span>`;
        positionEl.innerHTML = `<div class="position-label">Error</div><div class="position-text" style="color: var(--error)">${r.reasoning || r.error}</div>`;
        return;
      }

      // Update status
      statusEl.innerHTML = `<span style="color: var(--success)">Round ${roundNum} </span>`;

      // Update position with decision badge
      const decisionClass = (r.decision || 'unknown').toLowerCase();
      const decisionIcon = {
        'yes': '',
        'no': '',
        'conditional': '',
        'wait': '',
        'alternative': '',
        'unknown': '?'
      }[decisionClass] || '?';

      positionEl.innerHTML = `
        <div class="decision-badge ${decisionClass}">${decisionIcon} ${r.decision || 'Analyzing...'}</div>
        <div class="position-label">
          Position ${r.changed ? '<span class="changed-tag">Changed</span>' : ''}
        </div>
        <div class="position-text">${r.position || 'Processing...'}</div>
        ${r.reasoning ? `<div class="reasoning-preview">${r.reasoning.substring(0, 200)}${r.reasoning.length > 200 ? '...' : ''}</div>` : ''}
      `;

      // Update confidence
      if (r.confidence) {
        confValue.textContent = `${r.confidence}/10`;
        confFill.style.width = `${r.confidence * 10}%`;
      }

      // Update key argument
      if (r.key_argument && argumentEl) {
        argumentEl.textContent = `"${r.key_argument}"`;
      }

      // Update details panel
      if (detailsPanel) {
        detailsPanel.innerHTML = `
          <div class="details-section">
            <div class="details-label">Full Reasoning</div>
            <div class="details-content reasoning">${r.reasoning || 'No detailed reasoning provided.'}</div>
          </div>
          ${r.risks && r.risks.length > 0 ? `
          <div class="details-section">
            <div class="details-label">Identified Risks</div>
            <div class="details-risks">
              ${r.risks.map(risk => `<span class="details-tag risk">${risk}</span>`).join('')}
            </div>
          </div>
          ` : ''}
          ${r.assumptions && r.assumptions.length > 0 ? `
          <div class="details-section">
            <div class="details-label">Key Assumptions</div>
            <div class="details-assumptions">
              ${r.assumptions.map(a => `<span class="details-tag assumption">${a}</span>`).join('')}
            </div>
          </div>
          ` : ''}
          ${r.response_to_others ? `
          <div class="details-section">
            <div class="details-label">Response to Other AIs</div>
            <div class="details-content">${r.response_to_others}</div>
          </div>
          ` : ''}
        `;
      }
    }

    // Legacy function for compatibility
    function updateLLMStatus(llmId, status, message) {
      const statusEl = document.getElementById(`status-${llmId}`);
      if (!statusEl) return;

      if (status === 'thinking') {
        statusEl.innerHTML = `<div class="status-spinner"></div> ${message || 'Thinking...'}`;
      } else if (status === 'error') {
        statusEl.innerHTML = `<span style="color: var(--error)">Error</span>`;
      } else if (status === 'done') {
        statusEl.innerHTML = `<span style="color: var(--success)">Done</span>`;
      }
    }

    // Legacy function - now uses updateLLMCardFull
    function updateLLMWithResult(llmId, result, round) {
      llmDetailedResults[llmId] = result;
      updateLLMCardFull({ ...result, llmId }, round);
    }

    // Render debate timeline
    function renderTimeline(result) {
      const timeline = document.getElementById('debateTimeline');
      const timelineSteps = document.getElementById('timelineSteps');

      let stepsHtml = '';

      // Step 1: Question received
      stepsHtml += `
        <div class="timeline-step completed">
          <div class="timeline-step-title">Question Received</div>
          <div class="timeline-step-desc">Your question was sent to ${config.llms.length} AI models</div>
        </div>
      `;

      // Steps for each round
      result.rounds.forEach((round, roundIndex) => {
        const roundNum = roundIndex + 1;
        const positionsInRound = round.results.filter(r => !r.error);
        const uniquePositions = [...new Set(positionsInRound.map(r => r.position?.substring(0, 50)))];
        const changedCount = positionsInRound.filter(r => r.changed).length;

        let roundDesc = '';
        if (roundNum === 1) {
          roundDesc = `All ${positionsInRound.length} AIs shared their initial positions`;
        } else if (changedCount > 0) {
          roundDesc = `${changedCount} AI${changedCount > 1 ? 's' : ''} changed position after reviewing others' arguments`;
        } else {
          roundDesc = 'All AIs maintained their positions';
        }

        stepsHtml += `
          <div class="timeline-step completed">
            <div class="timeline-step-title">Round ${roundNum}: Deliberation</div>
            <div class="timeline-step-desc">${roundDesc}</div>
            <div class="timeline-step-details">
              ${positionsInRound.map(r => {
                const llmClass = r.llmId === 'openai' ? 'gpt' : r.llmId;
                return `
                  <div class="timeline-position">
                    <span class="timeline-llm-name ${llmClass}">${r.llmName}:</span>
                    <span>${r.position?.substring(0, 80)}${r.position?.length > 80 ? '...' : ''}</span>
                  </div>
                `;
              }).join('')}
            </div>
          </div>
        `;
      });

      // Final step: Consensus
      const consensus = result.finalConsensus;
      const consensusDesc = consensus.reached
        ? `${consensus.type.charAt(0).toUpperCase() + consensus.type.slice(1)} consensus reached with ${consensus.confidence}/10 confidence`
        : 'AIs could not fully agree - showing majority position';

      stepsHtml += `
        <div class="timeline-step completed">
          <div class="timeline-step-title">${consensus.reached ? 'Consensus Reached' : 'Final Decision'}</div>
          <div class="timeline-step-desc">${consensusDesc}</div>
        </div>
      `;

      timelineSteps.innerHTML = stepsHtml;
      timeline.style.display = 'block';
    }

    // Render LLM cards with expandable details
    function renderLLMCards() {
      const llmMeta = {
        openai: { class: 'gpt', initials: selectedTier === 'premium' ? '4.1' : '4m' },
        gemini: { class: 'gemini', initials: selectedTier === 'premium' ? '2.5' : '2.0' },
        grok: { class: 'grok', initials: selectedTier === 'premium' ? 'G3' : 'G3m' },
        claude: { class: 'claude', initials: selectedTier === 'premium' ? 'O4' : 'H3' }
      };

      const currentTierModels = tierModels[selectedTier];

      llmGrid.innerHTML = config.llms.map(llm => {
        const meta = llmMeta[llm.id] || { class: 'gpt', initials: '?' };
        const model = currentTierModels[llm.id] || llm.model || 'unknown';
        return `
          <div class="llm-card" id="card-${llm.id}">
            <div class="llm-card-header">
              <div class="llm-avatar ${meta.class}">${meta.initials}</div>
              <div class="llm-info">
                <div class="llm-name">${llm.name}</div>
                <div class="llm-model">${model}</div>
              </div>
              <div class="llm-status" id="status-${llm.id}">
                <div class="status-spinner"></div>
                Thinking...
              </div>
            </div>
            <div class="llm-card-body">
              <div class="position-box" id="position-${llm.id}">
                <div class="position-label">Position</div>
                <div class="position-text">Analyzing your question...</div>
              </div>
              <div class="confidence-meter">
                <div class="confidence-header">
                  <span class="confidence-label">Confidence</span>
                  <span class="confidence-value" id="conf-value-${llm.id}"></span>
                </div>
                <div class="confidence-bar">
                  <div class="confidence-fill ${meta.class}" id="conf-fill-${llm.id}" style="width: 0%"></div>
                </div>
              </div>
              <div class="key-argument" id="argument-${llm.id}"></div>

              <!-- Expandable Details Toggle -->
              <button class="llm-details-toggle" id="details-toggle-${llm.id}" onclick="toggleLLMDetails('${llm.id}')">
                <span>View Full Response</span>
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <polyline points="6 9 12 15 18 9"></polyline>
                </svg>
              </button>

              <!-- Expandable Details Panel -->
              <div class="llm-details-panel" id="details-panel-${llm.id}">
                <div class="details-section">
                  <div class="details-label">Full Reasoning</div>
                  <div class="details-content reasoning">Waiting for response...</div>
                </div>
              </div>
            </div>
          </div>
        `;
      }).join('');
    }

    // Update debate UI
    function updateDebateUI(result) {
      const lastRound = result.rounds[result.rounds.length - 1];

      // Update round indicator
      const dots = roundDots.querySelectorAll('.round-dot');
      result.rounds.forEach((r, i) => {
        if (dots[i]) {
          dots[i].classList.add('completed');
        }
      });
      roundText.textContent = `Round ${result.rounds.length}/${config.maxRounds}`;

      // Update LLM cards
      lastRound.results.forEach(r => {
        const card = document.getElementById(`card-${r.llmId}`);
        if (!card) return;

        card.classList.add('active');
        const status = document.getElementById(`status-${r.llmId}`);
        const position = document.getElementById(`position-${r.llmId}`);
        const confValue = document.getElementById(`conf-value-${r.llmId}`);
        const confFill = document.getElementById(`conf-fill-${r.llmId}`);
        const argument = document.getElementById(`argument-${r.llmId}`);

        if (r.error) {
          status.innerHTML = '<span style="color: var(--error)">Error</span>';
          position.innerHTML = `<div class="position-label">Error</div><div class="position-text" style="color: var(--error)">${r.reasoning}</div>`;
        } else {
          status.innerHTML = '<span style="color: var(--success)">Done</span>';
          position.innerHTML = `
            <div class="position-label">
              Position ${r.changed ? '<span class="changed-tag">Changed</span>' : ''}
            </div>
            <div class="position-text">${r.position}</div>
          `;
          confValue.textContent = `${r.confidence}/10`;
          confFill.style.width = `${r.confidence * 10}%`;
          if (r.key_argument) {
            argument.textContent = `"${r.key_argument}"`;
          }
        }
      });

      // Show alternatives panel
      if (document.getElementById('showAlternativesCard')?.dataset.active === 'true') {
        showAlternatives(result);
      }
    }

    // Show alternatives
    function showAlternatives(result) {
      const consensus = result.finalConsensus;
      if (!consensus.positions || consensus.positions.length === 0) return;

      alternativesPanel.classList.add('active');
      alternativesGrid.innerHTML = consensus.positions.map((pos, i) => `
        <div class="alternative-item ${i === 0 ? 'majority' : ''}">
          <div class="alternative-votes">
            <div class="vote-count">${pos.count}</div>
            <div class="vote-label">vote${pos.count > 1 ? 's' : ''}</div>
          </div>
          <div class="alternative-content">
            <div class="alternative-position">${pos.position}</div>
            <div class="alternative-supporters">${pos.responses.map(r => r.llmName).join(', ')}</div>
          </div>
        </div>
      `).join('');
    }

    // Show result
    function showResult(result) {
      const consensus = result.finalConsensus;
      const lastRound = result.rounds[result.rounds.length - 1];
      const allResults = lastRound?.results?.filter(r => !r.error) || [];

      // Get the structured decision
      const decision = consensus.decision || consensus.majority?.decision || 'UNKNOWN';
      const decisionClass = decision.toLowerCase();
      const decisionIcons = {
        'yes': '&#x2713;',
        'no': '&#x2717;',
        'conditional': '&#x26A1;',
        'wait': '&#x23F3;',
        'alternative': '&#x2194;',
        'unknown': '?'
      };

      // Update verdict icon and decision
      const verdictIcon = document.getElementById('verdictIcon');
      verdictIcon.className = `verdict-icon ${decisionClass}`;
      verdictIcon.innerHTML = decisionIcons[decisionClass] || '?';

      document.getElementById('verdictDecision').textContent = decision;

      // Update consensus badge
      const verdictConsensus = document.getElementById('verdictConsensus');
      const totalAIs = allResults.length;
      if (consensus.reached) {
        verdictConsensus.className = 'verdict-consensus';
        verdictConsensus.innerHTML = `<span>&#x2713;</span> ${consensus.type === 'unanimous' ? `All ${totalAIs} AIs Agree` : `${totalAIs - 1} of ${totalAIs} AIs Agree`}`;
      } else {
        verdictConsensus.className = 'verdict-consensus split';
        verdictConsensus.innerHTML = `<span>&#x26A0;</span> Split Decision (${consensus.majority?.count || 0} of ${totalAIs})`;
      }

      // Update summary - use action plan executive summary if available, else position
      const summary = result.actionPlan?.executive_summary || consensus.position || consensus.majority?.position || 'Analysis complete.';
      document.getElementById('verdictSummary').textContent = summary;

      // Update confidence gauge
      const confidence = consensus.confidence || consensus.majority?.confidence || 5;
      const confidencePercent = confidence * 10;
      document.getElementById('gaugeCircle').style.setProperty('--confidence', confidencePercent);
      document.getElementById('gaugeValue').textContent = confidence;

      const gaugeSubtitle = document.getElementById('gaugeSubtitle');
      if (confidence >= 8) {
        gaugeSubtitle.textContent = 'High confidence recommendation';
      } else if (confidence >= 6) {
        gaugeSubtitle.textContent = 'Moderate confidence';
      } else {
        gaugeSubtitle.textContent = 'Consider more research';
      }

      // Update AI agreement section with key arguments
      const keyInsights = document.getElementById('keyInsights');
      const insights = allResults
        .filter(r => r.key_argument)
        .map(r => `<div class="key-insight">
          <div class="key-insight-icon">&#x2713;</div>
          <div class="key-insight-text"><strong>${r.llmName}:</strong> ${r.key_argument}</div>
        </div>`)
        .join('');
      keyInsights.innerHTML = insights || '<div class="key-insight"><div class="key-insight-text">No detailed arguments available.</div></div>';

      // Update AI agreement title based on consensus
      const aiTitle = document.getElementById('aiAgreementTitle');
      aiTitle.textContent = consensus.reached ? 'Why All AIs Agreed' : 'Different Perspectives';

      resultCard.classList.add('active');
      resultCard.scrollIntoView({ behavior: 'smooth', block: 'center' });

      // Render action plan if available
      if (result.actionPlan) {
        renderActionPlan(result.actionPlan);
      }
    }

    // Render the action plan
    function renderActionPlan(plan) {
      const actionPlanEl = document.getElementById('actionPlan');

      // Executive summary
      document.getElementById('executiveSummary').textContent = plan.executive_summary || 'No summary available.';

      // Immediate actions
      const immediateActions = document.getElementById('immediateActions');
      immediateActions.innerHTML = (plan.immediate_actions || [])
        .map(action => `<li>${action}</li>`)
        .join('') || '<li>No immediate actions specified</li>';

      // Before proceeding
      const beforeProceeding = document.getElementById('beforeProceeding');
      beforeProceeding.innerHTML = (plan.before_proceeding || [])
        .map(item => `<li>${item}</li>`)
        .join('') || '<li>Ready to proceed</li>';

      // Risk mitigation
      const riskMitigation = document.getElementById('riskMitigation');
      riskMitigation.innerHTML = (plan.risk_mitigation || [])
        .map(risk => `<li>${risk}</li>`)
        .join('') || '<li>No specific risks identified</li>';

      // Success indicators
      const successIndicators = document.getElementById('successIndicators');
      successIndicators.innerHTML = (plan.success_indicators || [])
        .map(indicator => `<li>${indicator}</li>`)
        .join('') || '<li>Monitor outcomes</li>';

      // Timeline suggestion
      document.getElementById('timelineSuggestion').textContent =
        plan.timeline_suggestion || 'No specific timeline suggested.';

      // Dissenting view (only show if there's content)
      const dissentBox = document.getElementById('dissentBox');
      const dissentText = document.getElementById('dissentText');
      if (plan.dissenting_view_summary && plan.dissenting_view_summary.trim()) {
        dissentText.textContent = plan.dissenting_view_summary;
        dissentBox.style.display = 'block';
      } else {
        dissentBox.style.display = 'none';
      }

      // Show the action plan with animation
      actionPlanEl.classList.add('active');
    }

    // Load history
    async function loadHistory() {
      try {
        const res = await fetch('/api/history');
        historyData = await res.json();

        if (historyData.length === 0) {
          historyGrid.innerHTML = `
            <div class="empty-state">
              <div class="empty-icon"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2"></path><rect x="9" y="3" width="6" height="4" rx="1"></rect></svg></div>
              <p>No decisions yet. Start your first debate!</p>
            </div>
          `;
          return;
        }

        historyGrid.innerHTML = historyData.map((item, index) => {
          const date = new Date(item.timestamp);
          const day = date.getDate();
          const month = date.toLocaleString('en', { month: 'short' });
          const consensus = item.finalConsensus;
          const position = consensus?.position || consensus?.majority?.position || 'N/A';

          return `
            <div class="history-card" onclick="showHistoryDetail(${index})">
              <div class="history-date">
                <div class="history-day">${day}</div>
                <div class="history-month">${month}</div>
              </div>
              <div class="history-content">
                <div class="history-question">${item.question}</div>
                <div class="history-answer">${position}</div>
                <div class="history-meta">
                  <span class="history-tag ${consensus?.reached ? 'consensus' : 'split'}">
                    ${consensus?.reached ? consensus.type : 'Split'}
                  </span>
                  <span class="history-tag cost">$${(item.totalCost || 0).toFixed(4)}</span>
                </div>
              </div>
            </div>
          `;
        }).join('');
      } catch (err) {
        console.error('Failed to load history:', err);
      }
    }

    // Show history detail
    function showHistoryDetail(index) {
      const item = historyData[index];
      if (!item) return;

      const modalBody = document.getElementById('modalBody');
      const consensus = item.finalConsensus;

      modalBody.innerHTML = `
        <div class="modal-section">
          <div class="modal-section-title">Question</div>
          <div class="modal-question">${item.question}</div>
          ${item.context ? `<div class="modal-context">${item.context}</div>` : ''}
        </div>

        <div class="modal-section">
          <div class="modal-section-title">Final Decision</div>
          <div class="result-badge ${consensus?.reached ? '' : 'split'}" style="margin-bottom: 1rem">
            ${consensus?.reached ? ` ${consensus.type}` : ' Split Decision'}
          </div>
          <div class="modal-question">${consensus?.position || consensus?.majority?.position || 'N/A'}</div>
        </div>

        <div class="modal-section">
          <div class="modal-section-title">Debate Rounds</div>
          ${(item.rounds || []).map((round, i) => `
            <div class="modal-round">
              <div class="modal-round-header">Round ${i + 1}</div>
              ${round.results.filter(r => !r.error).map(r => `
                <div class="modal-position">
                  <span class="modal-position-llm">${r.llmName}:</span>
                  <span>${r.position}</span>
                </div>
              `).join('')}
            </div>
          `).join('')}
        </div>
      `;

      document.getElementById('historyModal').classList.add('active');
    }

    // Close modal
    function closeModal() {
      document.getElementById('historyModal').classList.remove('active');
    }

    // Update stats
    function updateStats() {
      const total = historyData.length;
      const consensusCount = historyData.filter(d => d.finalConsensus?.reached).length;
      const totalCost = historyData.reduce((sum, d) => sum + (d.totalCost || 0), 0);
      const avgCost = total > 0 ? totalCost / total : 0;

      document.getElementById('statDecisions').textContent = total;
      document.getElementById('statConsensus').textContent = total > 0 ? `${Math.round(consensusCount / total * 100)}%` : '0%';
      document.getElementById('statCost').textContent = `$${avgCost.toFixed(2)}`;
    }

    // Export functions
    function exportPDF() {
      showToast('Export feature coming in Pro plan', 'success');
    }

    function copyShareLink() {
      if (!currentResult || !currentResult.shareId) {
        showToast('No debate to share yet', 'error');
        return;
      }

      const shareUrl = `${window.location.origin}/share/${currentResult.shareId}`;

      navigator.clipboard.writeText(shareUrl).then(() => {
        showToast('Share link copied to clipboard!', 'success');
      }).catch(() => {
        // Fallback for older browsers
        const textarea = document.createElement('textarea');
        textarea.value = shareUrl;
        document.body.appendChild(textarea);
        textarea.select();
        document.execCommand('copy');
        document.body.removeChild(textarea);
        showToast('Share link copied to clipboard!', 'success');
      });
    }

    function askFollowup() {
      document.getElementById('followupSection').classList.add('active');
      document.getElementById('followupInput').focus();
    }

    // Build rich context from previous debate for follow-up
    function buildFollowupContext() {
      if (!currentResult) return '';

      const parts = [];

      // Original question
      parts.push(`## Original Question\n${currentResult.question}`);

      // Final consensus/decision
      const consensus = currentResult.finalConsensus;
      if (consensus) {
        const decision = consensus.position || consensus.majority?.position || 'No clear decision';
        const consensusType = consensus.reached
          ? `${consensus.type} consensus (${consensus.confidence}/10 confidence)`
          : 'Split decision';
        parts.push(`## Previous Decision\n${decision}\n(${consensusType})`);
      }

      // Key arguments from each LLM in the final round
      const lastRound = currentResult.rounds?.[currentResult.rounds.length - 1];
      if (lastRound?.results) {
        const llmSummaries = lastRound.results
          .filter(r => !r.error)
          .map(r => {
            let summary = `**${r.llmName}**: ${r.position}`;
            if (r.key_argument) {
              summary += `\n  - Key argument: "${r.key_argument}"`;
            }
            if (r.risks && r.risks.length > 0) {
              summary += `\n  - Risks identified: ${r.risks.join(', ')}`;
            }
            return summary;
          })
          .join('\n\n');

        parts.push(`## Individual AI Positions\n${llmSummaries}`);
      }

      // Any dissenting opinions (if split decision)
      if (!consensus?.reached && consensus?.positions) {
        const dissent = consensus.positions
          .slice(1) // Skip majority
          .map(p => `- ${p.position} (${p.count} vote${p.count > 1 ? 's' : ''})`)
          .join('\n');
        if (dissent) {
          parts.push(`## Alternative Viewpoints\n${dissent}`);
        }
      }

      return parts.join('\n\n---\n\n');
    }

    function submitFollowup() {
      const followupQ = document.getElementById('followupInput').value.trim();
      if (!followupQ) return;

      // Set the follow-up as the new question
      questionInput.value = followupQ;

      // Build rich context from the previous debate
      const richContext = buildFollowupContext();
      contextInput.value = `This is a FOLLOW-UP question to a previous AI debate. Please consider the previous discussion when forming your position.\n\n${richContext}`;

      document.getElementById('followupSection').classList.remove('active');
      document.getElementById('followupInput').value = ''; // Clear for next time
      debateForm.dispatchEvent(new Event('submit'));
    }

    // Loading
    function showLoading(text, subtext) {
      loadingText.textContent = text;
      loadingSubstatus.textContent = subtext;
      loadingOverlay.classList.add('active');
    }

    function hideLoading() {
      loadingOverlay.classList.remove('active');
    }

    // Toast
    function showToast(message, type = 'success') {
      toast.textContent = message;
      toast.className = `toast ${type} show`;
      setTimeout(() => toast.classList.remove('show'), 3000);
    }

    // Click outside modal to close
    document.getElementById('historyModal').addEventListener('click', (e) => {
      if (e.target.id === 'historyModal') closeModal();
    });

    // Initialize
    init();
  </script>

  <!-- Site Footer -->
  <footer class="site-footer">
    <div class="footer-content">
      <div class="footer-brand">
        <div class="footer-brand-icon">C</div>
        <span>ConsensusAI</span>
      </div>
      <div class="footer-links">
        <a href="/terms.html">Terms of Service</a>
        <a href="/privacy.html">Privacy Policy</a>
        <a href="/disclaimer.html">AI Disclaimer</a>
        <a href="mailto:support@consensus-ai.com">Contact</a>
      </div>
      <div class="footer-copyright">
        &copy; 2025 ConsensusAI. All rights reserved.
      </div>
      <div class="footer-disclaimer">
        AI recommendations are for informational purposes only and do not constitute professional advice.
        Always consult qualified professionals before making important decisions.
        <a href="/disclaimer.html" style="color: var(--accent-primary);">Read full disclaimer</a>
      </div>
    </div>
  </footer>
</body>
</html>
