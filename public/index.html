<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ConsensusAI | 4 AIs Debate Your Decisions</title>

    <!-- SEO Meta Tags -->
    <meta name="description" content="Let 4 AI models (GPT, Claude, Gemini, Grok) debate your decisions and reach consensus. Get smarter answers through multi-AI deliberation.">
    <meta name="keywords" content="AI decision making, GPT-4, Claude, Gemini, Grok, AI debate, AI consensus, multi-AI, decision intelligence">
    <meta name="author" content="ConsensusAI">
    <meta name="robots" content="index, follow">
    <link rel="canonical" href="https://consensusai.app/cortex.html">

    <!-- Open Graph / Social Media -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://consensusai.app/">
    <meta property="og:title" content="ConsensusAI | 4 AIs Debate Your Decisions">
    <meta property="og:description" content="Let 4 AI models (GPT, Claude, Gemini, Grok) debate your decisions and reach consensus. Get smarter answers through multi-AI deliberation.">
    <meta property="og:image" content="https://consensusai.app/og-image.png">
    <meta property="og:site_name" content="ConsensusAI">

    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="ConsensusAI | 4 AIs Debate Your Decisions">
    <meta name="twitter:description" content="Let 4 AI models debate your decisions and reach consensus.">
    <meta name="twitter:image" content="https://consensusai.app/og-image.png">

    <!-- Premium Typography -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Space+Grotesk:wght@400;500;600;700&display=swap" rel="stylesheet">

    <style>
        /* ============================================
           THE LIVING CORTEX - Bioluminescent Theme
           Premium Decision Intelligence Interface
           ============================================ */

        :root {
            /* Deep Space Background */
            --bg-deep: #030304;
            --bg-void: #000000;
            --bg-radial: radial-gradient(ellipse at 50% 0%, #0a0a1a 0%, #030304 50%, #000000 100%);

            /* Glassmorphism */
            --glass-surface: rgba(255, 255, 255, 0.02);
            --glass-border: rgba(255, 255, 255, 0.06);
            --glass-glow: rgba(255, 255, 255, 0.08);

            /* AI Brand Colors (Neon) */
            --ai-gpt: #10a37f;
            --ai-gemini: #4285f4;
            --ai-grok: #f97316;
            --ai-claude: #d97706;

            /* Core Accent */
            --core-primary: #6366f1;
            --core-secondary: #8b5cf6;
            --core-glow: rgba(99, 102, 241, 0.5);

            /* Semantic */
            --success: #10b981;
            --warning: #f59e0b;
            --error: #ef4444;
            --conflict: #ff3333;
            --merge: #00e5ff;

            /* Typography */
            --text-primary: #ededed;
            --text-secondary: #a1a1aa;
            --text-muted: #666666;

            --font-hero: 'Space Grotesk', sans-serif;
            --font-body: 'Inter', sans-serif;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }

        html, body {
            height: 100%;
            height: 100dvh; /* Dynamic viewport height for mobile keyboards */
            overflow: hidden;
        }

        body {
            font-family: var(--font-body);
            background: var(--bg-deep);
            background-image: var(--bg-radial);
            color: var(--text-primary);
            -webkit-font-smoothing: antialiased;
        }

        /* ============================================
           CUSTOM TOOLTIPS - Clean & Professional
           ============================================ */

        /* Elements with tooltips - subtle underline indicator */
        [data-tooltip] {
            position: relative;
            cursor: help;
        }

        /* Subtle dotted underline for elements with tooltips */
        [data-tooltip]:not([data-tooltip-indicator="none"]) {
            border-bottom: 1px dotted rgba(99, 102, 241, 0.5);
        }

        /* The tooltip popup */
        [data-tooltip]::after {
            content: attr(data-tooltip);
            position: absolute;
            bottom: calc(100% + 10px);
            left: 50%;
            transform: translateX(-50%) translateY(5px);
            background: rgba(15, 15, 20, 0.95);
            backdrop-filter: blur(20px);
            color: var(--text-primary);
            padding: 10px 14px;
            border-radius: 8px;
            border: 1px solid rgba(99, 102, 241, 0.2);
            font-size: 12px;
            font-weight: 400;
            line-height: 1.5;
            max-width: 260px;
            min-width: 180px;
            white-space: normal;
            text-align: left;
            box-shadow:
                0 8px 32px rgba(0, 0, 0, 0.4),
                0 0 0 1px rgba(255, 255, 255, 0.05);
            opacity: 0;
            visibility: hidden;
            transition: all 0.15s ease;
            z-index: 1000;
            pointer-events: none;
        }

        /* Tooltip arrow */
        [data-tooltip]::before {
            content: '';
            position: absolute;
            bottom: calc(100% + 4px);
            left: 50%;
            transform: translateX(-50%);
            border: 6px solid transparent;
            border-top-color: rgba(15, 15, 20, 0.95);
            opacity: 0;
            visibility: hidden;
            transition: all 0.15s ease;
            z-index: 1001;
        }

        /* Show tooltip on hover */
        [data-tooltip]:hover::after {
            opacity: 1;
            visibility: visible;
            transform: translateX(-50%) translateY(0);
        }

        [data-tooltip]:hover::before {
            opacity: 1;
            visibility: visible;
        }

        /* Tooltip positioning - bottom */
        [data-tooltip-pos="bottom"]::after {
            bottom: auto;
            top: calc(100% + 10px);
            transform: translateX(-50%) translateY(-5px);
        }

        [data-tooltip-pos="bottom"]:hover::after {
            transform: translateX(-50%) translateY(0);
        }

        [data-tooltip-pos="bottom"]::before {
            bottom: auto;
            top: calc(100% + 4px);
            border-top-color: transparent;
            border-bottom-color: rgba(15, 15, 20, 0.95);
        }

        /* Tooltip positioning - left */
        [data-tooltip-pos="left"]::after {
            left: auto;
            right: calc(100% + 10px);
            bottom: auto;
            top: 50%;
            transform: translateY(-50%) translateX(5px);
        }

        [data-tooltip-pos="left"]:hover::after {
            transform: translateY(-50%) translateX(0);
        }

        [data-tooltip-pos="left"]::before {
            left: auto;
            right: calc(100% + 4px);
            bottom: auto;
            top: 50%;
            transform: translateY(-50%);
            border-top-color: transparent;
            border-left-color: rgba(15, 15, 20, 0.95);
        }

        /* No indicator for certain elements */
        [data-tooltip-indicator="none"] {
            border-bottom: none !important;
        }

        /* ============================================
           NEBULA BACKGROUND
           ============================================ */

        .nebula-bg {
            position: fixed;
            inset: 0;
            z-index: 0;
            pointer-events: none;
            overflow: hidden;
        }

        .nebula-cloud {
            position: absolute;
            border-radius: 50%;
            filter: blur(100px);
            opacity: 0.3;
            animation: nebulaDrift 30s ease-in-out infinite;
        }

        .cloud-1 {
            width: 600px;
            height: 600px;
            background: radial-gradient(circle, rgba(99, 102, 241, 0.2) 0%, transparent 70%);
            top: -200px;
            left: 30%;
            animation-delay: 0s;
        }

        .cloud-2 {
            width: 400px;
            height: 400px;
            background: radial-gradient(circle, rgba(139, 92, 246, 0.15) 0%, transparent 70%);
            bottom: -100px;
            right: 20%;
            animation-delay: -10s;
        }

        .cloud-3 {
            width: 300px;
            height: 300px;
            background: radial-gradient(circle, rgba(16, 163, 127, 0.1) 0%, transparent 70%);
            top: 40%;
            left: 10%;
            animation-delay: -20s;
        }

        @keyframes nebulaDrift {
            0%, 100% { transform: translate(0, 0) scale(1); }
            25% { transform: translate(30px, -20px) scale(1.05); }
            50% { transform: translate(-20px, 30px) scale(0.95); }
            75% { transform: translate(-30px, -10px) scale(1.02); }
        }

        /* ============================================
           MAIN CONTAINER
           ============================================ */

        .cortex-app {
            position: relative;
            z-index: 1;
            height: 100vh;
            height: 100dvh; /* Dynamic viewport height for mobile keyboards */
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        /* ============================================
           THE LIVING ORB (Central Core)
           ============================================ */

        .cortex-arena {
            position: relative;
            width: 100%;
            max-width: 1000px;
            min-height: 480px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 30px;
            padding: 0 20px;
        }

        .cortex-arena.debating {
            justify-content: center;
        }

        .core-orb {
            position: relative;
            width: 160px;
            height: 160px;
            border-radius: 50%;
            background: radial-gradient(circle at 30% 30%, var(--core-primary), #1a1a2e, #000);
            box-shadow:
                0 0 80px rgba(99, 102, 241, 0.4),
                0 0 120px rgba(99, 102, 241, 0.2),
                inset 0 0 60px rgba(99, 102, 241, 0.6);
            z-index: 10;
            animation: breathe 4s ease-in-out infinite;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: default;
            transition: all 0.5s ease;
        }

        .core-orb.thinking {
            animation: breathe 2s ease-in-out infinite;
        }

        .core-orb.conflict {
            background: radial-gradient(circle at 30% 30%, var(--conflict), #2a1a1a, #000);
            box-shadow:
                0 0 80px rgba(255, 51, 51, 0.5),
                inset 0 0 60px rgba(255, 51, 51, 0.4);
            animation: shake 0.5s ease-in-out infinite, breathe 2s ease-in-out infinite;
        }

        .core-orb.merging {
            background: radial-gradient(circle at 30% 30%, var(--merge), #1a2a2a, #000);
            box-shadow:
                0 0 80px rgba(0, 229, 255, 0.5),
                inset 0 0 60px rgba(0, 229, 255, 0.4);
        }

        .core-orb.consensus {
            background: radial-gradient(circle at 30% 30%, var(--success), #1a2a1a, #000);
            box-shadow:
                0 0 100px rgba(16, 185, 129, 0.5),
                inset 0 0 60px rgba(16, 185, 129, 0.4);
            animation: consensusPulse 2s ease-in-out infinite;
        }

        @keyframes breathe {
            0%, 100% {
                transform: scale(1);
                filter: brightness(1);
            }
            50% {
                transform: scale(1.08);
                filter: brightness(1.2);
            }
        }

        @keyframes shake {
            0%, 100% { transform: translate(0, 0) scale(1); }
            10% { transform: translate(-2px, -1px) scale(1.02); }
            20% { transform: translate(2px, 1px) scale(0.98); }
            30% { transform: translate(-1px, 2px) scale(1.01); }
            40% { transform: translate(1px, -2px) scale(0.99); }
            50% { transform: translate(-2px, 1px) scale(1.02); }
            60% { transform: translate(2px, -1px) scale(0.98); }
            70% { transform: translate(-1px, -2px) scale(1.01); }
            80% { transform: translate(1px, 2px) scale(0.99); }
            90% { transform: translate(-2px, -1px) scale(1); }
        }

        @keyframes consensusPulse {
            0%, 100% {
                transform: scale(1);
                box-shadow: 0 0 100px rgba(16, 185, 129, 0.5), inset 0 0 60px rgba(16, 185, 129, 0.4);
            }
            50% {
                transform: scale(1.05);
                box-shadow: 0 0 140px rgba(16, 185, 129, 0.7), inset 0 0 80px rgba(16, 185, 129, 0.5);
            }
        }

        .core-text {
            font-family: var(--font-hero);
            font-size: 0.875rem;
            font-weight: 600;
            letter-spacing: 2px;
            text-transform: uppercase;
            color: rgba(255, 255, 255, 0.9);
            text-shadow: 0 0 20px currentColor;
        }

        /* ============================================
           AI NODES (Corner Positions)
           ============================================ */

        .ai-node {
            position: absolute;
            width: 56px;
            height: 56px;
            border-radius: 50%;
            background: linear-gradient(135deg, rgba(60, 60, 75, 0.98) 0%, rgba(25, 25, 35, 0.98) 50%, rgba(15, 15, 20, 0.98) 100%);
            backdrop-filter: blur(10px);
            border: 3px solid;
            border-color: var(--glass-border);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 15;
            transition: all 0.4s ease;
            cursor: default;
            /* Enhanced 3D Effect with complete ring */
            box-shadow:
                /* Inner bevel - top */
                inset 0 3px 6px rgba(255, 255, 255, 0.2),
                /* Inner shadow - bottom */
                inset 0 -3px 6px rgba(0, 0, 0, 0.4),
                /* Complete outer ring glow */
                0 0 0 2px rgba(255, 255, 255, 0.05),
                /* Depth shadow */
                0 6px 20px rgba(0, 0, 0, 0.5),
                0 3px 8px rgba(0, 0, 0, 0.4),
                /* Subtle ambient glow */
                0 0 20px rgba(99, 102, 241, 0.2);
            transform-style: preserve-3d;
            transform: translateZ(0);
        }

        .ai-node svg {
            width: 24px;
            height: 24px;
            fill: currentColor;
            filter: drop-shadow(0 2px 3px rgba(0, 0, 0, 0.4));
        }

        /* 3D Highlight Ring - glossy sphere effect */
        .ai-node::before {
            content: '';
            position: absolute;
            top: 4px;
            left: 15%;
            width: 70%;
            height: 40%;
            background: linear-gradient(180deg, rgba(255, 255, 255, 0.25) 0%, rgba(255, 255, 255, 0.08) 50%, transparent 100%);
            border-radius: 50% 50% 50% 50% / 100% 100% 40% 40%;
            pointer-events: none;
            z-index: 1;
        }

        /* Bottom reflection for 3D depth */
        .ai-node::after {
            content: '';
            position: absolute;
            bottom: 3px;
            left: 20%;
            width: 60%;
            height: 15%;
            background: linear-gradient(0deg, rgba(255, 255, 255, 0.08) 0%, transparent 100%);
            border-radius: 50%;
            pointer-events: none;
        }

        .node-label {
            font-family: var(--font-hero);
            font-size: 0.75rem;
            font-weight: 700;
            letter-spacing: 0.5px;
            text-transform: uppercase;
        }

        .node-gpt {
            border-color: var(--ai-gpt);
            color: var(--ai-gpt);
            background: linear-gradient(135deg,
                rgba(16, 163, 127, 0.25) 0%,
                rgba(16, 163, 127, 0.1) 25%,
                rgba(15, 15, 20, 0.95) 60%,
                rgba(8, 8, 12, 0.98) 100%);
            box-shadow:
                inset 0 3px 6px rgba(16, 163, 127, 0.3),
                inset 0 -3px 6px rgba(0, 0, 0, 0.4),
                0 0 0 2px rgba(16, 163, 127, 0.15),
                0 6px 20px rgba(0, 0, 0, 0.4),
                0 0 25px rgba(16, 163, 127, 0.3);
        }
        .node-gemini {
            border-color: var(--ai-gemini);
            color: var(--ai-gemini);
            background: linear-gradient(135deg,
                rgba(66, 133, 244, 0.25) 0%,
                rgba(66, 133, 244, 0.1) 25%,
                rgba(15, 15, 20, 0.95) 60%,
                rgba(8, 8, 12, 0.98) 100%);
            box-shadow:
                inset 0 3px 6px rgba(66, 133, 244, 0.3),
                inset 0 -3px 6px rgba(0, 0, 0, 0.4),
                0 0 0 2px rgba(66, 133, 244, 0.15),
                0 6px 20px rgba(0, 0, 0, 0.4),
                0 0 25px rgba(66, 133, 244, 0.3);
        }
        .node-claude {
            border-color: var(--ai-claude);
            color: var(--ai-claude);
            background: linear-gradient(135deg,
                rgba(217, 119, 6, 0.25) 0%,
                rgba(217, 119, 6, 0.1) 25%,
                rgba(15, 15, 20, 0.95) 60%,
                rgba(8, 8, 12, 0.98) 100%);
            box-shadow:
                inset 0 3px 6px rgba(217, 119, 6, 0.3),
                inset 0 -3px 6px rgba(0, 0, 0, 0.4),
                0 0 0 2px rgba(217, 119, 6, 0.15),
                0 6px 20px rgba(0, 0, 0, 0.4),
                0 0 25px rgba(217, 119, 6, 0.3);
        }
        .node-grok {
            border-color: var(--ai-grok);
            color: var(--ai-grok);
            background: linear-gradient(135deg,
                rgba(249, 115, 22, 0.25) 0%,
                rgba(249, 115, 22, 0.1) 25%,
                rgba(15, 15, 20, 0.95) 60%,
                rgba(8, 8, 12, 0.98) 100%);
            box-shadow:
                inset 0 3px 6px rgba(249, 115, 22, 0.3),
                inset 0 -3px 6px rgba(0, 0, 0, 0.4),
                0 0 0 2px rgba(249, 115, 22, 0.15),
                0 6px 20px rgba(0, 0, 0, 0.4),
                0 0 25px rgba(249, 115, 22, 0.3);
        }

        .ai-node.active {
            transform: scale(1.15) translateZ(10px);
            animation: node-pulse 1.5s ease-in-out infinite;
            z-index: 20;
            border-width: 3px;
        }

        .ai-node.active.node-gpt {
            box-shadow:
                inset 0 4px 10px rgba(16, 163, 127, 0.5),
                inset 0 -4px 10px rgba(0, 0, 0, 0.4),
                0 0 0 3px rgba(16, 163, 127, 0.4),
                0 0 50px var(--ai-gpt),
                0 0 80px rgba(16, 163, 127, 0.5),
                0 8px 25px rgba(0, 0, 0, 0.5);
        }
        .ai-node.active.node-gemini {
            box-shadow:
                inset 0 4px 10px rgba(66, 133, 244, 0.5),
                inset 0 -4px 10px rgba(0, 0, 0, 0.4),
                0 0 0 3px rgba(66, 133, 244, 0.4),
                0 0 50px var(--ai-gemini),
                0 0 80px rgba(66, 133, 244, 0.5),
                0 8px 25px rgba(0, 0, 0, 0.5);
        }
        .ai-node.active.node-claude {
            box-shadow:
                inset 0 4px 10px rgba(217, 119, 6, 0.5),
                inset 0 -4px 10px rgba(0, 0, 0, 0.4),
                0 0 0 3px rgba(217, 119, 6, 0.4),
                0 0 50px var(--ai-claude),
                0 0 80px rgba(217, 119, 6, 0.5),
                0 8px 25px rgba(0, 0, 0, 0.5);
        }
        .ai-node.active.node-grok {
            box-shadow:
                inset 0 4px 10px rgba(249, 115, 22, 0.5),
                inset 0 -4px 10px rgba(0, 0, 0, 0.4),
                0 0 0 3px rgba(249, 115, 22, 0.4),
                0 0 50px var(--ai-grok),
                0 0 80px rgba(249, 115, 22, 0.5),
                0 8px 25px rgba(0, 0, 0, 0.5);
        }

        /* Spinning ring effect when active - outer ring */
        .ai-node.active::before {
            content: '';
            position: absolute;
            inset: -8px;
            border-radius: 50%;
            border: 2px solid transparent;
            border-top-color: currentColor;
            border-right-color: currentColor;
            animation: node-spin 0.8s linear infinite;
            filter: drop-shadow(0 0 4px currentColor);
        }

        /* Active state replaces the 3D highlight with spinning inner ring */
        .ai-node.active::after {
            content: '';
            position: absolute;
            inset: -14px;
            border-radius: 50%;
            border: 1px solid transparent;
            border-bottom-color: currentColor;
            border-left-color: currentColor;
            opacity: 0.6;
            animation: node-spin-reverse 1.2s linear infinite;
            top: auto;
            left: auto;
            width: auto;
            height: auto;
            background: none;
        }

        @keyframes node-spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        @keyframes node-spin-reverse {
            0% { transform: rotate(360deg); }
            100% { transform: rotate(0deg); }
        }

        @keyframes node-pulse {
            0%, 100% { transform: scale(1.15) translateZ(10px); }
            50% { transform: scale(1.25) translateZ(15px); }
        }

        /* Hover Label Slide-out */
        .ai-node .node-name {
            position: absolute;
            white-space: nowrap;
            font-family: var(--font-hero);
            font-size: 0.6875rem;
            font-weight: 600;
            letter-spacing: 0.5px;
            text-transform: uppercase;
            color: currentColor;
            background: rgba(0, 0, 0, 0.9);
            padding: 6px 12px;
            border-radius: 6px;
            opacity: 0;
            transform: scale(0.8);
            transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
            pointer-events: none;
        }

        .node-gpt .node-name { left: 100%; margin-left: 12px; }
        .node-gemini .node-name { right: 100%; margin-right: 12px; }
        .node-claude .node-name { left: 100%; margin-left: 12px; }
        .node-grok .node-name { right: 100%; margin-right: 12px; }

        .ai-node:hover .node-name {
            opacity: 1;
            transform: scale(1);
        }

        /* Subtle hover lift effect for 3D feel */
        .ai-node:not(.active):hover {
            transform: scale(1.08) translateY(-2px);
            box-shadow:
                inset 3px 3px 8px rgba(255, 255, 255, 0.12),
                inset -3px -3px 8px rgba(0, 0, 0, 0.4),
                0 10px 30px rgba(0, 0, 0, 0.5),
                0 5px 15px rgba(0, 0, 0, 0.4),
                0 0 25px var(--glass-border);
        }

        /* Merge Animation - Nodes pull toward center */
        .ai-node.merging {
            animation: pullToCenter 1.5s ease-in-out infinite;
        }

        .node-gpt.merging { animation-name: pullGpt; }
        .node-gemini.merging { animation-name: pullGemini; }
        .node-claude.merging { animation-name: pullClaude; }
        .node-grok.merging { animation-name: pullGrok; }

        @keyframes pullGpt {
            0%, 100% { transform: translate(0, 0) scale(1); }
            50% { transform: translate(40px, 40px) scale(0.9); }
        }

        @keyframes pullGemini {
            0%, 100% { transform: translate(0, 0) scale(1); }
            50% { transform: translate(-40px, 40px) scale(0.9); }
        }

        @keyframes pullClaude {
            0%, 100% { transform: translate(0, 0) scale(1); }
            50% { transform: translate(40px, -40px) scale(0.9); }
        }

        @keyframes pullGrok {
            0%, 100% { transform: translate(0, 0) scale(1); }
            50% { transform: translate(-40px, -40px) scale(0.9); }
        }

        /* Energy stream particles during merge */
        .ai-node.merging::after {
            content: '';
            position: absolute;
            width: 8px;
            height: 8px;
            background: currentColor;
            border-radius: 50%;
            animation: particleStream 0.8s ease-out infinite;
            box-shadow: 0 0 10px currentColor;
        }

        @keyframes particleStream {
            0% { opacity: 1; transform: translate(0, 0) scale(1); }
            100% { opacity: 0; transform: translate(var(--particle-x), var(--particle-y)) scale(0.3); }
        }

        .node-gpt.merging::after { --particle-x: 80px; --particle-y: 80px; }
        .node-gemini.merging::after { --particle-x: -80px; --particle-y: 80px; }
        .node-claude.merging::after { --particle-x: 80px; --particle-y: -80px; }
        .node-grok.merging::after { --particle-x: -80px; --particle-y: -80px; }

        /* ============================================
           LIVE DEBATE STREAM (The USP)
           ============================================ */

        .debate-stream {
            position: relative;
            width: 380px;
            max-width: 45%;
            height: 420px;
            display: none; /* Hidden until debate starts */
            flex-direction: column;
            gap: 8px;
            overflow-y: auto;
            overflow-x: hidden;
            padding: 16px 12px;
            background: rgba(10, 10, 15, 0.7);
            border-radius: 16px;
            border: 1px solid var(--glass-border);
            flex-shrink: 0;
        }

        .debate-stream.active {
            display: flex;
        }

        .stream-header-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 14px;
            background: rgba(99, 102, 241, 0.15);
            border-bottom: 1px solid var(--glass-border);
            border-radius: 12px;
            margin-bottom: 8px;
            flex-shrink: 0;
        }

        .stream-title {
            font-family: var(--font-hero);
            font-size: 0.7rem;
            font-weight: 700;
            letter-spacing: 1px;
            text-transform: uppercase;
            color: var(--core-primary);
        }

        .stream-round {
            font-size: 0.65rem;
            color: var(--text-muted);
            background: rgba(255,255,255,0.08);
            padding: 3px 8px;
            border-radius: 12px;
        }

        .stream-content {
            flex: 1;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 8px;
            mask-image: linear-gradient(to bottom, black 85%, transparent 100%);
            -webkit-mask-image: linear-gradient(to bottom, black 85%, transparent 100%);
        }

        /* Core container for orb + nodes */
        .core-container {
            position: relative;
            width: 350px;
            height: 350px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }

        /* AI Nodes positioned relative to core-container */
        .core-container .ai-node {
            position: absolute;
        }

        .core-container .node-gpt { top: 20px; left: 20px; }
        .core-container .node-gemini { top: 20px; right: 20px; }
        .core-container .node-claude { bottom: 55px; left: 20px; }
        .core-container .node-grok { bottom: 55px; right: 20px; }

        .stream-entry {
            background: rgba(20, 20, 25, 0.9);
            backdrop-filter: blur(15px);
            border-left: 3px solid var(--glass-border);
            padding: 14px 18px;
            border-radius: 0 14px 14px 0;
            font-size: 0.9rem;
            line-height: 1.6;
            opacity: 0;
            transform: translateY(30px) scale(0.95);
            animation: streamFlyIn 0.5s forwards cubic-bezier(0.34, 1.56, 0.64, 1);
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.4);
            max-width: 85%;
        }

        /* Right-aligned entries for alternating feel */
        .stream-entry.align-right {
            align-self: flex-end;
            border-left: none;
            border-right: 3px solid var(--glass-border);
            border-radius: 14px 0 0 14px;
        }

        /* Brand colors */
        .stream-entry.entry-gpt { border-color: var(--ai-gpt); }
        .stream-entry.entry-gemini { border-color: var(--ai-gemini); }
        .stream-entry.entry-gemini { align-self: flex-end; border-left: none; border-right: 3px solid var(--ai-gemini); border-radius: 14px 0 0 14px; }
        .stream-entry.entry-claude { border-color: var(--ai-claude); }
        .stream-entry.entry-grok { border-color: var(--ai-grok); }
        .stream-entry.entry-grok { align-self: flex-end; border-left: none; border-right: 3px solid var(--ai-grok); border-radius: 14px 0 0 14px; }

        /* Conflict/Objection styling */
        .stream-entry.conflict {
            border-color: var(--error) !important;
            background: rgba(255, 51, 51, 0.1);
            box-shadow: 0 0 30px rgba(255, 51, 51, 0.2);
        }

        /* Revision styling */
        .stream-entry.revision {
            border-color: var(--merge) !important;
            background: rgba(0, 229, 255, 0.1);
        }

        .stream-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 8px;
        }

        .stream-model {
            font-family: var(--font-hero);
            font-size: 0.75rem;
            font-weight: 700;
            letter-spacing: 0.5px;
            text-transform: uppercase;
        }

        .stream-entry.entry-gpt .stream-model { color: var(--ai-gpt); }
        .stream-entry.entry-gemini .stream-model { color: var(--ai-gemini); }
        .stream-entry.entry-claude .stream-model { color: var(--ai-claude); }
        .stream-entry.entry-grok .stream-model { color: var(--ai-grok); }

        .stream-tag {
            font-size: 0.625rem;
            padding: 3px 8px;
            border-radius: 4px;
            background: rgba(255, 255, 255, 0.1);
            color: var(--text-muted);
            font-weight: 600;
            letter-spacing: 0.5px;
        }

        .stream-tag.objection {
            background: rgba(255, 51, 51, 0.2);
            color: var(--error);
        }

        .stream-tag.revision {
            background: rgba(0, 229, 255, 0.2);
            color: var(--merge);
        }

        .stream-tag.agree {
            background: rgba(16, 185, 129, 0.2);
            color: var(--success);
        }

        .stream-text {
            color: var(--text-secondary);
        }

        .stream-decision {
            display: inline-block;
            font-weight: 600;
            padding: 2px 8px;
            border-radius: 4px;
            margin-right: 6px;
        }

        .decision-yes { background: rgba(16, 185, 129, 0.2); color: var(--success); }
        .decision-no { background: rgba(239, 68, 68, 0.2); color: var(--error); }
        .decision-conditional { background: rgba(245, 158, 11, 0.2); color: var(--warning); }

        @keyframes streamFlyIn {
            to { opacity: 1; transform: translateY(0) scale(1); }
        }

        /* ============================================
           CONFLICT LASER BEAM
           ============================================ */

        .conflict-laser {
            position: absolute;
            top: 50%;
            left: 50%;
            height: 3px;
            background: linear-gradient(90deg, transparent, var(--error), transparent);
            width: 0;
            transform-origin: center;
            z-index: 5;
            box-shadow: 0 0 20px var(--error), 0 0 40px var(--error);
            opacity: 0;
            pointer-events: none;
        }

        .conflict-laser.active {
            animation: laserFire 0.6s ease-out forwards;
        }

        @keyframes laserFire {
            0% { width: 0; opacity: 1; }
            30% { width: 300px; opacity: 1; }
            100% { width: 300px; opacity: 0; }
        }

        /* ============================================
           SVG CONFLICT LINES (Node-to-Node)
           ============================================ */

        .conflict-lines-svg {
            position: absolute;
            inset: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 6;
        }

        .conflict-line {
            stroke: var(--error);
            stroke-width: 2;
            stroke-linecap: round;
            fill: none;
            filter: drop-shadow(0 0 8px var(--error)) drop-shadow(0 0 15px var(--error));
            stroke-dasharray: 8 4;
            opacity: 0;
        }

        .conflict-line.active {
            animation: conflictLineIn 0.8s ease-out forwards, conflictLinePulse 0.4s ease-in-out 0.3s 3;
        }

        @keyframes conflictLineIn {
            0% { stroke-dashoffset: 200; opacity: 0; }
            20% { opacity: 1; }
            100% { stroke-dashoffset: 0; opacity: 1; }
        }

        @keyframes conflictLinePulse {
            0%, 100% { stroke-width: 2; filter: drop-shadow(0 0 8px var(--error)); }
            50% { stroke-width: 4; filter: drop-shadow(0 0 20px var(--error)) drop-shadow(0 0 30px var(--error)); }
        }

        .conflict-line.fade-out {
            animation: conflictLineOut 0.5s ease-out forwards;
        }

        @keyframes conflictLineOut {
            0% { opacity: 1; }
            100% { opacity: 0; }
        }

        /* Spark particles at conflict point */
        .conflict-spark {
            position: absolute;
            width: 6px;
            height: 6px;
            background: var(--error);
            border-radius: 50%;
            box-shadow: 0 0 10px var(--error), 0 0 20px var(--error);
            pointer-events: none;
            z-index: 7;
        }

        .conflict-spark.animate {
            animation: sparkBurst 0.6s ease-out forwards;
        }

        @keyframes sparkBurst {
            0% { transform: translate(-50%, -50%) scale(1); opacity: 1; }
            100% { transform: translate(calc(-50% + var(--spark-x)), calc(-50% + var(--spark-y))) scale(0); opacity: 0; }
        }

        /* Screen shake on conflict */
        @keyframes screenShake {
            0%, 100% { transform: translate(0); }
            20% { transform: translate(-3px, 2px); }
            40% { transform: translate(3px, -2px); }
            60% { transform: translate(-2px, 3px); }
            80% { transform: translate(2px, -3px); }
        }

        .cortex-arena.shaking {
            animation: screenShake 0.4s ease-out;
        }

        /* Empty state */
        .stream-empty {
            text-align: center;
            color: var(--text-muted);
            font-size: 0.875rem;
            padding: 40px;
        }

        .stream-empty-icon {
            font-size: 2rem;
            margin-bottom: 12px;
            opacity: 0.5;
        }

        /* ============================================
           STATUS DISPLAY
           ============================================ */

        .arena-status {
            position: absolute;
            bottom: -60px;
            left: 50%;
            transform: translateX(-50%);
            text-align: center;
        }

        .status-text {
            font-family: var(--font-hero);
            font-size: 1rem;
            font-weight: 500;
            color: var(--text-primary);
            margin-bottom: 8px;
        }

        .status-phase {
            font-size: 0.75rem;
            color: var(--text-muted);
            letter-spacing: 1px;
            text-transform: uppercase;
        }

        .round-dots {
            display: flex;
            justify-content: center;
            gap: 8px;
            margin-top: 12px;
        }

        .round-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: var(--glass-border);
            transition: all 0.3s ease;
        }

        .round-dot.active {
            background: var(--core-primary);
            box-shadow: 0 0 12px var(--core-primary);
        }

        .round-dot.completed {
            background: var(--success);
            box-shadow: 0 0 8px var(--success);
        }

        /* ============================================
           THE OMNI-BAR (Input)
           ============================================ */

        .omni-bar-container {
            position: fixed;
            bottom: 60px; /* Above the footer */
            left: 50%;
            transform: translateX(-50%);
            z-index: 100;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .omni-bar {
            width: 640px;
            background: rgba(10, 10, 15, 0.8);
            backdrop-filter: blur(40px);
            border: 1px solid var(--glass-border);
            border-radius: 32px;
            padding: 8px 8px 8px 28px;
            display: flex;
            align-items: center;
            gap: 16px;
            box-shadow:
                0 20px 60px rgba(0, 0, 0, 0.5),
                0 0 0 1px var(--glass-glow);
            transition: all 0.3s ease;
        }

        .omni-bar:focus-within {
            border-color: var(--core-primary);
            box-shadow:
                0 20px 60px rgba(0, 0, 0, 0.5),
                0 0 40px rgba(99, 102, 241, 0.2);
        }

        .omni-input {
            flex: 1;
            background: transparent;
            border: none;
            font-family: var(--font-body);
            font-size: 1rem;
            color: var(--text-primary);
            outline: none;
        }

        .omni-input::placeholder {
            color: var(--text-muted);
        }

        .status-lights {
            display: flex;
            gap: 6px;
            padding-right: 8px;
        }

        .status-light {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            opacity: 0.3;
            transition: all 0.3s ease;
        }

        .status-light.gpt { background: var(--ai-gpt); }
        .status-light.gemini { background: var(--ai-gemini); }
        .status-light.grok { background: var(--ai-grok); }
        .status-light.claude { background: var(--ai-claude); }

        .status-light.active {
            opacity: 1;
            box-shadow: 0 0 12px currentColor;
            animation: lightPulse 1.5s ease-in-out infinite;
        }

        @keyframes lightPulse {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.6; transform: scale(1.2); }
        }

        .omni-submit {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--core-primary), var(--core-secondary));
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            box-shadow: 0 4px 20px rgba(99, 102, 241, 0.4);
        }

        .omni-submit:hover {
            transform: scale(1.05);
            box-shadow: 0 6px 30px rgba(99, 102, 241, 0.5);
        }

        .omni-submit:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .omni-submit svg {
            width: 20px;
            height: 20px;
            stroke: white;
            stroke-width: 2;
            fill: none;
        }

        /* Quick Template Chips */
        .template-chips {
            display: grid;
            grid-template-columns: repeat(4, auto);
            gap: 8px 12px;
            margin-top: 16px;
            justify-content: center;
            transition: opacity 0.3s ease, transform 0.3s ease;
            width: 640px;
        }

        .template-chip {
            padding: 6px 14px;
            background: rgba(255, 255, 255, 0.04);
            border: 1px solid var(--glass-border);
            border-radius: 16px;
            color: var(--text-secondary);
            font-size: 0.75rem;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 5px;
            white-space: nowrap;
        }

        .template-chip:hover {
            background: rgba(99, 102, 241, 0.15);
            border-color: var(--core-primary);
            color: var(--text-primary);
            transform: translateY(-2px);
            box-shadow: 0 4px 20px rgba(99, 102, 241, 0.2);
        }

        .template-chip.selected {
            background: rgba(99, 102, 241, 0.25);
            border-color: var(--core-primary);
            color: var(--text-primary);
            box-shadow: 0 0 20px rgba(99, 102, 241, 0.3);
        }

        .template-chip.dissolving {
            animation: chipDissolve 0.4s ease-out forwards;
        }

        @keyframes chipDissolve {
            0% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.5; transform: scale(0.95) translateY(-5px); }
            100% { opacity: 0; transform: scale(0.8) translateY(-20px); }
        }

        @media (max-width: 700px) {
            /* Template chips - horizontal scrollable on mobile */
            .template-chips {
                display: flex !important;
                flex-wrap: nowrap;
                overflow-x: auto;
                -webkit-overflow-scrolling: touch;
                scroll-snap-type: x mandatory;
                gap: 8px;
                padding: 4px 0;
                width: calc(100vw - 32px);
                max-width: none;
                /* Hide scrollbar */
                scrollbar-width: none;
                -ms-overflow-style: none;
            }

            .template-chips::-webkit-scrollbar {
                display: none;
            }

            .template-chip {
                flex-shrink: 0;
                scroll-snap-align: start;
                padding: 8px 14px;
                font-size: 0.7rem;
            }

            .context-input {
                width: calc(100vw - 32px);
            }
        }

        /* Devil's Advocate Toggle */
        .devil-toggle {
            position: fixed;
            bottom: 120px;
            left: 30px;
            display: flex;
            align-items: center;
            gap: 10px;
            z-index: 100;
            transition: opacity 0.3s ease;
        }

        .devil-toggle label {
            font-size: 0.75rem;
            color: var(--text-muted);
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .devil-switch {
            position: relative;
            width: 44px;
            height: 24px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            border: 1px solid var(--glass-border);
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .devil-switch::after {
            content: '';
            position: absolute;
            left: 3px;
            top: 3px;
            width: 16px;
            height: 16px;
            background: var(--text-muted);
            border-radius: 50%;
            transition: all 0.3s ease;
        }

        .devil-toggle input {
            display: none;
        }

        .devil-toggle input:checked + .devil-switch {
            background: rgba(239, 68, 68, 0.3);
            border-color: var(--error);
            box-shadow: 0 0 20px rgba(239, 68, 68, 0.4);
        }

        .devil-toggle input:checked + .devil-switch::after {
            left: 23px;
            background: var(--error);
            box-shadow: 0 0 10px var(--error);
        }

        .devil-icon {
            font-size: 1rem;
            opacity: 0.5;
            transition: all 0.3s ease;
        }

        .devil-toggle input:checked ~ .devil-icon {
            opacity: 1;
            filter: drop-shadow(0 0 8px var(--error));
        }

        /* ============================================
           TOP BAR RIGHT (Unified Container)
           ============================================ */

        .top-bar-right {
            position: fixed;
            top: 20px;
            right: 20px;
            display: flex;
            align-items: center;
            gap: 12px;
            z-index: 100;
        }

        .usage-indicator {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 10px 16px;
            background: var(--glass-surface);
            border: 1px solid var(--glass-border);
            border-radius: 20px;
            font-size: 0.75rem;
            color: var(--text-secondary);
            backdrop-filter: blur(10px);
        }

        .usage-indicator .usage-count {
            font-weight: 700;
            color: var(--text-primary);
        }

        .usage-indicator .usage-count.low {
            color: var(--warning);
        }

        .usage-indicator .usage-count.empty {
            color: var(--error);
        }

        .usage-indicator .tier-badge {
            padding: 3px 8px;
            background: rgba(99, 102, 241, 0.2);
            border-radius: 10px;
            font-size: 0.65rem;
            font-weight: 700;
            text-transform: uppercase;
            color: var(--core-primary);
        }

        .usage-indicator .tier-badge.premium {
            background: rgba(245, 158, 11, 0.2);
            color: var(--warning);
        }

        /* Tier Selector */
        .tier-selector {
            position: relative;
            display: inline-flex;
        }

        .tier-selector-btn {
            display: flex;
            align-items: center;
            gap: 4px;
            padding: 4px 10px;
            background: rgba(99, 102, 241, 0.15);
            border: 1px solid rgba(99, 102, 241, 0.3);
            border-radius: 12px;
            font-size: 0.7rem;
            font-weight: 600;
            text-transform: uppercase;
            color: var(--core-primary);
            cursor: pointer;
            transition: all 0.2s;
        }

        .tier-selector-btn:hover {
            background: rgba(99, 102, 241, 0.25);
            border-color: rgba(99, 102, 241, 0.5);
        }

        .tier-selector-btn.premium {
            background: rgba(245, 158, 11, 0.15);
            border-color: rgba(245, 158, 11, 0.3);
            color: var(--warning);
        }

        .tier-selector-btn.premium:hover {
            background: rgba(245, 158, 11, 0.25);
            border-color: rgba(245, 158, 11, 0.5);
        }

        .tier-selector-btn svg {
            width: 10px;
            height: 10px;
            transition: transform 0.2s;
        }

        .tier-selector.open .tier-selector-btn svg {
            transform: rotate(180deg);
        }

        .tier-dropdown {
            position: absolute;
            top: calc(100% + 6px);
            right: 0;
            min-width: 180px;
            background: rgba(15, 15, 20, 0.95);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 6px;
            opacity: 0;
            visibility: hidden;
            transform: translateY(-10px);
            transition: all 0.2s;
            z-index: 100;
        }

        .tier-selector.open .tier-dropdown {
            opacity: 1;
            visibility: visible;
            transform: translateY(0);
        }

        .tier-option {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 10px 12px;
            border-radius: 8px;
            cursor: pointer;
            transition: background 0.15s;
        }

        .tier-option:hover {
            background: rgba(255, 255, 255, 0.05);
        }

        .tier-option.active {
            background: rgba(99, 102, 241, 0.15);
        }

        .tier-option.locked {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .tier-option.locked:hover {
            background: transparent;
        }

        .tier-option-info {
            display: flex;
            flex-direction: column;
            gap: 2px;
        }

        .tier-option-name {
            font-size: 0.8rem;
            font-weight: 600;
            color: var(--text-primary);
        }

        .tier-option-desc {
            font-size: 0.65rem;
            color: var(--text-muted);
        }

        .tier-option-badge {
            font-size: 0.6rem;
            padding: 2px 6px;
            border-radius: 6px;
            background: rgba(245, 158, 11, 0.2);
            color: var(--warning);
            font-weight: 600;
        }

        .tier-option-check {
            color: var(--success);
            width: 16px;
            height: 16px;
        }

        /* ============================================
           AI SETTINGS PANEL
           ============================================ */

        .ai-settings-btn {
            background: var(--glass-bg);
            border: 1px solid var(--glass-border);
            border-radius: 8px;
            padding: 8px 12px;
            color: var(--text-secondary);
            font-size: 0.75rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 6px;
            transition: all 0.2s ease;
        }

        .ai-settings-btn:hover {
            background: rgba(99, 102, 241, 0.1);
            border-color: var(--core-primary);
            color: var(--text-primary);
        }

        .ai-settings-btn svg {
            width: 16px;
            height: 16px;
        }

        .ai-settings-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(4px);
            z-index: 999;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }

        .ai-settings-overlay.open {
            opacity: 1;
            visibility: visible;
        }

        .ai-settings-panel {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0.95);
            background: var(--glass-bg);
            border: 1px solid var(--glass-border);
            border-radius: 16px;
            padding: 24px;
            z-index: 1000;
            width: 90%;
            max-width: 500px;
            max-height: 80vh;
            overflow-y: auto;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }

        .ai-settings-panel.open {
            opacity: 1;
            visibility: visible;
            transform: translate(-50%, -50%) scale(1);
        }

        .ai-settings-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 12px;
            border-bottom: 1px solid var(--glass-border);
        }

        .ai-settings-title {
            font-family: var(--font-hero);
            font-size: 1.1rem;
            font-weight: 700;
            color: var(--text-primary);
        }

        .ai-settings-close {
            background: transparent;
            border: none;
            color: var(--text-muted);
            cursor: pointer;
            padding: 4px;
            border-radius: 6px;
            transition: all 0.2s ease;
        }

        .ai-settings-close:hover {
            background: rgba(255, 255, 255, 0.1);
            color: var(--text-primary);
        }

        .ai-settings-section {
            margin-bottom: 20px;
        }

        .ai-settings-section-title {
            font-size: 0.85rem;
            font-weight: 600;
            color: var(--text-secondary);
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .ai-settings-section-title svg {
            width: 16px;
            height: 16px;
            opacity: 0.7;
        }

        /* AI Selection Grid */
        .ai-select-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
        }

        .ai-select-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 12px;
            background: rgba(255, 255, 255, 0.03);
            border: 2px solid var(--glass-border);
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .ai-select-item:hover {
            background: rgba(255, 255, 255, 0.05);
        }

        .ai-select-item.selected {
            border-color: var(--core-primary);
            background: rgba(99, 102, 241, 0.1);
        }

        .ai-select-item.disabled {
            opacity: 0.4;
            cursor: not-allowed;
        }

        .ai-select-checkbox {
            width: 18px;
            height: 18px;
            border: 2px solid var(--glass-border);
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
            flex-shrink: 0;
        }

        .ai-select-item.selected .ai-select-checkbox {
            background: var(--core-primary);
            border-color: var(--core-primary);
        }

        .ai-select-checkbox svg {
            width: 12px;
            height: 12px;
            opacity: 0;
            color: white;
        }

        .ai-select-item.selected .ai-select-checkbox svg {
            opacity: 1;
        }

        .ai-select-icon {
            width: 28px;
            height: 28px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }

        .ai-select-icon svg {
            width: 16px;
            height: 16px;
        }

        .ai-select-icon.gpt { background: rgba(16, 163, 127, 0.2); color: var(--ai-gpt); }
        .ai-select-icon.gemini { background: rgba(66, 133, 244, 0.2); color: var(--ai-gemini); }
        .ai-select-icon.claude { background: rgba(217, 119, 6, 0.2); color: var(--ai-claude); }
        .ai-select-icon.grok { background: rgba(249, 115, 22, 0.2); color: var(--ai-grok); }

        .ai-select-info {
            flex: 1;
            min-width: 0;
        }

        .ai-select-name {
            font-size: 0.8rem;
            font-weight: 600;
            color: var(--text-primary);
        }

        .ai-select-desc {
            font-size: 0.65rem;
            color: var(--text-muted);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        /* Persona Customization */
        .persona-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .persona-item {
            display: flex;
            align-items: flex-start;
            gap: 12px;
            padding: 12px;
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid var(--glass-border);
            border-radius: 10px;
        }

        .persona-item.disabled {
            opacity: 0.4;
        }

        .persona-icon {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }

        .persona-icon svg {
            width: 18px;
            height: 18px;
        }

        .persona-icon.gpt { background: rgba(16, 163, 127, 0.2); color: var(--ai-gpt); }
        .persona-icon.gemini { background: rgba(66, 133, 244, 0.2); color: var(--ai-gemini); }
        .persona-icon.claude { background: rgba(217, 119, 6, 0.2); color: var(--ai-claude); }
        .persona-icon.grok { background: rgba(249, 115, 22, 0.2); color: var(--ai-grok); }

        .persona-content {
            flex: 1;
        }

        .persona-name {
            font-size: 0.8rem;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 6px;
        }

        .persona-select {
            width: 100%;
            padding: 8px 10px;
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid var(--glass-border);
            border-radius: 6px;
            color: var(--text-primary);
            font-size: 0.75rem;
            cursor: pointer;
            appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 24 24' fill='none' stroke='%23999' stroke-width='2'%3E%3Cpolyline points='6 9 12 15 18 9'%3E%3C/polyline%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 10px center;
        }

        .persona-select:focus {
            outline: none;
            border-color: var(--core-primary);
        }

        .ai-settings-note {
            font-size: 0.7rem;
            color: var(--text-muted);
            text-align: center;
            margin-top: 16px;
            padding-top: 12px;
            border-top: 1px solid var(--glass-border);
        }

        /* ============================================
           CONTEXT INPUT (Expandable)
           ============================================ */

        .context-toggle {
            display: flex;
            align-items: center;
            gap: 6px;
            margin-top: 12px;
            padding: 6px 12px;
            background: transparent;
            border: none;
            color: var(--text-muted);
            font-size: 0.75rem;
            cursor: pointer;
            transition: color 0.2s;
        }

        .context-toggle:hover {
            color: var(--text-primary);
        }

        .context-toggle svg {
            width: 14px;
            height: 14px;
            transition: transform 0.3s;
        }

        .context-toggle.open svg {
            transform: rotate(180deg);
        }

        .context-input-container {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease;
            width: 100%;
            display: flex;
            justify-content: center;
        }

        .context-input-container.open {
            max-height: 120px;
        }

        .context-input {
            width: 640px;
            margin-top: 8px;
            padding: 12px 16px;
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid var(--glass-border);
            border-radius: 12px;
            color: var(--text-primary);
            font-family: var(--font-body);
            font-size: 0.85rem;
            resize: none;
            outline: none;
        }

        .context-input:focus {
            border-color: var(--core-primary);
        }

        .context-input::placeholder {
            color: var(--text-muted);
        }

        /* ============================================
           SITE FOOTER
           ============================================ */

        .site-footer {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            padding: 12px 20px;
            background: rgba(5, 5, 8, 0.9);
            border-top: 1px solid var(--glass-border);
            display: flex;
            justify-content: center;
            gap: 24px;
            font-size: 0.7rem;
            z-index: 50;
        }

        .site-footer a {
            color: var(--text-muted);
            text-decoration: none;
            transition: color 0.2s;
        }

        .site-footer a:hover {
            color: var(--text-primary);
        }

        .site-footer .copyright {
            color: var(--text-muted);
            opacity: 0.6;
        }

        /* ============================================
           AUTH UI
           ============================================ */

        .auth-container {
            position: fixed;
            top: 20px;
            left: 20px;
            display: flex;
            align-items: center;
            gap: 12px;
            z-index: 100;
        }

        .auth-loading {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 16px;
            background: var(--glass-surface);
            border: 1px solid var(--glass-border);
            border-radius: 20px;
            backdrop-filter: blur(10px);
        }

        .auth-loading-spinner {
            width: 14px;
            height: 14px;
            border: 2px solid var(--glass-border);
            border-top-color: var(--core-primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .auth-btn {
            padding: 8px 16px;
            font-size: 0.75rem;
            font-weight: 500;
            font-family: var(--font-hero);
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.2s ease;
            border: none;
        }

        .auth-btn-signin {
            color: var(--text-secondary);
            background: var(--glass-surface);
            border: 1px solid var(--glass-border);
        }

        .auth-btn-signin:hover {
            color: var(--text-primary);
            background: var(--glass-glow);
        }

        .auth-btn-signup {
            color: white;
            background: linear-gradient(135deg, var(--core-primary), var(--core-secondary));
            box-shadow: 0 2px 10px rgba(99, 102, 241, 0.3);
        }

        .auth-btn-signup:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 15px rgba(99, 102, 241, 0.4);
        }

        .user-menu {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 6px 14px 6px 6px;
            background: var(--glass-surface);
            border: 1px solid var(--glass-border);
            border-radius: 24px;
            cursor: pointer;
            transition: all 0.2s ease;
            position: relative;
            backdrop-filter: blur(10px);
        }

        .user-menu:hover {
            background: var(--glass-glow);
            border-color: rgba(255, 255, 255, 0.15);
        }

        .user-avatar {
            width: 28px;
            height: 28px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--core-primary), var(--core-secondary));
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.7rem;
            font-weight: 600;
            color: white;
            overflow: hidden;
        }

        .user-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .user-name {
            font-size: 0.8rem;
            font-weight: 500;
            color: var(--text-primary);
        }

        .user-tier {
            font-size: 0.6rem;
            font-weight: 700;
            padding: 2px 6px;
            border-radius: 4px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .user-tier-free {
            background: rgba(107, 114, 128, 0.2);
            color: #9ca3af;
        }

        .user-tier-pro {
            background: rgba(99, 102, 241, 0.2);
            color: var(--core-primary);
        }

        .user-tier-business {
            background: rgba(217, 119, 6, 0.2);
            color: var(--ai-claude);
        }

        .user-dropdown {
            position: absolute;
            top: calc(100% + 8px);
            right: 0;
            min-width: 160px;
            background: rgba(15, 15, 20, 0.95);
            border: 1px solid var(--glass-border);
            border-radius: 12px;
            padding: 6px;
            opacity: 0;
            visibility: hidden;
            transform: translateY(-8px);
            transition: all 0.2s ease;
            backdrop-filter: blur(20px);
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);
        }

        .user-menu.active .user-dropdown {
            opacity: 1;
            visibility: visible;
            transform: translateY(0);
        }

        .user-dropdown-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px 14px;
            font-size: 0.8rem;
            color: var(--text-secondary);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.15s ease;
        }

        .user-dropdown-item:hover {
            background: var(--glass-glow);
            color: var(--text-primary);
        }

        .user-dropdown-divider {
            height: 1px;
            background: var(--glass-border);
            margin: 4px 0;
        }

        /* ============================================
           HISTORY DRAWER
           ============================================ */

        .history-toggle {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background: var(--glass-surface);
            border: 1px solid var(--glass-border);
            color: var(--text-secondary);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
            backdrop-filter: blur(10px);
        }

        .upgrade-btn {
            padding: 8px 16px;
            font-size: 0.7rem;
            font-weight: 600;
            font-family: var(--font-hero);
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.2s ease;
            border: none;
            background: linear-gradient(135deg, var(--ai-claude), #f59e0b);
            color: white;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .upgrade-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(217, 119, 6, 0.4);
        }

        .history-toggle:hover {
            background: var(--glass-glow);
            color: var(--text-primary);
        }

        .history-toggle svg {
            width: 18px;
            height: 18px;
        }

        .history-drawer {
            position: fixed;
            top: 0;
            right: -360px;
            width: 360px;
            height: 100vh;
            background: rgba(10, 10, 15, 0.95);
            border-left: 1px solid var(--glass-border);
            z-index: 150;
            transition: right 0.3s ease;
            display: flex;
            flex-direction: column;
            backdrop-filter: blur(20px);
        }

        .history-drawer.open {
            right: 0;
        }

        .history-drawer-header {
            padding: 20px;
            border-bottom: 1px solid var(--glass-border);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .history-drawer-title {
            font-family: var(--font-hero);
            font-size: 1rem;
            font-weight: 600;
            color: var(--text-primary);
        }

        .history-drawer-close {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: transparent;
            border: none;
            color: var(--text-muted);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
        }

        .history-drawer-close:hover {
            background: var(--glass-surface);
            color: var(--text-primary);
        }

        .history-drawer-content {
            flex: 1;
            overflow-y: auto;
            padding: 16px;
        }

        .history-empty {
            text-align: center;
            padding: 40px 20px;
            color: var(--text-muted);
        }

        .history-empty svg {
            width: 48px;
            height: 48px;
            margin-bottom: 16px;
            opacity: 0.4;
        }

        .history-item {
            background: var(--glass-surface);
            border: 1px solid var(--glass-border);
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 12px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .history-item:hover {
            background: var(--glass-glow);
            transform: translateX(-4px);
        }

        .history-item-date {
            font-size: 0.65rem;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 8px;
        }

        .history-item-question {
            font-size: 0.875rem;
            color: var(--text-primary);
            line-height: 1.4;
            margin-bottom: 8px;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .history-item-verdict {
            display: inline-block;
            font-size: 0.65rem;
            font-weight: 700;
            padding: 3px 8px;
            border-radius: 4px;
            text-transform: uppercase;
        }

        .history-item-verdict.consensus {
            background: rgba(16, 185, 129, 0.2);
            color: var(--success);
        }

        .history-item-verdict.split {
            background: rgba(245, 158, 11, 0.2);
            color: var(--warning);
        }

        .history-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 140;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }

        .history-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        /* ============================================
           THE VERDICT PANEL
           ============================================ */

        .verdict-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(20px);
            z-index: 200;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.5s ease;
            display: flex;
            align-items: flex-start;
            justify-content: center;
            padding: 40px 20px;
            overflow-y: auto;
        }

        .verdict-overlay.active {
            opacity: 1;
            pointer-events: all;
        }

        .verdict-panel {
            width: 100%;
            max-width: 800px;
            max-height: none; /* Allow full scrolling */
            background: rgba(8, 8, 12, 0.98);
            border: 1px solid var(--glass-border);
            border-radius: 24px;
            padding: 40px;
            margin: auto 0; /* Center vertically when content is short */
            transform: scale(0.95) translateY(20px);
            transition: transform 0.5s cubic-bezier(0.34, 1.56, 0.64, 1);
            box-shadow:
                0 40px 100px rgba(0, 0, 0, 0.6),
                inset 0 1px 0 var(--glass-glow);
        }

        .verdict-overlay.active .verdict-panel {
            transform: scale(1) translateY(0);
        }

        /* Verdict Header */
        .verdict-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 32px;
        }

        .consensus-badge {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 10px 20px;
            background: linear-gradient(135deg, var(--core-primary), var(--core-secondary));
            border-radius: 8px;
            font-family: var(--font-hero);
            font-size: 0.875rem;
            font-weight: 600;
            letter-spacing: 1px;
            box-shadow: 0 4px 20px rgba(99, 102, 241, 0.4);
        }

        .consensus-badge.split {
            background: linear-gradient(135deg, var(--warning), #b45309);
        }

        .confidence-display {
            text-align: right;
        }

        .confidence-value {
            font-family: var(--font-hero);
            font-size: 2rem;
            font-weight: 700;
            background: linear-gradient(135deg, #fff, #888);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .confidence-label {
            font-size: 0.75rem;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        /* Hero Decision (Biggest Element) */
        .verdict-decision {
            font-family: var(--font-hero);
            font-size: 3.5rem;
            font-weight: 700;
            background: linear-gradient(135deg, #fff, var(--text-secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            line-height: 1.1;
            margin-bottom: 12px;
            text-shadow: 0 0 60px rgba(255, 255, 255, 0.1);
        }

        /* Question (Smaller, Secondary) */
        .verdict-question {
            font-size: 0.9375rem;
            color: var(--text-muted);
            margin-bottom: 32px;
            font-weight: 400;
        }

        .verdict-question::before {
            content: 'Q: ';
            color: var(--core-primary);
            font-weight: 600;
        }

        /* Spectrum Slider */
        .spectrum-container {
            margin: 40px 0;
        }

        .spectrum-label {
            font-size: 0.75rem;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 16px;
        }

        .spectrum-track {
            position: relative;
            height: 8px;
            background: linear-gradient(90deg,
                var(--error) 0%,
                var(--warning) 50%,
                var(--success) 100%
            );
            border-radius: 4px;
            margin-bottom: 8px;
        }

        .spectrum-avatars {
            position: absolute;
            inset: 0;
            display: flex;
            align-items: center;
        }

        .spectrum-avatar {
            position: absolute;
            width: 32px;
            height: 32px;
            border-radius: 50%;
            border: 3px solid var(--bg-deep);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.625rem;
            font-weight: 700;
            color: white;
            transform: translateX(-50%);
            transition: left 0.6s cubic-bezier(0.34, 1.56, 0.64, 1), transform 0.2s ease;
            cursor: pointer;
            z-index: 10;
        }

        .spectrum-avatar:hover {
            transform: translateX(-50%) scale(1.2);
            box-shadow: 0 0 15px currentColor;
        }

        .spectrum-avatar.gpt { background: var(--ai-gpt); }
        .spectrum-avatar.gemini { background: var(--ai-gemini); }
        .spectrum-avatar.grok { background: var(--ai-grok); }
        .spectrum-avatar.claude { background: var(--ai-claude); }

        .spectrum-labels {
            display: flex;
            justify-content: space-between;
            font-size: 0.6875rem;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        /* AI Agreement Grid - Individual Responses */
        .ai-agreement-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            margin: 20px 0;
        }

        .ai-response-card {
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid var(--glass-border);
            border-radius: 12px;
            padding: 14px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .ai-response-card:hover {
            background: rgba(255, 255, 255, 0.06);
            transform: translateY(-2px);
        }

        .ai-response-card.gpt { border-left: 3px solid var(--ai-gpt); }
        .ai-response-card.gemini { border-left: 3px solid var(--ai-gemini); }
        .ai-response-card.claude { border-left: 3px solid var(--ai-claude); }
        .ai-response-card.grok { border-left: 3px solid var(--ai-grok); }

        .ai-resp-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .ai-resp-name {
            font-family: var(--font-hero);
            font-size: 0.75rem;
            font-weight: 600;
            letter-spacing: 0.5px;
            text-transform: uppercase;
        }

        .ai-response-card.gpt .ai-resp-name { color: var(--ai-gpt); }
        .ai-response-card.gemini .ai-resp-name { color: var(--ai-gemini); }
        .ai-response-card.claude .ai-resp-name { color: var(--ai-claude); }
        .ai-response-card.grok .ai-resp-name { color: var(--ai-grok); }

        .ai-resp-verdict {
            font-size: 0.65rem;
            font-weight: 700;
            padding: 3px 8px;
            border-radius: 4px;
            background: rgba(255, 255, 255, 0.1);
        }

        .ai-resp-verdict.yes { background: rgba(16, 185, 129, 0.2); color: var(--success); }
        .ai-resp-verdict.no { background: rgba(239, 68, 68, 0.2); color: var(--error); }
        .ai-resp-verdict.conditional { background: rgba(245, 158, 11, 0.2); color: var(--warning); }

        .ai-resp-summary {
            font-size: 0.8rem;
            color: var(--text-secondary);
            line-height: 1.5;
            margin: 0;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        /* Attribution/Synthesis Section - 2 Column Layout */
        .attribution-section {
            margin: 40px 0;
        }

        .attribution-title {
            font-family: var(--font-hero);
            font-size: 0.75rem;
            font-weight: 600;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 16px;
        }

        /* Key Insights Grid (2 columns) */
        .insights-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
            margin-bottom: 24px;
        }

        .insights-box {
            padding: 20px;
            background: var(--glass-surface);
            border: 1px solid var(--glass-border);
            border-radius: 12px;
        }

        .insights-box-title {
            font-family: var(--font-hero);
            font-size: 0.6875rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .insights-box.pro .insights-box-title { color: var(--success); }
        .insights-box.con .insights-box-title { color: var(--warning); }

        .insights-list {
            list-style: none;
        }

        .insights-list li {
            display: flex;
            align-items: flex-start;
            gap: 10px;
            padding: 6px 0;
            font-size: 0.875rem;
            color: var(--text-secondary);
            line-height: 1.5;
        }

        .insights-list li::before {
            content: '';
            width: 6px;
            height: 6px;
            border-radius: 50%;
            margin-top: 6px;
            flex-shrink: 0;
        }

        .insights-box.pro .insights-list li::before { background: var(--success); }
        .insights-box.con .insights-list li::before { background: var(--warning); }

        /* Synthesis Summary */
        .synthesis-summary {
            padding: 20px 24px;
            background: var(--glass-surface);
            border: 1px solid var(--glass-border);
            border-radius: 12px;
            border-left: 3px solid var(--core-primary);
        }

        .synthesis-summary p {
            font-size: 0.9375rem;
            line-height: 1.8;
            color: #e0e0e0;
            font-weight: 300;
            letter-spacing: 0.01em;
            margin: 0;
        }

        .attribution-text {
            font-size: 1rem;
            line-height: 1.9;
            color: #e0e0e0;
            font-weight: 300;
            max-width: 65ch;
            letter-spacing: 0.01em;
        }

        @media (max-width: 768px) {
            .insights-grid {
                grid-template-columns: 1fr;
            }
        }

        /* Heatmap Highlights */
        .attr-gpt {
            border-bottom: 2px solid var(--ai-gpt);
            color: var(--text-primary);
            cursor: help;
        }
        .attr-gemini {
            border-bottom: 2px solid var(--ai-gemini);
            color: var(--text-primary);
            cursor: help;
        }
        .attr-grok {
            border-bottom: 2px solid var(--ai-grok);
            color: var(--text-primary);
            cursor: help;
        }
        .attr-claude {
            border-bottom: 2px solid var(--ai-claude);
            color: var(--text-primary);
            cursor: help;
        }

        /* Action Plan */
        .action-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 16px;
            margin: 32px 0;
        }

        .action-box {
            padding: 24px;
            background: var(--glass-surface);
            border: 1px solid var(--glass-border);
            border-radius: 16px;
            min-height: 180px;
            display: flex;
            flex-direction: column;
        }

        .action-box-title {
            font-family: var(--font-hero);
            font-size: 0.6875rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .action-box.immediate .action-box-title { color: var(--success); }
        .action-box.risks .action-box-title { color: var(--warning); }
        .action-box.critical .action-box-title { color: var(--ai-gemini); }

        .action-list {
            list-style: none;
            flex: 1;
            overflow-y: auto;
        }

        .action-list li {
            display: flex;
            align-items: flex-start;
            gap: 10px;
            padding: 8px 0;
            font-size: 0.875rem;
            color: var(--text-secondary);
            line-height: 1.5;
        }

        .action-list li::before {
            content: '';
            width: 5px;
            height: 5px;
            border-radius: 50%;
            background: var(--core-primary);
            margin-top: 7px;
            flex-shrink: 0;
        }

        .action-box.immediate .action-list li::before { background: var(--success); }
        .action-box.risks .action-list li::before { background: var(--warning); }
        .action-box.critical .action-list li::before { background: var(--ai-gemini); }

        /* Verdict Actions */
        .verdict-actions {
            display: flex;
            gap: 12px;
            margin-top: 32px;
        }

        .verdict-btn {
            padding: 14px 28px;
            font-family: var(--font-hero);
            font-size: 0.875rem;
            font-weight: 600;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .verdict-btn-primary {
            background: linear-gradient(135deg, var(--core-primary), var(--core-secondary));
            border: none;
            color: white;
            box-shadow: 0 4px 20px rgba(99, 102, 241, 0.3);
        }

        .verdict-btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 30px rgba(99, 102, 241, 0.4);
        }

        .verdict-btn-secondary {
            background: var(--glass-surface);
            border: 1px solid var(--glass-border);
            color: var(--text-primary);
        }

        .verdict-btn-secondary:hover {
            background: var(--glass-glow);
            border-color: var(--glass-glow);
        }

        .verdict-btn svg {
            width: 18px;
            height: 18px;
            stroke: currentColor;
            stroke-width: 2;
            fill: none;
        }

        /* Follow-up Section */
        .followup-section {
            margin-top: 24px;
            padding: 20px;
            background: var(--glass-surface);
            border: 1px solid var(--glass-border);
            border-radius: 16px;
            display: none;
        }

        .followup-section.active {
            display: block;
        }

        .followup-title {
            font-family: var(--font-hero);
            font-size: 0.875rem;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 12px;
        }

        .followup-input-row {
            display: flex;
            gap: 12px;
        }

        .followup-input {
            flex: 1;
            padding: 14px 18px;
            font-size: 0.875rem;
            font-family: var(--font-body);
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid var(--glass-border);
            border-radius: 12px;
            color: var(--text-primary);
            outline: none;
            transition: border-color 0.2s ease;
        }

        .followup-input::placeholder {
            color: var(--text-muted);
        }

        .followup-input:focus {
            border-color: var(--core-primary);
        }

        .followup-btn {
            padding: 14px 24px;
            font-family: var(--font-hero);
            font-size: 0.875rem;
            font-weight: 600;
            border-radius: 12px;
            cursor: pointer;
            border: none;
            background: linear-gradient(135deg, var(--core-primary), var(--core-secondary));
            color: white;
            transition: all 0.2s ease;
        }

        .followup-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(99, 102, 241, 0.3);
        }

        /* Close Button */
        .verdict-close {
            position: absolute;
            top: 20px;
            right: 20px;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--glass-surface);
            border: 1px solid var(--glass-border);
            color: var(--text-muted);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        .verdict-close:hover {
            background: var(--glass-glow);
            color: var(--text-primary);
        }

        /* Decision Timeline */
        .decision-timeline {
            margin: 32px 0;
            padding: 24px;
            background: rgba(255, 255, 255, 0.02);
            border: 1px solid var(--glass-border);
            border-radius: 16px;
        }

        .timeline-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 16px;
            font-size: 0.875rem;
            font-weight: 600;
            color: var(--text-primary);
        }

        .timeline-header svg {
            width: 18px;
            height: 18px;
            stroke: var(--core-primary);
        }

        .timeline-steps {
            position: relative;
            padding-left: 24px;
        }

        .timeline-steps::before {
            content: '';
            position: absolute;
            left: 6px;
            top: 8px;
            bottom: 8px;
            width: 2px;
            background: linear-gradient(to bottom, var(--ai-gpt), var(--ai-gemini), var(--ai-claude), var(--ai-grok), var(--core-primary));
            border-radius: 2px;
        }

        .timeline-step {
            position: relative;
            padding: 8px 0;
            display: flex;
            align-items: flex-start;
            gap: 12px;
        }

        .timeline-step::before {
            content: '';
            position: absolute;
            left: -20px;
            top: 12px;
            width: 10px;
            height: 10px;
            background: var(--bg-deep);
            border: 2px solid var(--text-muted);
            border-radius: 50%;
        }

        .timeline-step.complete::before {
            background: var(--success);
            border-color: var(--success);
        }

        .timeline-step.conflict::before {
            background: var(--error);
            border-color: var(--error);
        }

        .timeline-step-content {
            flex: 1;
        }

        .timeline-step-title {
            font-size: 0.8rem;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 2px;
        }

        .timeline-step-desc {
            font-size: 0.75rem;
            color: var(--text-muted);
            line-height: 1.4;
        }

        /* Debate Transcript (Collapsible) */
        .debate-transcript {
            margin: 24px 0;
            border: 1px solid var(--glass-border);
            border-radius: 12px;
            overflow: hidden;
        }

        .transcript-toggle {
            width: 100%;
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 16px 20px;
            background: rgba(255, 255, 255, 0.02);
            border: none;
            color: var(--text-primary);
            font-size: 0.875rem;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.2s;
        }

        .transcript-toggle:hover {
            background: rgba(255, 255, 255, 0.05);
        }

        .transcript-toggle svg:first-child {
            width: 18px;
            height: 18px;
            stroke: var(--core-primary);
        }

        .transcript-toggle .toggle-chevron {
            width: 16px;
            height: 16px;
            margin-left: auto;
            transition: transform 0.3s;
        }

        .debate-transcript.open .toggle-chevron {
            transform: rotate(180deg);
        }

        .transcript-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.5s ease-out;
        }

        .debate-transcript.open .transcript-content {
            max-height: 8000px; /* Much higher to accommodate long debates */
            overflow-y: auto;
        }

        .transcript-inner {
            padding: 20px;
            border-top: 1px solid var(--glass-border);
        }

        .transcript-round {
            margin-bottom: 24px;
        }

        .transcript-round:last-child {
            margin-bottom: 0;
        }

        .transcript-round-header {
            font-size: 0.75rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: var(--core-primary);
            margin-bottom: 12px;
            padding-bottom: 8px;
            border-bottom: 1px solid var(--glass-border);
        }

        .transcript-message {
            display: flex;
            gap: 12px;
            margin-bottom: 16px;
            padding: 12px;
            background: rgba(255, 255, 255, 0.02);
            border-radius: 10px;
            border-left: 3px solid var(--text-muted);
        }

        .transcript-message.gpt { border-left-color: var(--ai-gpt); }
        .transcript-message.gemini { border-left-color: var(--ai-gemini); }
        .transcript-message.claude { border-left-color: var(--ai-claude); }
        .transcript-message.grok { border-left-color: var(--ai-grok); }

        .transcript-avatar {
            width: 32px;
            height: 32px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.7rem;
            font-weight: 700;
            flex-shrink: 0;
        }

        .transcript-message.gpt .transcript-avatar { background: rgba(16, 163, 127, 0.2); color: var(--ai-gpt); }
        .transcript-message.gemini .transcript-avatar { background: rgba(66, 133, 244, 0.2); color: var(--ai-gemini); }
        .transcript-message.claude .transcript-avatar { background: rgba(217, 119, 6, 0.2); color: var(--ai-claude); }
        .transcript-message.grok .transcript-avatar { background: rgba(249, 115, 22, 0.2); color: var(--ai-grok); }

        .transcript-body {
            flex: 1;
            min-width: 0;
        }

        .transcript-header {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 6px;
        }

        .transcript-name {
            font-size: 0.8rem;
            font-weight: 600;
            color: var(--text-primary);
        }

        .transcript-verdict {
            font-size: 0.65rem;
            font-weight: 700;
            padding: 2px 6px;
            border-radius: 4px;
        }

        .transcript-verdict.yes { background: rgba(16, 185, 129, 0.2); color: var(--success); }
        .transcript-verdict.no { background: rgba(239, 68, 68, 0.2); color: var(--error); }
        .transcript-verdict.conditional { background: rgba(245, 158, 11, 0.2); color: var(--warning); }
        .transcript-verdict.wait { background: rgba(59, 130, 246, 0.2); color: var(--info); }

        .transcript-changed {
            font-size: 0.6rem;
            padding: 2px 6px;
            background: rgba(99, 102, 241, 0.2);
            color: var(--core-primary);
            border-radius: 4px;
        }

        .transcript-text {
            font-size: 0.8rem;
            color: var(--text-secondary);
            line-height: 1.5;
        }

        .transcript-key-arg {
            font-size: 0.75rem;
            color: var(--text-muted);
            margin-top: 8px;
            padding-top: 8px;
            border-top: 1px dashed var(--glass-border);
            font-style: italic;
        }

        /* Bias Check Badge */
        .bias-badge {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 8px 16px;
            background: rgba(16, 185, 129, 0.1);
            border: 1px solid rgba(16, 185, 129, 0.2);
            border-radius: 8px;
            font-size: 0.75rem;
            color: var(--success);
            margin-top: 24px;
        }

        .bias-badge svg {
            width: 16px;
            height: 16px;
            stroke: currentColor;
            stroke-width: 2;
            fill: none;
        }

        /* ============================================
           NODE INSPECTOR (Click-to-Expand Dossier)
           ============================================ */

        .node-inspector-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(10px);
            z-index: 250;
            display: flex;
            justify-content: center;
            align-items: center;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
        }

        .node-inspector-overlay.active {
            opacity: 1;
            pointer-events: all;
        }

        .glass-dossier {
            width: 520px;
            max-width: 90vw;
            background: rgba(10, 10, 15, 0.95);
            border: 1px solid var(--glass-border);
            border-radius: 24px;
            padding: 32px;
            box-shadow:
                0 0 80px rgba(99, 102, 241, 0.15),
                inset 0 1px 0 var(--glass-glow);
            transform: scale(0.9) translateY(20px);
            transition: transform 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
        }

        .node-inspector-overlay.active .glass-dossier {
            transform: scale(1) translateY(0);
        }

        .dossier-header {
            display: flex;
            align-items: center;
            gap: 16px;
            margin-bottom: 24px;
            padding-bottom: 20px;
            border-bottom: 1px solid var(--glass-border);
        }

        .dossier-icon {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.25rem;
        }

        .dossier-title {
            font-family: var(--font-hero);
            font-size: 1.5rem;
            font-weight: 700;
        }

        .dossier-verdict {
            font-size: 0.75rem;
            font-weight: 600;
            letter-spacing: 1px;
            text-transform: uppercase;
            padding: 4px 12px;
            border-radius: 6px;
            margin-left: auto;
        }

        .dossier-body {
            font-size: 1rem;
            line-height: 1.8;
            color: #e0e0e0;
            font-weight: 300;
            margin-bottom: 24px;
        }

        .confidence-meter {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .confidence-meter span {
            font-size: 0.75rem;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .meter-bar {
            flex: 1;
            height: 6px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 3px;
            overflow: hidden;
        }

        .meter-bar .fill {
            height: 100%;
            border-radius: 3px;
            transition: width 0.6s ease;
        }

        .dossier-close {
            position: absolute;
            top: 16px;
            right: 16px;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background: var(--glass-surface);
            border: 1px solid var(--glass-border);
            color: var(--text-muted);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
        }

        .dossier-close:hover {
            background: var(--glass-glow);
            color: var(--text-primary);
        }

        /* ============================================
           TACTICAL DRAWER (Slide-Up Action Plan)
           ============================================ */

        .tactical-handle {
            position: fixed;
            bottom: 140px;
            left: 50%;
            transform: translateX(-50%);
            padding: 12px 24px;
            background: rgba(10, 10, 15, 0.9);
            backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            border-radius: 30px;
            cursor: pointer;
            z-index: 150;
            display: none;
            align-items: center;
            gap: 10px;
            transition: all 0.3s ease;
        }

        .tactical-handle.visible {
            display: flex;
        }

        .tactical-handle:hover {
            background: rgba(20, 20, 25, 0.95);
            border-color: var(--core-primary);
            box-shadow: 0 0 30px rgba(99, 102, 241, 0.2);
        }

        .handle-icon {
            width: 20px;
            height: 20px;
            stroke: var(--core-primary);
            stroke-width: 2;
            fill: none;
        }

        .handle-text {
            font-family: var(--font-hero);
            font-size: 0.75rem;
            font-weight: 600;
            letter-spacing: 1px;
            text-transform: uppercase;
            color: var(--text-primary);
        }

        .tactical-drawer {
            position: fixed;
            bottom: -85vh;
            left: 0;
            width: 100%;
            height: 85vh;
            background: rgba(5, 5, 8, 0.98);
            border-top: 1px solid var(--glass-border);
            border-top-left-radius: 32px;
            border-top-right-radius: 32px;
            padding: 40px;
            z-index: 180;
            overflow-y: auto;
            transition: bottom 0.5s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 -20px 60px rgba(0, 0, 0, 0.5);
        }

        .tactical-drawer.open {
            bottom: 0;
        }

        .drawer-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 32px;
            max-width: 1000px;
            margin-left: auto;
            margin-right: auto;
        }

        .drawer-title {
            font-family: var(--font-hero);
            font-size: 1.5rem;
            font-weight: 700;
        }

        .drawer-close {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--glass-surface);
            border: 1px solid var(--glass-border);
            color: var(--text-muted);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .drawer-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 24px;
            max-width: 1000px;
            margin: 0 auto;
        }

        .drawer-card {
            background: var(--glass-surface);
            border: 1px solid var(--glass-border);
            border-radius: 16px;
            padding: 24px;
        }

        .drawer-card h3 {
            font-family: var(--font-hero);
            font-size: 0.875rem;
            font-weight: 600;
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .drawer-card.actions h3 { color: var(--success); }
        .drawer-card.risks h3 { color: var(--warning); }
        .drawer-card.timeline h3 { color: var(--ai-gemini); }
        .drawer-card.indicators h3 { color: var(--core-primary); }

        .drawer-card ul {
            list-style: none;
        }

        .drawer-card li {
            font-size: 0.9375rem;
            color: #ccc;
            line-height: 1.6;
            padding: 8px 0;
            padding-left: 20px;
            position: relative;
        }

        .drawer-card li::before {
            content: '';
            position: absolute;
            left: 0;
            top: 16px;
            width: 6px;
            height: 6px;
            border-radius: 50%;
        }

        .drawer-card.actions li::before { background: var(--success); }
        .drawer-card.risks li::before { background: var(--warning); }
        .drawer-card.timeline li::before { background: var(--ai-gemini); }
        .drawer-card.indicators li::before { background: var(--core-primary); }

        /* ============================================
           TIMELINE SCRUBBER (Debate Replay)
           ============================================ */

        .timeline-scrubber {
            position: fixed;
            bottom: 200px;
            left: 50%;
            transform: translateX(-50%);
            width: 400px;
            max-width: 90vw;
            background: rgba(10, 10, 15, 0.9);
            backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            border-radius: 16px;
            padding: 20px 24px;
            z-index: 140;
            display: none;
        }

        .timeline-scrubber.visible {
            display: block;
        }

        .scrubber-label {
            font-size: 0.6875rem;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 12px;
            text-align: center;
        }

        .scrubber-track {
            position: relative;
            height: 8px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
            margin-bottom: 8px;
        }

        .scrubber-input {
            position: absolute;
            inset: 0;
            width: 100%;
            height: 100%;
            -webkit-appearance: none;
            appearance: none;
            background: transparent;
            cursor: pointer;
        }

        .scrubber-input::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: var(--core-primary);
            box-shadow: 0 0 15px var(--core-primary);
            cursor: grab;
        }

        .scrubber-progress {
            position: absolute;
            top: 0;
            left: 0;
            height: 100%;
            background: linear-gradient(90deg, var(--core-primary), var(--core-secondary));
            border-radius: 4px;
            pointer-events: none;
        }

        .scrubber-labels {
            display: flex;
            justify-content: space-between;
            font-size: 0.6875rem;
            color: var(--text-muted);
        }

        .scrubber-summary {
            margin-top: 16px;
            padding-top: 16px;
            border-top: 1px solid var(--glass-border);
            font-size: 0.875rem;
            color: var(--text-secondary);
            line-height: 1.6;
            text-align: center;
            min-height: 44px;
        }

        /* ============================================
           TOAST
           ============================================ */

        .toast {
            position: fixed;
            bottom: 120px;
            left: 50%;
            transform: translateX(-50%) translateY(20px);
            padding: 14px 24px;
            background: rgba(10, 10, 15, 0.9);
            backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            border-radius: 12px;
            font-size: 0.875rem;
            color: var(--text-primary);
            opacity: 0;
            pointer-events: none;
            transition: all 0.3s ease;
            z-index: 300;
        }

        .toast.show {
            opacity: 1;
            transform: translateX(-50%) translateY(0);
        }

        .toast.success { border-color: var(--success); }
        .toast.error { border-color: var(--error); }

        /* ============================================
           UPGRADE MODAL
           ============================================ */

        .upgrade-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
            z-index: 500;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
        }

        .upgrade-overlay.active {
            opacity: 1;
            pointer-events: all;
        }

        .upgrade-modal {
            background: var(--bg-panel);
            border: 1px solid var(--glass-border);
            border-radius: 24px;
            padding: 40px;
            max-width: 500px;
            width: 90%;
            transform: scale(0.9) translateY(20px);
            transition: transform 0.3s ease;
        }

        .upgrade-overlay.active .upgrade-modal {
            transform: scale(1) translateY(0);
        }

        .upgrade-modal-close {
            position: absolute;
            top: 16px;
            right: 16px;
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: var(--glass-surface);
            border: 1px solid var(--glass-border);
            color: var(--text-muted);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .upgrade-modal-header {
            text-align: center;
            margin-bottom: 32px;
        }

        .upgrade-modal-icon {
            width: 64px;
            height: 64px;
            margin: 0 auto 16px;
            background: linear-gradient(135deg, var(--ai-claude), #f59e0b);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .upgrade-modal-icon svg {
            width: 32px;
            height: 32px;
            stroke: white;
        }

        .upgrade-modal-title {
            font-family: var(--font-hero);
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 8px;
        }

        .upgrade-modal-subtitle {
            color: var(--text-muted);
            font-size: 0.875rem;
        }

        .upgrade-features {
            margin-bottom: 32px;
        }

        .upgrade-feature {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 0;
            border-bottom: 1px solid var(--glass-border);
        }

        .upgrade-feature:last-child {
            border-bottom: none;
        }

        .upgrade-feature-icon {
            width: 24px;
            height: 24px;
            color: var(--success);
        }

        .upgrade-feature-text {
            color: var(--text-secondary);
            font-size: 0.875rem;
        }

        .upgrade-pricing {
            text-align: center;
            margin-bottom: 24px;
        }

        .upgrade-price {
            font-family: var(--font-hero);
            font-size: 2.5rem;
            font-weight: 700;
            color: var(--text-primary);
        }

        .upgrade-price span {
            font-size: 1rem;
            color: var(--text-muted);
            font-weight: 400;
        }

        .upgrade-cta {
            width: 100%;
            padding: 16px;
            font-size: 1rem;
            font-weight: 600;
            font-family: var(--font-hero);
            border-radius: 12px;
            cursor: pointer;
            border: none;
            background: linear-gradient(135deg, var(--ai-claude), #f59e0b);
            color: white;
            transition: all 0.2s ease;
        }

        .upgrade-cta:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(217, 119, 6, 0.4);
        }

        /* ============================================
           RESPONSIVE
           ============================================ */

        /* ============================================
           TABLET RESPONSIVE (768px and below)
           ============================================ */
        @media (max-width: 768px) {
            /* Force no scroll on body */
            html, body {
                overflow: hidden !important;
                height: 100dvh !important;
            }

            /* Main app container - truly fit viewport */
            .cortex-app {
                height: 100dvh;
                max-height: 100dvh;
                overflow: hidden;
                padding: 0;
                justify-content: flex-start;
                padding-top: 45px; /* Space for fixed header */
            }

            .cortex-arena {
                min-height: 0 !important;
                height: calc(100dvh - 170px); /* viewport - header - omni-bar - footer */
                max-height: calc(100dvh - 170px);
                padding: 10px;
                overflow: hidden;
            }

            .core-container {
                width: min(240px, 60vw);
                height: min(240px, 60vw);
            }

            .core-orb {
                width: 90px;
                height: 90px;
            }

            .ai-node {
                width: 36px;
                height: 36px;
            }

            .ai-node svg {
                width: 16px;
                height: 16px;
            }

            .core-container .node-gpt { top: 12px; left: 12px; }
            .core-container .node-gemini { top: 12px; right: 12px; }
            .core-container .node-claude { bottom: 35px; left: 12px; }
            .core-container .node-grok { bottom: 35px; right: 12px; }

            /* Hide thought cards on tablet - they overlap */
            .thought-card {
                display: none;
            }

            /* Omni bar - positioned above footer */
            .omni-bar-container {
                bottom: 45px;
            }

            .omni-bar {
                width: calc(100% - 24px);
                padding: 6px 6px 6px 16px;
            }

            .omni-input {
                font-size: 0.9rem;
            }

            .omni-submit {
                width: 42px;
                height: 42px;
            }

            /* Top bar right - simplified */
            .top-bar-right {
                top: 10px;
                right: 10px;
                gap: 6px;
            }

            .usage-indicator {
                display: none !important;
            }

            .tier-selector {
                display: none !important;
            }

            .upgrade-btn {
                padding: 6px 10px;
                font-size: 0.7rem;
            }

            /* Auth container - simplified */
            .auth-container {
                top: 10px;
                left: 10px;
            }

            .auth-btn {
                padding: 6px 10px;
                font-size: 0.7rem;
            }

            .user-menu {
                padding: 5px 8px;
            }

            .user-name {
                display: none !important;
            }

            /* Devil toggle - hide on mobile */
            .devil-toggle {
                display: none !important;
            }

            /* Site footer - smaller */
            .site-footer {
                padding: 8px 16px;
                gap: 16px;
                font-size: 0.6rem;
            }

            /* Hide stream container on mobile - takes too much space */
            .stream-container {
                display: none;
            }

            /* History drawer */
            .history-drawer {
                width: 85vw;
                max-width: 320px;
                right: -85vw;
            }

            .history-drawer.open {
                right: 0;
            }

            /* Verdict panel - scrollable */
            .verdict-overlay {
                padding: 10px;
                overflow-y: auto;
            }

            .verdict-panel {
                padding: 20px 16px;
                margin: 0 auto;
                max-width: 100%;
                max-height: none;
            }

            .verdict-header {
                flex-direction: column;
                gap: 12px;
            }

            .verdict-decision {
                font-size: 1.5rem;
            }

            .verdict-question {
                font-size: 0.8rem;
            }

            .verdict-summary {
                font-size: 0.85rem;
            }

            .action-grid {
                grid-template-columns: 1fr;
                gap: 10px;
            }

            .action-box {
                padding: 14px;
                min-height: auto;
            }

            .verdict-actions {
                flex-direction: column;
                gap: 8px;
            }

            .verdict-btn {
                width: 100%;
                justify-content: center;
                padding: 12px 20px;
            }

            /* Followup questions - horizontal scroll */
            .followup-chips {
                display: flex;
                flex-wrap: nowrap;
                overflow-x: auto;
                -webkit-overflow-scrolling: touch;
                gap: 8px;
                padding-bottom: 8px;
            }

            .followup-btn {
                flex-shrink: 0;
                padding: 8px 14px;
                font-size: 0.75rem;
            }

            /* Upgrade overlay */
            .upgrade-modal {
                width: calc(100% - 24px);
                max-width: 360px;
                padding: 20px 16px;
            }

            .upgrade-feature {
                padding: 10px 14px;
            }

            .upgrade-cta {
                padding: 12px 20px;
            }
        }

        /* ============================================
           MOBILE RESPONSIVE (480px and below)
           ============================================ */
        @media (max-width: 480px) {
            /* Main app - tighter viewport fit */
            .cortex-app {
                padding-top: 40px;
            }

            .cortex-arena {
                height: calc(100dvh - 150px);
                max-height: calc(100dvh - 150px);
                padding: 5px;
            }

            .core-container {
                width: min(180px, 50vw);
                height: min(180px, 50vw);
            }

            .core-orb {
                width: 65px;
                height: 65px;
            }

            .ai-node {
                width: 28px;
                height: 28px;
            }

            .ai-node svg {
                width: 12px;
                height: 12px;
            }

            /* Disable the spinning rings on mobile - causes overlap */
            .ai-node.active::before,
            .ai-node.active::after {
                display: none;
            }

            .core-container .node-gpt { top: 8px; left: 8px; }
            .core-container .node-gemini { top: 8px; right: 8px; }
            .core-container .node-claude { bottom: 22px; left: 8px; }
            .core-container .node-grok { bottom: 22px; right: 8px; }

            /* Top bar - minimal */
            .top-bar-right {
                top: 6px;
                right: 6px;
                gap: 4px;
            }

            .upgrade-btn {
                padding: 5px 8px;
                font-size: 0.6rem;
            }

            .upgrade-btn svg {
                display: none;
            }

            .history-toggle {
                width: 30px;
                height: 30px;
            }

            .history-toggle svg {
                width: 14px;
                height: 14px;
            }

            .ai-settings-btn {
                width: 30px;
                height: 30px;
            }

            .ai-settings-btn svg {
                width: 14px;
                height: 14px;
            }

            /* Auth container */
            .auth-container {
                top: 6px;
                left: 6px;
            }

            .auth-btn {
                padding: 5px 8px;
                font-size: 0.65rem;
            }

            .user-avatar {
                width: 26px;
                height: 26px;
                font-size: 0.65rem;
            }

            .user-tier {
                font-size: 0.5rem;
                padding: 2px 4px;
            }

            .user-dropdown {
                min-width: 140px;
            }

            /* Omni bar */
            .omni-bar-container {
                bottom: 40px;
            }

            .omni-bar {
                width: calc(100% - 16px);
                padding: 4px 4px 4px 12px;
                border-radius: 20px;
            }

            .omni-input {
                font-size: 0.8rem;
            }

            .omni-input::placeholder {
                font-size: 0.7rem;
            }

            .omni-submit {
                width: 34px;
                height: 34px;
            }

            .omni-submit svg {
                width: 14px;
                height: 14px;
            }

            /* Template chips - smaller horizontal scroll */
            .template-chips {
                width: calc(100vw - 16px);
                gap: 6px;
                margin-top: 10px;
            }

            .template-chip {
                padding: 6px 10px;
                font-size: 0.65rem;
            }

            /* Site footer */
            .site-footer {
                padding: 5px 10px;
                gap: 10px;
                font-size: 0.5rem;
            }

            /* History drawer - full width */
            .history-drawer {
                width: 100%;
                right: -100%;
            }

            .history-drawer.open {
                right: 0;
            }

            .history-drawer-header {
                padding: 12px;
            }

            .history-drawer-title {
                font-size: 0.85rem;
            }

            .history-item {
                padding: 10px;
            }

            .history-question {
                font-size: 0.75rem;
            }

            /* Verdict panel - full screen scrollable */
            .verdict-overlay {
                padding: 6px;
                overflow-y: auto;
            }

            .verdict-panel {
                padding: 14px 12px;
                margin: 0;
                max-width: 100%;
                border-radius: 12px;
            }

            .verdict-close {
                top: 6px;
                right: 6px;
                width: 26px;
                height: 26px;
            }

            .consensus-badge {
                font-size: 0.5rem;
                padding: 3px 6px;
            }

            .verdict-decision {
                font-size: 1.1rem;
                margin-bottom: 6px;
            }

            .verdict-question {
                font-size: 0.7rem;
            }

            .verdict-summary {
                font-size: 0.75rem;
                line-height: 1.5;
            }

            .confidence-score {
                padding: 8px 10px;
            }

            .confidence-value {
                font-size: 1.25rem;
            }

            .confidence-label {
                font-size: 0.55rem;
            }

            .action-box {
                padding: 10px;
            }

            .action-box-title {
                font-size: 0.55rem;
            }

            .action-list li {
                font-size: 0.7rem;
                padding: 4px 0;
            }

            .verdict-btn {
                padding: 10px 14px;
                font-size: 0.7rem;
            }

            /* Followup - horizontal scroll */
            .followup-chips {
                display: flex;
                flex-wrap: nowrap;
                overflow-x: auto;
                gap: 6px;
            }

            .followup-btn {
                flex-shrink: 0;
                padding: 6px 10px;
                font-size: 0.65rem;
            }

            /* Upgrade modal */
            .upgrade-modal {
                width: calc(100% - 12px);
                padding: 16px 12px;
            }

            .upgrade-title {
                font-size: 1rem;
            }

            .upgrade-subtitle {
                font-size: 0.7rem;
            }

            .upgrade-price {
                font-size: 1.5rem;
            }

            .upgrade-feature {
                padding: 6px 8px;
                font-size: 0.7rem;
            }

            .upgrade-cta {
                padding: 10px 14px;
                font-size: 0.8rem;
            }

            /* AI Settings Panel */
            .ai-settings-panel {
                width: calc(100% - 12px);
                max-height: 85vh;
                padding: 14px;
            }

            .ai-settings-header {
                padding: 0 0 10px 0;
            }

            .ai-settings-title {
                font-size: 0.9rem;
            }

            .ai-settings-body {
                padding: 10px 0 0 0;
            }

            .model-config-card {
                padding: 10px;
            }

            .model-config-header {
                font-size: 0.75rem;
            }

            /* Context input */
            .context-input {
                width: calc(100vw - 16px);
                font-size: 0.75rem;
                padding: 8px 12px;
            }
        }

        /* ============================================
           SMALL MOBILE (360px and below)
           ============================================ */
        @media (max-width: 360px) {
            .cortex-app {
                padding-top: 35px;
            }

            .cortex-arena {
                height: calc(100dvh - 140px);
                max-height: calc(100dvh - 140px);
            }

            .core-container {
                width: min(150px, 45vw);
                height: min(150px, 45vw);
            }

            .core-orb {
                width: 55px;
                height: 55px;
            }

            .ai-node {
                width: 24px;
                height: 24px;
            }

            .ai-node svg {
                width: 10px;
                height: 10px;
            }

            .core-container .node-gpt { top: 5px; left: 5px; }
            .core-container .node-gemini { top: 5px; right: 5px; }
            .core-container .node-claude { bottom: 18px; left: 5px; }
            .core-container .node-grok { bottom: 18px; right: 5px; }

            .omni-bar-container {
                bottom: 35px;
            }

            .omni-bar {
                width: calc(100% - 12px);
                padding: 3px 3px 3px 10px;
            }

            .omni-input {
                font-size: 0.75rem;
            }

            .omni-submit {
                width: 30px;
                height: 30px;
            }

            /* Smaller template chips */
            .template-chip {
                padding: 5px 8px;
                font-size: 0.6rem;
            }

            .verdict-decision {
                font-size: 1rem;
            }

            .verdict-summary {
                font-size: 0.7rem;
            }

            .auth-btn {
                padding: 4px 6px;
                font-size: 0.55rem;
            }

            .upgrade-btn {
                padding: 4px 6px;
                font-size: 0.5rem;
            }

            .history-toggle,
            .ai-settings-btn {
                width: 26px;
                height: 26px;
            }

            .site-footer {
                font-size: 0.45rem;
                gap: 8px;
            }
        }
    </style>
</head>
<body>
    <!-- Nebula Background -->
    <div class="nebula-bg">
        <div class="nebula-cloud cloud-1"></div>
        <div class="nebula-cloud cloud-2"></div>
        <div class="nebula-cloud cloud-3"></div>
    </div>

    <!-- Auth UI (Top Left) -->
    <div class="auth-container" id="authContainer">
        <!-- Loading state -->
        <div class="auth-loading" id="authLoading">
            <div class="auth-loading-spinner"></div>
        </div>

        <!-- Signed out state -->
        <div id="authSignedOut" style="display: none;">
            <button class="auth-btn auth-btn-signin" onclick="handleSignIn()">Sign In</button>
            <button class="auth-btn auth-btn-signup" onclick="handleSignUp()">Sign Up</button>
        </div>

        <!-- Signed in state -->
        <div id="authSignedIn" style="display: none; position: relative;">
            <div class="user-menu" id="userMenu" onclick="toggleUserMenu()">
                <div class="user-avatar" id="userAvatar">U</div>
                <span class="user-name" id="userName">User</span>
                <span class="user-tier user-tier-free" id="userTier">FREE</span>

                <div class="user-dropdown">
                    <div class="user-dropdown-item" onclick="handleManageAccount()">
                        <span>Account Settings</span>
                    </div>
                    <div class="user-dropdown-divider"></div>
                    <div class="user-dropdown-item" onclick="handleSignOut()">
                        <span>Sign Out</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Top Bar Right (Unified Container) -->
    <div class="top-bar-right">
        <!-- Upgrade Button -->
        <button class="upgrade-btn" onclick="showUpgradeModal()" title="Upgrade Plan">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="14" height="14" style="margin-right: 4px;">
                <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon>
            </svg>
            Upgrade
        </button>

        <!-- History Toggle Button -->
        <button class="history-toggle" onclick="toggleHistoryDrawer()" title="View History">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="12" cy="12" r="10"></circle>
                <polyline points="12 6 12 12 16 14"></polyline>
            </svg>
        </button>

        <!-- Usage Indicator -->
        <div class="usage-indicator" id="usageIndicator" data-tooltip="Daily Limit: Free users get 3 debates per day. Upgrade to Pro for unlimited debates and premium AI models." data-tooltip-pos="bottom" data-tooltip-indicator="none">
            <span>Free tier:</span>
            <span class="usage-count" id="usageCount">3/3</span>
            <span>debates left</span>
        </div>

        <!-- Model Tier Selector -->
        <div class="tier-selector" id="tierSelector">
            <button class="tier-selector-btn" id="tierSelectorBtn" onclick="toggleTierSelector()">
                <span id="tierSelectorLabel">Budget</span>
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <polyline points="6 9 12 15 18 9"></polyline>
                </svg>
            </button>
            <div class="tier-dropdown" id="tierDropdown">
                <div class="tier-option active" id="tierOptionBudget" onclick="selectTier('budget')">
                    <div class="tier-option-info">
                        <span class="tier-option-name">Budget</span>
                        <span class="tier-option-desc">GPT-4o-mini, Gemini Flash, Haiku</span>
                    </div>
                    <svg class="tier-option-check" id="tierCheckBudget" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polyline points="20 6 9 17 4 12"></polyline>
                    </svg>
                </div>
                <div class="tier-option locked" id="tierOptionPremium" onclick="selectTier('premium')">
                    <div class="tier-option-info">
                        <span class="tier-option-name">Premium</span>
                        <span class="tier-option-desc">GPT-4.1, Claude Opus, Gemini Pro</span>
                    </div>
                    <span class="tier-option-badge" id="tierPremiumBadge">PRO</span>
                </div>
            </div>
        </div>

        <!-- AI Settings Button -->
        <button class="ai-settings-btn" onclick="openAISettings()">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="12" cy="12" r="3"></circle>
                <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"></path>
            </svg>
            <span>AI Panel</span>
        </button>
    </div>

    <!-- AI Settings Overlay -->
    <div class="ai-settings-overlay" id="aiSettingsOverlay" onclick="closeAISettings()"></div>

    <!-- AI Settings Panel -->
    <div class="ai-settings-panel" id="aiSettingsPanel">
        <div class="ai-settings-header">
            <span class="ai-settings-title">AI Panel Settings</span>
            <button class="ai-settings-close" onclick="closeAISettings()">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="20" height="20">
                    <line x1="18" y1="6" x2="6" y2="18"></line>
                    <line x1="6" y1="6" x2="18" y2="18"></line>
                </svg>
            </button>
        </div>

        <!-- AI Selection Section -->
        <div class="ai-settings-section">
            <div class="ai-settings-section-title">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                    <circle cx="9" cy="7" r="4"></circle>
                    <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
                    <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
                </svg>
                Select AIs (2-4 required)
            </div>
            <div class="ai-select-grid">
                <!-- GPT -->
                <div class="ai-select-item selected" data-ai="openai" onclick="toggleAISelection('openai')">
                    <div class="ai-select-checkbox">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3">
                            <polyline points="20 6 9 17 4 12"></polyline>
                        </svg>
                    </div>
                    <div class="ai-select-icon gpt">
                        <svg viewBox="0 0 24 24" fill="currentColor">
                            <path d="M22.2819 9.8211a5.9847 5.9847 0 0 0-.5157-4.9108 6.0462 6.0462 0 0 0-6.5098-2.9A6.0651 6.0651 0 0 0 4.9807 4.1818a5.9847 5.9847 0 0 0-3.9977 2.9 6.0462 6.0462 0 0 0 .7427 7.0966 5.98 5.98 0 0 0 .511 4.9107 6.051 6.051 0 0 0 6.5146 2.9001A5.9847 5.9847 0 0 0 13.2599 24a6.0557 6.0557 0 0 0 5.7718-4.2058 5.9894 5.9894 0 0 0 3.9977-2.9001 6.0557 6.0557 0 0 0-.7475-7.0729zm-9.022 12.6081a4.4755 4.4755 0 0 1-2.8764-1.0408l.1419-.0804 4.7783-2.7582a.7948.7948 0 0 0 .3927-.6813v-6.7369l2.02 1.1686a.071.071 0 0 1 .038.052v5.5826a4.504 4.504 0 0 1-4.4945 4.4944zm-9.6607-4.1254a4.4708 4.4708 0 0 1-.5346-3.0137l.142.0852 4.783 2.7582a.7712.7712 0 0 0 .7806 0l5.8428-3.3685v2.3324a.0804.0804 0 0 1-.0332.0615L9.74 19.9502a4.4992 4.4992 0 0 1-6.1408-1.6464zM2.3408 7.8956a4.485 4.485 0 0 1 2.3655-1.9728V11.6a.7664.7664 0 0 0 .3879.6765l5.8144 3.3543-2.0201 1.1685a.0757.0757 0 0 1-.071 0l-4.8303-2.7865A4.504 4.504 0 0 1 2.3408 7.872zm16.5963 3.8558L13.1038 8.364l2.0201-1.1685a.0757.0757 0 0 1 .071 0l4.8303 2.7913a4.4944 4.4944 0 0 1-.6765 8.1042v-5.6772a.79.79 0 0 0-.407-.667zm2.0107-3.0231l-.142-.0852-4.7735-2.7818a.7759.7759 0 0 0-.7854 0L9.409 9.2297V6.8974a.0662.0662 0 0 1 .0284-.0615l4.8303-2.7866a4.4992 4.4992 0 0 1 6.6802 4.66zM8.3065 12.863l-2.02-1.1638a.0804.0804 0 0 1-.038-.0567V6.0742a4.4992 4.4992 0 0 1 7.3757-3.4537l-.142.0805L8.704 5.459a.7948.7948 0 0 0-.3927.6813zm1.0976-2.3654l2.602-1.4998 2.6069 1.4998v2.9994l-2.5974 1.4997-2.6067-1.4997Z"/>
                        </svg>
                    </div>
                    <div class="ai-select-info">
                        <span class="ai-select-name">GPT-4o</span>
                        <span class="ai-select-desc">Balanced & practical</span>
                    </div>
                </div>
                <!-- Gemini -->
                <div class="ai-select-item selected" data-ai="gemini" onclick="toggleAISelection('gemini')">
                    <div class="ai-select-checkbox">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3">
                            <polyline points="20 6 9 17 4 12"></polyline>
                        </svg>
                    </div>
                    <div class="ai-select-icon gemini">
                        <svg viewBox="0 0 24 24" fill="currentColor">
                            <path d="M12 0C5.352 0 0 5.352 0 12s5.352 12 12 12 12-5.352 12-12S18.648 0 12 0zm0 2.4c5.304 0 9.6 4.296 9.6 9.6 0 5.304-4.296 9.6-9.6 9.6-5.304 0-9.6-4.296-9.6-9.6 0-5.304 4.296-9.6 9.6-9.6zm0 1.2a8.4 8.4 0 100 16.8 8.4 8.4 0 000-16.8z"/>
                        </svg>
                    </div>
                    <div class="ai-select-info">
                        <span class="ai-select-name">Gemini</span>
                        <span class="ai-select-desc">Trends & innovation</span>
                    </div>
                </div>
                <!-- Claude -->
                <div class="ai-select-item selected" data-ai="claude" onclick="toggleAISelection('claude')">
                    <div class="ai-select-checkbox">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3">
                            <polyline points="20 6 9 17 4 12"></polyline>
                        </svg>
                    </div>
                    <div class="ai-select-icon claude">
                        <svg viewBox="0 0 24 24" fill="currentColor">
                            <path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5"/>
                        </svg>
                    </div>
                    <div class="ai-select-info">
                        <span class="ai-select-name">Claude</span>
                        <span class="ai-select-desc">Risk-aware analysis</span>
                    </div>
                </div>
                <!-- Grok -->
                <div class="ai-select-item selected" data-ai="grok" onclick="toggleAISelection('grok')">
                    <div class="ai-select-checkbox">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3">
                            <polyline points="20 6 9 17 4 12"></polyline>
                        </svg>
                    </div>
                    <div class="ai-select-icon grok">
                        <svg viewBox="0 0 24 24" fill="currentColor">
                            <path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/>
                        </svg>
                    </div>
                    <div class="ai-select-info">
                        <span class="ai-select-name">Grok</span>
                        <span class="ai-select-desc">Direct & unfiltered</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Persona Customization Section -->
        <div class="ai-settings-section">
            <div class="ai-settings-section-title">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                    <circle cx="12" cy="7" r="4"></circle>
                </svg>
                Customize Personas
            </div>
            <div class="persona-list">
                <!-- GPT Persona -->
                <div class="persona-item" id="personaGpt">
                    <div class="persona-icon gpt">
                        <svg viewBox="0 0 24 24" fill="currentColor">
                            <path d="M22.2819 9.8211a5.9847 5.9847 0 0 0-.5157-4.9108 6.0462 6.0462 0 0 0-6.5098-2.9A6.0651 6.0651 0 0 0 4.9807 4.1818a5.9847 5.9847 0 0 0-3.9977 2.9 6.0462 6.0462 0 0 0 .7427 7.0966 5.98 5.98 0 0 0 .511 4.9107 6.051 6.051 0 0 0 6.5146 2.9001A5.9847 5.9847 0 0 0 13.2599 24a6.0557 6.0557 0 0 0 5.7718-4.2058 5.9894 5.9894 0 0 0 3.9977-2.9001 6.0557 6.0557 0 0 0-.7475-7.0729z"/>
                        </svg>
                    </div>
                    <div class="persona-content">
                        <div class="persona-name">GPT-4o</div>
                        <select class="persona-select" id="personaSelectGpt" onchange="updatePersona('openai', this.value)">
                            <option value="balanced">Balanced & Practical (Default)</option>
                            <option value="aggressive">Aggressive & Bold</option>
                            <option value="conservative">Conservative & Cautious</option>
                            <option value="creative">Creative & Unconventional</option>
                            <option value="devils-advocate">Devil's Advocate</option>
                        </select>
                    </div>
                </div>
                <!-- Gemini Persona -->
                <div class="persona-item" id="personaGemini">
                    <div class="persona-icon gemini">
                        <svg viewBox="0 0 24 24" fill="currentColor">
                            <path d="M12 0C5.352 0 0 5.352 0 12s5.352 12 12 12 12-5.352 12-12S18.648 0 12 0z"/>
                        </svg>
                    </div>
                    <div class="persona-content">
                        <div class="persona-name">Gemini</div>
                        <select class="persona-select" id="personaSelectGemini" onchange="updatePersona('gemini', this.value)">
                            <option value="innovative">Trends & Innovation (Default)</option>
                            <option value="aggressive">Aggressive & Bold</option>
                            <option value="conservative">Conservative & Cautious</option>
                            <option value="creative">Creative & Unconventional</option>
                            <option value="devils-advocate">Devil's Advocate</option>
                        </select>
                    </div>
                </div>
                <!-- Claude Persona -->
                <div class="persona-item" id="personaClaude">
                    <div class="persona-icon claude">
                        <svg viewBox="0 0 24 24" fill="currentColor">
                            <path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5"/>
                        </svg>
                    </div>
                    <div class="persona-content">
                        <div class="persona-name">Claude</div>
                        <select class="persona-select" id="personaSelectClaude" onchange="updatePersona('claude', this.value)">
                            <option value="risk-aware">Risk-Aware Analysis (Default)</option>
                            <option value="aggressive">Aggressive & Bold</option>
                            <option value="conservative">Conservative & Cautious</option>
                            <option value="creative">Creative & Unconventional</option>
                            <option value="devils-advocate">Devil's Advocate</option>
                        </select>
                    </div>
                </div>
                <!-- Grok Persona -->
                <div class="persona-item" id="personaGrok">
                    <div class="persona-icon grok">
                        <svg viewBox="0 0 24 24" fill="currentColor">
                            <path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231z"/>
                        </svg>
                    </div>
                    <div class="persona-content">
                        <div class="persona-name">Grok</div>
                        <select class="persona-select" id="personaSelectGrok" onchange="updatePersona('grok', this.value)">
                            <option value="direct">Direct & Unfiltered (Default)</option>
                            <option value="aggressive">Aggressive & Bold</option>
                            <option value="conservative">Conservative & Cautious</option>
                            <option value="creative">Creative & Unconventional</option>
                            <option value="devils-advocate">Devil's Advocate</option>
                        </select>
                    </div>
                </div>
            </div>
        </div>

        <div class="ai-settings-note">
            Changes apply to your next debate. Select at least 2 AIs.
        </div>
    </div>

    <!-- History Overlay -->
    <div class="history-overlay" id="historyOverlay" onclick="closeHistoryDrawer()"></div>

    <!-- History Drawer -->
    <div class="history-drawer" id="historyDrawer">
        <div class="history-drawer-header">
            <span class="history-drawer-title">Decision History</span>
            <button class="history-drawer-close" onclick="closeHistoryDrawer()">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="18" height="18">
                    <line x1="18" y1="6" x2="6" y2="18"></line>
                    <line x1="6" y1="6" x2="18" y2="18"></line>
                </svg>
            </button>
        </div>
        <div class="history-drawer-content" id="historyContent">
            <div class="history-empty">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                    <circle cx="12" cy="12" r="10"></circle>
                    <polyline points="12 6 12 12 16 14"></polyline>
                </svg>
                <p>No decisions yet.<br>Start your first debate!</p>
            </div>
        </div>
    </div>

    <!-- Main App -->
    <div class="cortex-app">
        <!-- The Arena -->
        <div class="cortex-arena" id="arena">
            <!-- Live Debate Stream (left side during debate) -->
            <div class="debate-stream" id="debateStream">
                <div class="stream-header-bar">
                    <span class="stream-title">Live Debate</span>
                    <span class="stream-round" id="streamRound">Waiting...</span>
                </div>
            </div>

            <!-- Core Container (orb + nodes) -->
            <div class="core-container">
                <!-- Central Core -->
                <div class="core-orb" id="coreOrb">
                    <span class="core-text" id="coreText">Ready</span>
                </div>

                <!-- AI Nodes (Official Brand Logos) -->
                <div class="ai-node node-gpt" id="nodeGpt" data-tooltip="GPT-4o (OpenAI): Excels at balanced analysis and practical trade-offs" data-tooltip-indicator="none">
                    <svg viewBox="0 0 24 24" fill="currentColor">
                        <path d="M22.2819 9.8211a5.9847 5.9847 0 0 0-.5157-4.9108 6.0462 6.0462 0 0 0-6.5098-2.9A6.0651 6.0651 0 0 0 4.9807 4.1818a5.9847 5.9847 0 0 0-3.9977 2.9 6.0462 6.0462 0 0 0 .7427 7.0966 5.98 5.98 0 0 0 .511 4.9107 6.051 6.051 0 0 0 6.5146 2.9001A5.9847 5.9847 0 0 0 13.2599 24a6.0557 6.0557 0 0 0 5.7718-4.2058 5.9894 5.9894 0 0 0 3.9977-2.9001 6.0557 6.0557 0 0 0-.7475-7.0729zm-9.022 12.6081a4.4755 4.4755 0 0 1-2.8764-1.0408l.1419-.0804 4.7783-2.7582a.7948.7948 0 0 0 .3927-.6813v-6.7369l2.02 1.1686a.071.071 0 0 1 .038.052v5.5826a4.504 4.504 0 0 1-4.4945 4.4944zm-9.6607-4.1254a4.4708 4.4708 0 0 1-.5346-3.0137l.142.0852 4.783 2.7582a.7712.7712 0 0 0 .7806 0l5.8428-3.3685v2.3324a.0804.0804 0 0 1-.0332.0615L9.74 19.9502a4.4992 4.4992 0 0 1-6.1408-1.6464zM2.3408 7.8956a4.485 4.485 0 0 1 2.3655-1.9728V11.6a.7664.7664 0 0 0 .3879.6765l5.8144 3.3543-2.0201 1.1685a.0757.0757 0 0 1-.071 0l-4.8303-2.7865A4.504 4.504 0 0 1 2.3408 7.8956zm16.0993 3.8558L12.6 8.3829l2.02-1.1638a.0757.0757 0 0 1 .071 0l4.8303 2.7913a4.4944 4.4944 0 0 1-.6765 8.1042v-5.6772a.79.79 0 0 0-.407-.667zm2.0107-3.0231l-.142-.0852-4.7735-2.7818a.7759.7759 0 0 0-.7854 0L9.409 9.2297V6.8974a.0662.0662 0 0 1 .0284-.0615l4.8303-2.7866a4.4992 4.4992 0 0 1 6.6802 4.66zM8.3065 12.863l-2.02-1.1638a.0804.0804 0 0 1-.038-.0567V6.0742a4.4992 4.4992 0 0 1 7.3757-3.4537l-.142.0805L8.704 5.459a.7948.7948 0 0 0-.3927.6813zm1.0976-2.3654l2.602-1.4998 2.6069 1.4998v2.9994l-2.5974 1.4997-2.6067-1.4997Z"/>
                    </svg>
                    <span class="node-name">GPT-4o</span>
                </div>
                <div class="ai-node node-gemini" id="nodeGemini" data-tooltip="Gemini (Google): Spots emerging trends and unconventional angles" data-tooltip-indicator="none">
                    <svg viewBox="0 0 24 24" fill="currentColor">
                        <path d="M12 1L14.5 9.5L23 12L14.5 14.5L12 23L9.5 14.5L1 12L9.5 9.5L12 1Z"/>
                    </svg>
                    <span class="node-name">Gemini</span>
                </div>
                <div class="ai-node node-claude" id="nodeClaude" data-tooltip="Claude (Anthropic): Identifies risks and unintended consequences" data-tooltip-indicator="none">
                    <svg viewBox="0 0 24 24" fill="currentColor">
                        <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10c1.5 0 2.9-.3 4.2-.9l-1.5-2.6c-.9.3-1.8.5-2.7.5-4.1 0-7.5-3.4-7.5-7.5S7.9 4 12 4c2.3 0 4.3 1 5.7 2.6l2.1-2.1C17.7 2.7 15 1.5 12 2z"/>
                    </svg>
                    <span class="node-name">Claude</span>
                </div>
                <div class="ai-node node-grok" id="nodeGrok" data-tooltip="Grok (xAI): Cuts through complexity to find simple truths" data-tooltip-indicator="none">
                    <svg viewBox="0 0 24 24" fill="currentColor">
                        <path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/>
                    </svg>
                    <span class="node-name">Grok</span>
                </div>

                <!-- Conflict Laser -->
                <div class="conflict-laser" id="conflictLaser"></div>

                <!-- SVG Conflict Lines (Node-to-Node connections) -->
                <svg class="conflict-lines-svg" id="conflictLinesSvg">
                    <line class="conflict-line" id="conflictLine-gpt-gemini" />
                    <line class="conflict-line" id="conflictLine-gpt-claude" />
                    <line class="conflict-line" id="conflictLine-gpt-grok" />
                    <line class="conflict-line" id="conflictLine-gemini-claude" />
                    <line class="conflict-line" id="conflictLine-gemini-grok" />
                    <line class="conflict-line" id="conflictLine-claude-grok" />
                </svg>

                <!-- Status -->
                <div class="arena-status">
                    <div class="status-text" id="statusText">Ask the Council</div>
                    <div class="status-phase" id="statusPhase">Enter your question below</div>
                    <div class="round-dots" id="roundDots">
                        <div class="round-dot"></div>
                        <div class="round-dot"></div>
                        <div class="round-dot"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Devil's Advocate Toggle -->
        <div class="devil-toggle" id="devilToggle" data-tooltip="Devil's Advocate Mode: Forces one AI to challenge the majority opinion and find weaknesses in the consensus" data-tooltip-pos="bottom" data-tooltip-indicator="none">
            <label>
                <input type="checkbox" id="devilAdvocate">
                <span class="devil-switch"></span>
                <span class="devil-icon">&#128520;</span>
                <span>Devil's Advocate</span>
            </label>
        </div>

        <!-- Omni-Bar Input -->
        <div class="omni-bar-container">
            <form class="omni-bar" id="debateForm">
                <input
                    type="text"
                    class="omni-input"
                    id="questionInput"
                    placeholder="Ask the Council..."
                    maxlength="500"
                    autocomplete="off"
                    required
                >
                <div class="status-lights">
                    <div class="status-light gpt" id="lightGpt"></div>
                    <div class="status-light gemini" id="lightGemini"></div>
                    <div class="status-light grok" id="lightGrok"></div>
                    <div class="status-light claude" id="lightClaude"></div>
                </div>
                <button type="submit" class="omni-submit" id="submitBtn">
                    <svg viewBox="0 0 24 24"><path d="M5 12h14M12 5l7 7-7 7"/></svg>
                </button>
            </form>
            <!-- Quick Template Chips -->
            <div class="template-chips" id="templateChips">
                <div class="template-chip" onclick="useTemplate('Should I invest in Bitcoin right now?', this)">
                    <span>&#128200;</span> Crypto
                </div>
                <div class="template-chip" onclick="useTemplate('Should I switch jobs for a 20% salary increase?', this)">
                    <span>&#128188;</span> Career
                </div>
                <div class="template-chip" onclick="useTemplate('React vs Vue vs Svelte for a new project?', this)">
                    <span>&#128187;</span> Tech Stack
                </div>
                <div class="template-chip" onclick="useTemplate('What should I watch tonight? I like sci-fi thrillers', this)">
                    <span>&#127871;</span> Movie Rec
                </div>
                <div class="template-chip" onclick="useTemplate('Help me understand how photosynthesis works step by step', this)">
                    <span>&#9883;</span> Homework
                </div>
                <div class="template-chip" onclick="useTemplate('Best noise-canceling headphones under $300?', this)">
                    <span>&#128722;</span> Product Pick
                </div>
                <div class="template-chip" onclick="useTemplate('Is buying a house better than renting in 2024?', this)">
                    <span>&#127968;</span> Life Decision
                </div>
                <div class="template-chip" onclick="useTemplate('Plan a 5-day trip to Japan for first-time visitors', this)">
                    <span>&#9992;</span> Travel Plan
                </div>
            </div>
            <!-- Context Input (Expandable) -->
            <button class="context-toggle" id="contextToggle" onclick="toggleContext()" data-tooltip="Add Context: Budget, timeline, or constraints to get more tailored advice from the AI council" data-tooltip-pos="bottom" data-tooltip-indicator="none">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M6 9l6 6 6-6"/>
                </svg>
                <span>Add context or constraints</span>
            </button>
            <div class="context-input-container" id="contextContainer">
                <textarea
                    class="context-input"
                    id="contextInput"
                    placeholder="E.g., 'I have $10k budget', 'Must be remote-friendly', 'For a team of 5'..."
                    maxlength="300"
                    rows="3"
                ></textarea>
            </div>
        </div>
    </div>

    <!-- Site Footer -->
    <footer class="site-footer">
        <span class="copyright">&copy; 2025 ConsensusAI</span>
        <a href="/privacy.html">Privacy</a>
        <a href="/terms.html">Terms</a>
        <a href="/disclaimer.html">Disclaimer</a>
        <a href="/">Classic View</a>
    </footer>

    <!-- Verdict Overlay -->
    <div class="verdict-overlay" id="verdictOverlay">
        <div class="verdict-panel">
            <button class="verdict-close" onclick="closeVerdict()">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M18 6L6 18M6 6l12 12"/>
                </svg>
            </button>

            <div class="verdict-header">
                <div class="consensus-badge" id="consensusBadge">
                    <span>CONSENSUS REACHED</span>
                </div>
                <div class="confidence-display">
                    <div class="confidence-value" id="confidenceValue">4/4</div>
                    <div class="confidence-label" id="confidenceLabel">AI Agreement</div>
                </div>
            </div>

            <div class="verdict-decision" id="verdictDecision">YES, with conditions.</div>
            <div class="verdict-question" id="verdictQuestion">Should I invest in Bitcoin now?</div>

            <!-- Spectrum Slider -->
            <div class="spectrum-container">
                <div class="spectrum-label">AI Position Spectrum <span style="opacity:0.5">(click to inspect)</span></div>
                <div class="spectrum-track">
                    <div class="spectrum-avatars">
                        <div class="spectrum-avatar gpt" id="specGpt" style="left: 80%" onclick="openInspector('openai')" title="Click to see GPT analysis">G</div>
                        <div class="spectrum-avatar gemini" id="specGemini" style="left: 75%" onclick="openInspector('gemini')" title="Click to see Gemini analysis">Gm</div>
                        <div class="spectrum-avatar grok" id="specGrok" style="left: 85%" onclick="openInspector('grok')" title="Click to see Grok analysis">Gk</div>
                        <div class="spectrum-avatar claude" id="specClaude" style="left: 70%" onclick="openInspector('claude')" title="Click to see Claude analysis">C</div>
                    </div>
                </div>
                <div class="spectrum-labels">
                    <span>No</span>
                    <span>Conditional</span>
                    <span>Yes</span>
                </div>
            </div>

            <!-- AI Agreement Grid - shows all 4 AI responses -->
            <div class="ai-agreement-grid" id="aiAgreementGrid">
                <div class="ai-response-card gpt" id="aiRespGpt" onclick="openInspector('openai')">
                    <div class="ai-resp-header">
                        <span class="ai-resp-name">GPT-4o</span>
                        <span class="ai-resp-verdict" id="respVerdictGpt">-</span>
                    </div>
                    <p class="ai-resp-summary" id="respSummaryGpt">Loading...</p>
                </div>
                <div class="ai-response-card gemini" id="aiRespGemini" onclick="openInspector('gemini')">
                    <div class="ai-resp-header">
                        <span class="ai-resp-name">Gemini</span>
                        <span class="ai-resp-verdict" id="respVerdictGemini">-</span>
                    </div>
                    <p class="ai-resp-summary" id="respSummaryGemini">Loading...</p>
                </div>
                <div class="ai-response-card claude" id="aiRespClaude" onclick="openInspector('claude')">
                    <div class="ai-resp-header">
                        <span class="ai-resp-name">Claude</span>
                        <span class="ai-resp-verdict" id="respVerdictClaude">-</span>
                    </div>
                    <p class="ai-resp-summary" id="respSummaryClaude">Loading...</p>
                </div>
                <div class="ai-response-card grok" id="aiRespGrok" onclick="openInspector('grok')">
                    <div class="ai-resp-header">
                        <span class="ai-resp-name">Grok</span>
                        <span class="ai-resp-verdict" id="respVerdictGrok">-</span>
                    </div>
                    <p class="ai-resp-summary" id="respSummaryGrok">Loading...</p>
                </div>
            </div>

            <!-- Key Insights (2-Column Layout) -->
            <div class="attribution-section">
                <div class="attribution-title">Key Insights</div>
                <div class="insights-grid">
                    <div class="insights-box pro">
                        <div class="insights-box-title">
                            <span>&#x2713;</span> Supporting Arguments
                        </div>
                        <ul class="insights-list" id="proInsightsList"></ul>
                    </div>
                    <div class="insights-box con">
                        <div class="insights-box-title">
                            <span>&#x26A0;</span> Counterpoints & Caveats
                        </div>
                        <ul class="insights-list" id="conInsightsList"></ul>
                    </div>
                </div>
                <div class="synthesis-summary">
                    <p id="attributionText">Loading...</p>
                </div>
            </div>

            <!-- Action Plan -->
            <div class="action-grid" id="actionGrid">
                <div class="action-box immediate">
                    <div class="action-box-title">
                        <span>&#x2713;</span> Immediate Actions
                    </div>
                    <ul class="action-list" id="immediateActions"></ul>
                </div>
                <div class="action-box risks">
                    <div class="action-box-title">
                        <span>&#x26A0;</span> Key Risks
                    </div>
                    <ul class="action-list" id="risksList"></ul>
                </div>
                <div class="action-box critical">
                    <div class="action-box-title">
                        <span>&#x2139;</span> Before Proceeding
                    </div>
                    <ul class="action-list" id="criticalList"></ul>
                </div>
            </div>

            <!-- Bias Badge -->
            <!-- How Decision Was Made -->
            <div class="decision-timeline">
                <div class="timeline-header">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                        <path d="M12 8v4l3 3"/>
                        <circle cx="12" cy="12" r="9"/>
                    </svg>
                    <span>How This Decision Was Made</span>
                </div>
                <div class="timeline-steps" id="decisionTimeline">
                    <!-- Populated by JS -->
                </div>
            </div>

            <!-- Full Debate Transcript (Collapsible) -->
            <div class="debate-transcript">
                <button class="transcript-toggle" onclick="toggleTranscript()">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                        <path d="M21 15a2 2 0 01-2 2H7l-4 4V5a2 2 0 012-2h14a2 2 0 012 2z"/>
                    </svg>
                    <span>View Full AI Debate</span>
                    <svg class="toggle-chevron" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M6 9l6 6 6-6"/>
                    </svg>
                </button>
                <div class="transcript-content" id="transcriptContent">
                    <!-- Populated by JS -->
                </div>
            </div>

            <div class="bias-badge" data-tooltip="Bias Check: This recommendation was cross-validated by 4 different AI models to reduce bias and hallucination risk" data-tooltip-indicator="none">
                <svg viewBox="0 0 24 24">
                    <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/>
                    <path d="M9 12l2 2 4-4"/>
                </svg>
                <span>Verified by 4-Model Cross-Check</span>
            </div>

            <!-- Actions -->
            <div class="verdict-actions">
                <button class="verdict-btn verdict-btn-secondary" onclick="copyShareLink()">
                    <svg viewBox="0 0 24 24"><path d="M4 12v8a2 2 0 002 2h12a2 2 0 002-2v-8M16 6l-4-4-4 4M12 2v13"/></svg>
                    Share
                </button>
                <button class="verdict-btn verdict-btn-secondary" onclick="askFollowup()">
                    <svg viewBox="0 0 24 24"><path d="M21 15a2 2 0 01-2 2H7l-4 4V5a2 2 0 012-2h14a2 2 0 012 2z"/></svg>
                    Ask Follow-up
                </button>
                <button class="verdict-btn verdict-btn-primary" onclick="newDebate()">
                    <svg viewBox="0 0 24 24"><path d="M12 5v14M5 12h14"/></svg>
                    New Question
                </button>
            </div>

            <!-- Follow-up Section -->
            <div class="followup-section" id="followupSection">
                <h3 class="followup-title">Ask a Follow-up Question</h3>
                <div class="followup-input-row">
                    <input type="text" class="followup-input" id="followupInput" placeholder="e.g., What if I have a shorter time horizon?">
                    <button class="followup-btn" onclick="submitFollowup()">Ask</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Node Inspector Overlay -->
    <div class="node-inspector-overlay" id="nodeInspector" onclick="closeInspector()">
        <div class="glass-dossier" onclick="event.stopPropagation()">
            <button class="dossier-close" onclick="closeInspector()">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M18 6L6 18M6 6l12 12"/>
                </svg>
            </button>
            <div class="dossier-header">
                <div class="dossier-icon" id="dossierIcon"></div>
                <h2 class="dossier-title" id="dossierTitle">GPT-4o</h2>
                <span class="dossier-verdict" id="dossierVerdict">YES</span>
            </div>
            <p class="dossier-body" id="dossierBody">Loading analysis...</p>
            <div class="confidence-meter">
                <span>Confidence</span>
                <div class="meter-bar">
                    <div class="fill" id="dossierMeter" style="width: 80%; background: var(--ai-gpt);"></div>
                </div>
                <span id="dossierConfidence">8/10</span>
            </div>
        </div>
    </div>

    <!-- Tactical Drawer Handle -->
    <div class="tactical-handle" id="tacticalHandle" onclick="toggleDrawer()">
        <svg class="handle-icon" viewBox="0 0 24 24">
            <path d="M4 14h16M4 10h16M12 3v3M12 18v3"/>
        </svg>
        <span class="handle-text">View Action Plan</span>
    </div>

    <!-- Tactical Drawer -->
    <div class="tactical-drawer" id="tacticalDrawer">
        <div class="drawer-header">
            <h2 class="drawer-title">Tactical Analysis</h2>
            <button class="drawer-close" onclick="toggleDrawer()">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M18 6L6 18M6 6l12 12"/>
                </svg>
            </button>
        </div>
        <div class="drawer-grid">
            <div class="drawer-card actions">
                <h3><span>&#10003;</span> Immediate Actions</h3>
                <ul id="drawerActions">
                    <li>Loading...</li>
                </ul>
            </div>
            <div class="drawer-card risks">
                <h3><span>&#9888;</span> Key Risks</h3>
                <ul id="drawerRisks">
                    <li>Loading...</li>
                </ul>
            </div>
            <div class="drawer-card timeline">
                <h3><span>&#8986;</span> Timeline</h3>
                <ul id="drawerTimeline">
                    <li>Loading...</li>
                </ul>
            </div>
            <div class="drawer-card indicators">
                <h3><span>&#9733;</span> Success Indicators</h3>
                <ul id="drawerIndicators">
                    <li>Loading...</li>
                </ul>
            </div>
        </div>
    </div>

    <!-- Timeline Scrubber -->
    <div class="timeline-scrubber" id="timelineScrubber">
        <div class="scrubber-label">Debate Timeline</div>
        <div class="scrubber-track">
            <div class="scrubber-progress" id="scrubberProgress" style="width: 100%;"></div>
            <input type="range" class="scrubber-input" id="scrubberInput" min="0" max="3" value="3" oninput="scrubTimeline(this.value)">
        </div>
        <div class="scrubber-labels" id="scrubberLabels">
            <span>Round 1</span>
            <span>Round 2</span>
            <span>Final</span>
        </div>
        <div class="scrubber-summary" id="scrubberSummary">
            Final verdict reached with consensus.
        </div>
    </div>

    <!-- Toast -->
    <div class="toast" id="toast"></div>

    <!-- Upgrade Modal -->
    <div class="upgrade-overlay" id="upgradeOverlay" onclick="closeUpgradeModal(event)">
        <div class="upgrade-modal" onclick="event.stopPropagation()">
            <div class="upgrade-modal-header">
                <div class="upgrade-modal-icon">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon>
                    </svg>
                </div>
                <h2 class="upgrade-modal-title">Upgrade to Pro</h2>
                <p class="upgrade-modal-subtitle">Unlock unlimited debates and premium AI models</p>
            </div>
            <div class="upgrade-features">
                <div class="upgrade-feature">
                    <svg class="upgrade-feature-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polyline points="20 6 9 17 4 12"></polyline>
                    </svg>
                    <span class="upgrade-feature-text">Unlimited debates per day</span>
                </div>
                <div class="upgrade-feature">
                    <svg class="upgrade-feature-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polyline points="20 6 9 17 4 12"></polyline>
                    </svg>
                    <span class="upgrade-feature-text">Premium AI models (GPT-4o, Claude 3.5, Gemini Pro)</span>
                </div>
                <div class="upgrade-feature">
                    <svg class="upgrade-feature-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polyline points="20 6 9 17 4 12"></polyline>
                    </svg>
                    <span class="upgrade-feature-text">Priority processing & faster responses</span>
                </div>
                <div class="upgrade-feature">
                    <svg class="upgrade-feature-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polyline points="20 6 9 17 4 12"></polyline>
                    </svg>
                    <span class="upgrade-feature-text">Export debates as PDF reports</span>
                </div>
            </div>
            <div class="upgrade-pricing">
                <div class="upgrade-price">$19<span>/month</span></div>
            </div>
            <button class="upgrade-cta" id="upgradeCtaBtn" onclick="handleUpgrade()">
                Upgrade to Pro
            </button>
            <p style="color: var(--text-muted); font-size: 12px; margin-top: 12px; text-align: center;">Cancel anytime. Secure payment via Stripe.</p>
        </div>
    </div>

    <script>
        // ============================================
        // CONSENSUSAI - LIVING CORTEX ENGINE
        // ============================================

        // State
        let currentResult = null;
        let sseConnection = null;
        let selectedTier = 'budget';
        let currentRound = 1;

        // DOM Elements
        const form = document.getElementById('debateForm');
        const input = document.getElementById('questionInput');
        const submitBtn = document.getElementById('submitBtn');
        const coreOrb = document.getElementById('coreOrb');
        const coreText = document.getElementById('coreText');
        const statusText = document.getElementById('statusText');
        const statusPhase = document.getElementById('statusPhase');
        const verdictOverlay = document.getElementById('verdictOverlay');
        const toast = document.getElementById('toast');
        const devilAdvocate = document.getElementById('devilAdvocate');
        const templateChips = document.getElementById('templateChips');

        // ============================================
        // QUICK TEMPLATE CHIPS
        // ============================================

        let currentTemplateValue = null; // Track if using a template

        function useTemplate(question, chipEl) {
            // Remove selected state from all chips
            templateChips.querySelectorAll('.template-chip').forEach(c => c.classList.remove('selected'));

            // Mark this chip as selected
            chipEl.classList.add('selected');

            // Store template value and populate input
            currentTemplateValue = question;
            input.value = question;
            input.focus();
        }

        // Hide chips when user starts typing custom text
        input.addEventListener('input', () => {
            const currentValue = input.value;

            // If input is empty, show chips and reset
            if (currentValue === '') {
                currentTemplateValue = null;
                templateChips.style.display = 'grid';
                templateChips.style.opacity = '1';
                templateChips.style.transform = 'translateY(0)';
                templateChips.querySelectorAll('.template-chip').forEach(c => {
                    c.classList.remove('dissolving', 'selected');
                });
            }
            // If user modified the template or is typing fresh, hide chips
            else if (currentValue !== currentTemplateValue && templateChips.style.display !== 'none') {
                currentTemplateValue = null;
                templateChips.style.opacity = '0';
                templateChips.style.transform = 'translateY(10px)';
                setTimeout(() => {
                    templateChips.style.display = 'none';
                }, 300);
            }
        });

        // ============================================
        // STATUS LIGHTS
        // ============================================

        function setLightsActive(active) {
            ['lightGpt', 'lightGemini', 'lightGrok', 'lightClaude'].forEach(id => {
                document.getElementById(id).classList.toggle('active', active);
            });
        }

        function setNodeActive(llmId, active) {
            const map = { openai: 'nodeGpt', gemini: 'nodeGemini', grok: 'nodeGrok', claude: 'nodeClaude' };
            const node = document.getElementById(map[llmId]);
            if (node) node.classList.toggle('active', active);
        }

        // ============================================
        // LIVE DEBATE STREAM
        // ============================================

        const debateStream = document.getElementById('debateStream');
        const conflictLaser = document.getElementById('conflictLaser');
        let previousDecisions = {}; // Track decisions to detect conflicts

        const modelNames = {
            openai: 'GPT-4o',
            gemini: 'Gemini',
            claude: 'Claude',
            grok: 'Grok'
        };

        function clearStream() {
            debateStream.innerHTML = `
                <div class="stream-header-bar">
                    <span class="stream-title">Live Debate</span>
                    <span class="stream-round" id="streamRound">Starting...</span>
                </div>
            `;
            previousDecisions = {};
            clearConflictLines();
        }

        function showStream() {
            debateStream.classList.add('active');
            arena.classList.add('debating');
        }

        function hideStream() {
            debateStream.classList.remove('active');
            arena.classList.remove('debating');
        }

        function updateStreamRound(round) {
            const roundEl = document.getElementById('streamRound');
            if (roundEl) {
                roundEl.textContent = `Round ${round}`;
            }
        }

        function addStreamEntry(llmId, data, round) {
            // Remove empty state if present
            const empty = debateStream.querySelector('.stream-empty');
            if (empty) empty.remove();

            // Detect conflict (different decision from majority)
            const decision = data.decision || 'ANALYZING';
            let isConflict = false;
            let isRevision = false;

            // Check if this conflicts with previous entries
            const prevDecision = previousDecisions[llmId];
            if (prevDecision && prevDecision !== decision) {
                isRevision = true;
            }

            // Check if disagreeing with others
            const otherDecisions = Object.entries(previousDecisions)
                .filter(([id]) => id !== llmId)
                .map(([, d]) => d);

            if (otherDecisions.length > 0 && !otherDecisions.includes(decision)) {
                isConflict = true;
            }

            previousDecisions[llmId] = decision;

            // Fire laser on conflict and draw lines between disagreeing nodes
            if (isConflict) {
                triggerConflict(llmId);
            }

            // Build entry
            const entry = document.createElement('div');
            const llmClass = llmId === 'openai' ? 'gpt' : llmId;
            entry.className = `stream-entry entry-${llmClass}`;
            if (isConflict) entry.classList.add('conflict');
            if (isRevision) entry.classList.add('revision');

            // Determine tag
            let tagHtml = `<span class="stream-tag">ROUND ${round}</span>`;
            if (isConflict) {
                tagHtml = `<span class="stream-tag objection">OBJECTION</span>`;
            } else if (isRevision) {
                tagHtml = `<span class="stream-tag revision">REVISING</span>`;
            }

            // Decision badge
            const decisionClass = decision === 'YES' ? 'decision-yes' :
                                  decision === 'NO' ? 'decision-no' : 'decision-conditional';

            const keyArg = data.key_argument || data.position || 'Analyzing...';

            entry.innerHTML = `
                <div class="stream-header">
                    <span class="stream-model">${modelNames[llmId] || llmId}</span>
                    ${tagHtml}
                </div>
                <div class="stream-text">
                    <span class="stream-decision ${decisionClass}">${decision}</span>
                    ${keyArg}
                </div>
            `;

            debateStream.appendChild(entry);

            // Scroll to bottom
            debateStream.scrollTop = debateStream.scrollHeight;

            // Highlight node
            highlightNode(llmId);
        }

        function highlightNode(llmId) {
            const map = { openai: 'nodeGpt', gemini: 'nodeGemini', grok: 'nodeGrok', claude: 'nodeClaude' };
            const node = document.getElementById(map[llmId]);
            if (node) {
                node.classList.add('active');
                setTimeout(() => node.classList.remove('active'), 1500);
            }
        }

        function triggerConflict(conflictingLlmId = null) {
            // Fire laser
            conflictLaser.classList.add('active');
            setTimeout(() => conflictLaser.classList.remove('active'), 600);

            // Shake screen
            const arena = document.getElementById('arena');
            arena.classList.add('shaking');
            setTimeout(() => arena.classList.remove('shaking'), 400);

            // Flash core red
            coreOrb.classList.add('conflict');
            setTimeout(() => {
                if (!coreOrb.classList.contains('consensus')) {
                    coreOrb.classList.remove('conflict');
                }
            }, 1000);

            // Draw conflict lines between disagreeing nodes
            if (conflictingLlmId) {
                drawConflictLines(conflictingLlmId);
            }
        }

        // Draw SVG lines between disagreeing AI nodes
        function drawConflictLines(newConflictingLlmId) {
            const nodeIdMap = { openai: 'gpt', gemini: 'gemini', grok: 'grok', claude: 'claude' };
            const newNodeKey = nodeIdMap[newConflictingLlmId] || newConflictingLlmId;
            const newDecision = previousDecisions[newConflictingLlmId];

            // Find all nodes that disagree with the new one
            Object.entries(previousDecisions).forEach(([llmId, decision]) => {
                if (llmId === newConflictingLlmId) return;
                if (decision !== newDecision) {
                    const otherNodeKey = nodeIdMap[llmId] || llmId;
                    // Create a sorted line ID
                    const lineId = [newNodeKey, otherNodeKey].sort().join('-');
                    showConflictLine(lineId, newNodeKey, otherNodeKey);
                }
            });
        }

        function showConflictLine(lineId, node1Key, node2Key) {
            const line = document.getElementById(`conflictLine-${lineId}`);
            if (!line) return;

            // Get node positions
            const nodeMap = { gpt: 'nodeGpt', gemini: 'nodeGemini', grok: 'nodeGrok', claude: 'nodeClaude' };
            const node1 = document.getElementById(nodeMap[node1Key]);
            const node2 = document.getElementById(nodeMap[node2Key]);
            const container = document.querySelector('.core-container');

            if (!node1 || !node2 || !container) return;

            const containerRect = container.getBoundingClientRect();
            const node1Rect = node1.getBoundingClientRect();
            const node2Rect = node2.getBoundingClientRect();

            // Calculate center points relative to container
            const x1 = node1Rect.left + node1Rect.width / 2 - containerRect.left;
            const y1 = node1Rect.top + node1Rect.height / 2 - containerRect.top;
            const x2 = node2Rect.left + node2Rect.width / 2 - containerRect.left;
            const y2 = node2Rect.top + node2Rect.height / 2 - containerRect.top;

            // Set line coordinates
            line.setAttribute('x1', x1);
            line.setAttribute('y1', y1);
            line.setAttribute('x2', x2);
            line.setAttribute('y2', y2);

            // Animate in
            line.classList.remove('fade-out');
            line.classList.add('active');

            // Create spark at midpoint
            createConflictSpark((x1 + x2) / 2, (y1 + y2) / 2, container);

            // Fade out after animation
            setTimeout(() => {
                line.classList.remove('active');
                line.classList.add('fade-out');
                setTimeout(() => line.classList.remove('fade-out'), 500);
            }, 2000);
        }

        function createConflictSpark(x, y, container) {
            // Create 5 sparks bursting in different directions
            for (let i = 0; i < 5; i++) {
                const spark = document.createElement('div');
                spark.className = 'conflict-spark';
                spark.style.left = x + 'px';
                spark.style.top = y + 'px';

                // Random direction
                const angle = (Math.PI * 2 * i) / 5 + Math.random() * 0.5;
                const distance = 20 + Math.random() * 30;
                spark.style.setProperty('--spark-x', Math.cos(angle) * distance + 'px');
                spark.style.setProperty('--spark-y', Math.sin(angle) * distance + 'px');

                container.appendChild(spark);

                // Trigger animation
                requestAnimationFrame(() => spark.classList.add('animate'));

                // Remove after animation
                setTimeout(() => spark.remove(), 600);
            }
        }

        function clearConflictLines() {
            document.querySelectorAll('.conflict-line').forEach(line => {
                line.classList.remove('active', 'fade-out');
            });
        }

        function addSystemMessage(text) {
            const empty = debateStream.querySelector('.stream-empty');
            if (empty) empty.remove();

            const entry = document.createElement('div');
            entry.className = 'stream-entry';
            entry.style.background = 'rgba(99, 102, 241, 0.1)';
            entry.style.borderColor = 'var(--core-primary)';
            entry.style.textAlign = 'center';
            entry.style.maxWidth = '100%';
            entry.innerHTML = `<span style="color: var(--core-primary); font-weight: 600;">${text}</span>`;
            debateStream.appendChild(entry);
        }

        // ============================================
        // CORE ORB STATES
        // ============================================

        function setCoreState(state) {
            coreOrb.classList.remove('thinking', 'conflict', 'merging', 'consensus');

            // Remove merging class from all nodes
            document.querySelectorAll('.ai-node').forEach(n => n.classList.remove('merging'));

            switch(state) {
                case 'thinking':
                    coreOrb.classList.add('thinking');
                    coreText.textContent = 'Syncing';
                    break;
                case 'debating':
                    coreOrb.classList.add('thinking');
                    coreText.textContent = 'Debate';
                    break;
                case 'conflict':
                    coreOrb.classList.add('conflict');
                    coreText.textContent = 'Clash';
                    break;
                case 'merging':
                    coreOrb.classList.add('merging');
                    coreText.textContent = 'Merge';
                    // Animate all nodes pulling toward center
                    document.querySelectorAll('.ai-node').forEach(n => n.classList.add('merging'));
                    break;
                case 'consensus':
                    coreOrb.classList.add('consensus');
                    coreText.textContent = 'Done';
                    break;
                default:
                    coreText.textContent = 'Ready';
            }
        }

        // ============================================
        // ROUND DOTS
        // ============================================

        function updateRoundDot(index, state) {
            const dots = document.querySelectorAll('.round-dot');
            if (dots[index]) {
                dots[index].classList.remove('active', 'completed');
                if (state) dots[index].classList.add(state);
            }
        }

        function resetRoundDots() {
            document.querySelectorAll('.round-dot').forEach(d => {
                d.classList.remove('active', 'completed');
            });
        }

        // ============================================
        // SSE CONNECTION
        // ============================================

        function connectSSE(debateId) {
            return new Promise((resolve) => {
                sseConnection = new EventSource(`/api/debate/stream?id=${debateId}`);

                sseConnection.addEventListener('connected', () => resolve(true));

                sseConnection.addEventListener('debate_start', () => {
                    statusText.textContent = 'Council Convened';
                    statusPhase.textContent = 'All models initializing...';
                    setCoreState('thinking');
                });

                sseConnection.addEventListener('round_start', (e) => {
                    const data = JSON.parse(e.data);
                    currentRound = data.round;
                    statusPhase.textContent = `Round ${data.round} of ${data.totalRounds}`;
                    updateRoundDot(data.round - 1, 'active');
                    updateStreamRound(data.round);
                    setCoreState('debating');

                    // Add system message for round
                    if (data.round === 1) {
                        addSystemMessage('ROUND 1: Initial Analysis');
                    } else if (data.round === 2) {
                        addSystemMessage('ROUND 2: Rebuttal Phase');
                    } else {
                        addSystemMessage(`ROUND ${data.round}: Seeking Consensus`);
                    }
                });

                sseConnection.addEventListener('llm_start', (e) => {
                    const data = JSON.parse(e.data);
                    setNodeActive(data.llmId, true);
                });

                sseConnection.addEventListener('llm_complete', (e) => {
                    const data = JSON.parse(e.data);

                    // Deactivate the node (stop spinning)
                    setNodeActive(data.llmId, false);

                    // Add to live debate stream
                    if (data.result) {
                        addStreamEntry(data.llmId, data.result, currentRound);
                    }
                });

                sseConnection.addEventListener('round_complete', (e) => {
                    const data = JSON.parse(e.data);
                    updateRoundDot(data.round - 1, 'completed');

                    if (data.consensus?.reached) {
                        setCoreState('merging');
                        statusText.textContent = 'Consensus Forming';
                    }
                });

                sseConnection.addEventListener('synthesis_start', () => {
                    statusText.textContent = 'Synthesizing Verdict';
                    statusPhase.textContent = 'Generating action plan...';
                });

                sseConnection.addEventListener('debate_complete', () => {
                    setCoreState('consensus');
                    statusText.textContent = 'Complete';
                });

                sseConnection.onerror = () => resolve(false);
                setTimeout(() => resolve(false), 2000);
            });
        }

        function closeSSE() {
            if (sseConnection) {
                sseConnection.close();
                sseConnection = null;
            }
        }

        // ============================================
        // FORM SUBMIT
        // ============================================

        form.addEventListener('submit', async (e) => {
            e.preventDefault();

            const question = input.value.trim();
            if (!question) return;

            // Check Devil's Advocate mode
            const devilMode = devilAdvocate.checked;

            // Reset UI
            submitBtn.disabled = true;
            setLightsActive(true);
            clearStream();
            showStream();
            currentRound = 1;
            resetRoundDots();
            setCoreState('thinking');
            statusText.textContent = devilMode ? 'Engaging Devil\'s Advocate...' : 'Initiating...';
            statusPhase.textContent = 'Connecting to neural network';

            // Hide template chips, devil toggle, and context during debate
            templateChips.style.display = 'none';
            document.getElementById('devilToggle').style.opacity = '0.3';
            document.getElementById('devilToggle').style.pointerEvents = 'none';
            document.getElementById('contextToggle').style.display = 'none';
            document.getElementById('contextContainer').classList.remove('open');

            // SSE
            const debateId = Date.now().toString();
            await connectSSE(debateId);

            try {
                const res = await fetch('/api/debate', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        question,
                        context: document.getElementById('contextInput')?.value?.trim() || '',
                        tier: selectedTier,
                        debateId,
                        devilAdvocate: devilMode,
                        selectedAIs: getSelectedAIModels(),
                        personas: getAIPersonas()
                    })
                });

                const result = await res.json();
                closeSSE();

                if (result.error) throw new Error(result.error);

                currentResult = result;

                // Final animation
                setCoreState('consensus');
                statusText.textContent = 'Verdict Ready';

                await new Promise(r => setTimeout(r, 800));
                showVerdict(result);

                showToast('Decision synthesized!', 'success');

            } catch (err) {
                closeSSE();
                setCoreState('ready');
                showToast(err.message || 'Debate failed', 'error');
            } finally {
                submitBtn.disabled = false;
                setLightsActive(false);
                // Restore devil toggle and context toggle visibility
                document.getElementById('devilToggle').style.opacity = '1';
                document.getElementById('devilToggle').style.pointerEvents = 'auto';
                document.getElementById('contextToggle').style.display = 'flex';
                // Refresh usage stats after debate
                fetchUsageStats();
            }
        });

        // Input effects
        input.addEventListener('input', () => {
            setLightsActive(input.value.length > 0);
        });

        input.addEventListener('blur', () => {
            if (!input.value) setLightsActive(false);
        });

        // ============================================
        // VERDICT DISPLAY
        // ============================================

        // Reset verdict panel to clean state before populating new results
        function resetVerdictPanel() {
            // Reset hero section
            document.getElementById('verdictQuestion').textContent = '';
            document.getElementById('verdictDecision').textContent = '';
            document.getElementById('consensusBadge').className = 'consensus-badge';
            document.getElementById('consensusBadge').innerHTML = '<span>ANALYZING...</span>';
            document.getElementById('confidenceValue').textContent = '-/-';
            document.getElementById('confidenceLabel').textContent = '';

            // Reset AI Agreement cards
            ['Gpt', 'Gemini', 'Grok', 'Claude'].forEach(suffix => {
                const verdictEl = document.getElementById(`respVerdict${suffix}`);
                const summaryEl = document.getElementById(`respSummary${suffix}`);
                if (verdictEl) {
                    verdictEl.textContent = '-';
                    verdictEl.className = 'ai-resp-verdict';
                }
                if (summaryEl) {
                    summaryEl.textContent = 'Loading...';
                }
            });

            // Reset spectrum positions
            ['specGpt', 'specGemini', 'specGrok', 'specClaude'].forEach(id => {
                const el = document.getElementById(id);
                if (el) el.style.left = '50%';
            });

            // Reset Key Insights
            document.getElementById('proInsightsList').innerHTML = '<li>Loading...</li>';
            document.getElementById('conInsightsList').innerHTML = '<li>Loading...</li>';
            document.getElementById('attributionText').textContent = 'Loading...';

            // Reset Action Plan
            document.getElementById('immediateActions').innerHTML = '<li>Loading...</li>';
            document.getElementById('risksList').innerHTML = '<li>Loading...</li>';
            document.getElementById('criticalList').innerHTML = '<li>Loading...</li>';

            // Reset Timeline
            document.getElementById('decisionTimeline').innerHTML = '';

            // Reset Transcript
            document.getElementById('transcriptContent').innerHTML = '';
        }

        function showVerdict(result) {
            // Reset followup section when showing new verdict
            document.getElementById('followupSection').classList.remove('active');
            document.getElementById('followupInput').value = '';

            // Reset all verdict fields to default state before populating
            resetVerdictPanel();

            const consensus = result.finalConsensus;
            const lastRound = result.rounds[result.rounds.length - 1];
            const allResults = lastRound?.results?.filter(r => !r.error) || [];

            // Question (smaller, below the hero)
            document.getElementById('verdictQuestion').textContent = result.question;

            // Decision Hero - ONLY the verdict, not the full analysis
            const decision = consensus.decision || consensus.majority?.decision || 'ANALYSIS COMPLETE';
            // Short qualifier only (first sentence or 60 chars max)
            const position = consensus.position || consensus.majority?.position || '';
            const shortPosition = position.split('.')[0] || '';
            const heroText = shortPosition.length > 60
                ? decision
                : (shortPosition ? `${decision}. ${shortPosition}.` : decision);
            document.getElementById('verdictDecision').textContent = heroText;

            // Consensus badge - show clear agreement status
            const badge = document.getElementById('consensusBadge');
            const totalAIs = allResults.length;
            if (consensus.reached) {
                badge.className = 'consensus-badge';
                badge.innerHTML = `<span>${consensus.type === 'unanimous' ? 'ALL ' + totalAIs + ' AIs AGREE' : 'STRONG CONSENSUS'}</span>`;
            } else {
                badge.className = 'consensus-badge split';
                const majorityDec = consensus.majority?.decision || 'SPLIT';
                const majorityCount = consensus.majority?.count || 2;
                badge.innerHTML = `<span>MAJORITY: ${majorityDec} (${majorityCount}/${totalAIs})</span>`;
            }

            // AI Agreement Count (much clearer than arbitrary confidence %)
            const totalAIs2 = allResults.length;
            const majorityDecision = consensus.decision || consensus.majority?.decision || 'SPLIT';
            const agreementCount = allResults.filter(r => r.decision === majorityDecision).length;

            document.getElementById('confidenceValue').textContent = `${agreementCount}/${totalAIs2}`;
            const labelEl = document.getElementById('confidenceLabel');
            if (agreementCount === totalAIs2) {
                labelEl.textContent = 'Unanimous';
            } else if (agreementCount >= totalAIs2 - 1) {
                labelEl.textContent = `Agree on ${majorityDecision}`;
            } else {
                labelEl.textContent = 'AI Positions Split';
            }

            // Spectrum positions + AI Agreement cards
            const cardIdMap = { openai: 'Gpt', gemini: 'Gemini', grok: 'Grok', claude: 'Claude' };
            allResults.forEach(r => {
                // Spectrum avatar positioning
                const avatarMap = { openai: 'specGpt', gemini: 'specGemini', grok: 'specGrok', claude: 'specClaude' };
                const avatar = document.getElementById(avatarMap[r.llmId]);
                if (avatar) {
                    let pos = 50;
                    if (r.decision === 'YES') pos = 70 + Math.random() * 25;
                    else if (r.decision === 'NO') pos = 5 + Math.random() * 25;
                    else if (r.decision === 'CONDITIONAL') pos = 40 + Math.random() * 20;
                    else if (r.decision === 'WAIT') pos = 25 + Math.random() * 20;
                    avatar.style.left = pos + '%';
                }

                // AI Agreement card
                const cardSuffix = cardIdMap[r.llmId];
                if (cardSuffix) {
                    const verdictEl = document.getElementById(`respVerdict${cardSuffix}`);
                    const summaryEl = document.getElementById(`respSummary${cardSuffix}`);
                    if (verdictEl) {
                        verdictEl.textContent = r.decision || '-';
                        verdictEl.className = `ai-resp-verdict ${(r.decision || '').toLowerCase()}`;
                    }
                    if (summaryEl) {
                        summaryEl.textContent = r.key_argument || r.position || 'No summary available';
                    }
                }
            });

            // Populate Key Insights (2-column grid)
            const proInsights = [];
            const conInsights = [];

            // Extract supporting arguments from YES/CONDITIONAL votes
            allResults.forEach(r => {
                const colorClass = r.llmId === 'openai' ? 'gpt' : r.llmId;
                if (r.key_argument) {
                    if (r.decision === 'YES' || (r.decision === 'CONDITIONAL' && consensus.decision === 'YES')) {
                        proInsights.push(`<li><span class="attr-${colorClass}" title="${r.llmName}">${r.key_argument}</span></li>`);
                    } else {
                        conInsights.push(`<li><span class="attr-${colorClass}" title="${r.llmName}">${r.key_argument}</span></li>`);
                    }
                }

                // Also add risks if available
                if (r.risks && r.risks.length > 0) {
                    r.risks.slice(0, 2).forEach(risk => {
                        conInsights.push(`<li>${risk}</li>`);
                    });
                }
            });

            // Populate the lists
            document.getElementById('proInsightsList').innerHTML =
                proInsights.length > 0 ? proInsights.join('') : '<li>See full analysis below</li>';
            document.getElementById('conInsightsList').innerHTML =
                conInsights.length > 0 ? conInsights.join('') : '<li>No major concerns identified</li>';

            // Synthesis summary - keep it concise
            const fullAnalysis = result.actionPlan?.executive_summary || position;
            document.getElementById('attributionText').textContent = fullAnalysis;

            // Action plan (always populate with defaults if missing)
            const actionPlan = result.actionPlan || {};
            document.getElementById('immediateActions').innerHTML =
                (actionPlan.immediate_actions || []).map(a => `<li>${a}</li>`).join('') || '<li>Proceed with recommendation</li>';
            document.getElementById('risksList').innerHTML =
                (actionPlan.risk_mitigation || []).map(r => `<li>${r}</li>`).join('') || '<li>No major risks identified</li>';
            document.getElementById('criticalList').innerHTML =
                (actionPlan.before_proceeding || []).map(b => `<li>${b}</li>`).join('') || '<li>No critical prerequisites</li>';

            // Decision Timeline - show how the decision was made
            const timelineEl = document.getElementById('decisionTimeline');
            let timelineHtml = '';

            // Show each round
            result.rounds.forEach((round, idx) => {
                const roundNum = idx + 1;
                const roundResults = round.results || [];
                const decisions = roundResults.map(r => r.decision).filter(Boolean);
                const uniqueDecisions = [...new Set(decisions)];
                const isConflict = uniqueDecisions.length > 1;
                const stepClass = isConflict ? 'conflict' : 'complete';

                let roundDesc = '';
                if (roundNum === 1) {
                    roundDesc = `All 4 AIs provided initial analysis. ${isConflict ? 'Disagreement detected.' : 'Initial positions aligned.'}`;
                } else if (roundNum === result.rounds.length) {
                    roundDesc = consensus.reached
                        ? `Final round reached ${consensus.type} consensus on ${consensus.decision}.`
                        : `Final positions: ${uniqueDecisions.join(' vs ')}.`;
                } else {
                    const changed = roundResults.filter(r => r.changed).length;
                    roundDesc = changed > 0
                        ? `${changed} AI(s) revised their position after seeing counterarguments.`
                        : `AIs defended their positions and addressed counterarguments.`;
                }

                timelineHtml += `
                    <div class="timeline-step ${stepClass}">
                        <div class="timeline-step-content">
                            <div class="timeline-step-title">Round ${roundNum}: ${roundNum === 1 ? 'Initial Analysis' : roundNum === result.rounds.length ? 'Final Consensus' : 'Debate & Rebuttal'}</div>
                            <div class="timeline-step-desc">${roundDesc}</div>
                        </div>
                    </div>
                `;
            });

            // Final synthesis step
            timelineHtml += `
                <div class="timeline-step complete">
                    <div class="timeline-step-content">
                        <div class="timeline-step-title">Synthesis</div>
                        <div class="timeline-step-desc">All perspectives combined into actionable recommendation.</div>
                    </div>
                </div>
            `;

            timelineEl.innerHTML = timelineHtml;

            // Populate the full debate transcript
            populateTranscript(result);

            // Show panel
            verdictOverlay.classList.add('active');

            // Show post-debate UI (drawer handle, scrubber)
            showPostDebateUI(result);
        }

        function closeVerdict() {
            verdictOverlay.classList.remove('active');
            // Also hide the post-debate UI elements
            hidePostDebateUI();
        }

        function newDebate() {
            closeVerdict();
            hidePostDebateUI();
            hideStream();
            currentRound = 1;
            input.value = '';
            input.focus();
            setCoreState('ready');
            statusText.textContent = 'Ask the Council';
            statusPhase.textContent = 'Enter your question below';
            resetRoundDots();
            // Reset followup section and context
            document.getElementById('followupSection').classList.remove('active');
            document.getElementById('followupInput').value = '';
            document.getElementById('contextInput').value = '';
            document.getElementById('contextContainer').classList.remove('open');
            document.getElementById('contextToggle').classList.remove('open');
            // Show template chips again and reset state
            currentTemplateValue = null;
            const templateChips = document.getElementById('templateChips');
            templateChips.style.display = 'grid';
            templateChips.style.opacity = '1';
            templateChips.style.transform = 'translateY(0)';
            templateChips.querySelectorAll('.template-chip').forEach(c => c.classList.remove('dissolving', 'selected'));
        }

        function copyShareLink() {
            if (!currentResult?.shareId) {
                showToast('No debate to share', 'error');
                return;
            }
            const url = `${window.location.origin}/share/${currentResult.shareId}`;
            navigator.clipboard.writeText(url).then(() => {
                showToast('Link copied!', 'success');
            });
        }

        // ============================================
        // FOLLOW-UP QUESTIONS
        // ============================================

        function askFollowup() {
            document.getElementById('followupSection').classList.add('active');
            document.getElementById('followupInput').focus();
        }

        // Build rich context from previous debate for follow-up
        function buildFollowupContext() {
            if (!currentResult) return '';

            const parts = [];

            // Original question
            parts.push(`## Original Question\n${currentResult.question}`);

            // Final consensus/decision
            const consensus = currentResult.finalConsensus;
            if (consensus) {
                const decision = consensus.position || consensus.majority?.position || 'No clear decision';
                const consensusType = consensus.reached
                    ? `${consensus.type} consensus (${consensus.confidence}/10 confidence)`
                    : 'Split decision';
                parts.push(`## Previous Decision\n${decision}\n(${consensusType})`);
            }

            // Key arguments from each LLM in the final round
            const lastRound = currentResult.rounds?.[currentResult.rounds.length - 1];
            if (lastRound?.results) {
                const llmSummaries = lastRound.results
                    .filter(r => !r.error)
                    .map(r => {
                        let summary = `**${r.llmName}**: ${r.position}`;
                        if (r.key_argument) {
                            summary += `\n  - Key argument: "${r.key_argument}"`;
                        }
                        if (r.risks && r.risks.length > 0) {
                            summary += `\n  - Risks identified: ${r.risks.join(', ')}`;
                        }
                        return summary;
                    })
                    .join('\n\n');

                parts.push(`## Individual AI Positions\n${llmSummaries}`);
            }

            // Any dissenting opinions (if split decision)
            if (!consensus?.reached && consensus?.positions) {
                const dissent = consensus.positions
                    .slice(1) // Skip majority
                    .map(p => `- ${p.position} (${p.count} vote${p.count > 1 ? 's' : ''})`)
                    .join('\n');
                if (dissent) {
                    parts.push(`## Alternative Viewpoints\n${dissent}`);
                }
            }

            return parts.join('\n\n---\n\n');
        }

        function submitFollowup() {
            const followupQ = document.getElementById('followupInput').value.trim();
            if (!followupQ) return;

            // Close the verdict panel first
            closeVerdict();
            hidePostDebateUI();

            // Set the follow-up as the new question
            input.value = followupQ;

            // Build rich context from the previous debate
            const richContext = buildFollowupContext();
            const contextInput = document.getElementById('contextInput');
            contextInput.value = `This is a FOLLOW-UP question to a previous AI debate. Please consider the previous discussion when forming your position.\n\n${richContext}`;

            // Open context container to show the context is set
            document.getElementById('contextContainer').classList.add('open');

            // Clear follow-up UI
            document.getElementById('followupSection').classList.remove('active');
            document.getElementById('followupInput').value = '';

            // Submit the form
            form.dispatchEvent(new Event('submit'));
        }

        // ============================================
        // DEBATE TRANSCRIPT
        // ============================================

        function toggleTranscript() {
            const transcript = document.querySelector('.debate-transcript');
            transcript.classList.toggle('open');
        }

        // Helper to sanitize response fields that might contain raw JSON
        function sanitizeResponse(r) {
            let position = r.position || 'No position stated';
            let decision = r.decision || 'ANALYZING';
            let keyArg = r.key_argument;

            // If position looks like JSON, try to parse it
            if (typeof position === 'string' && position.trim().startsWith('{')) {
                try {
                    const parsed = JSON.parse(position);
                    position = parsed.position || parsed.reasoning || position;
                    decision = parsed.decision || decision;
                    keyArg = parsed.key_argument || keyArg;
                } catch (e) {
                    // If still can't parse, truncate the JSON garbage
                    position = position.replace(/^\s*\{[\s\S]*?"position"\s*:\s*"/, '').replace(/"[\s\S]*$/, '');
                }
            }

            // If position is an object (shouldn't happen but safety)
            if (typeof position === 'object') {
                position = position.position || JSON.stringify(position).substring(0, 200);
            }

            return { ...r, position, decision, key_argument: keyArg };
        }

        function populateTranscript(result) {
            const container = document.getElementById('transcriptContent');
            const modelNames = { openai: 'GPT-4o', gemini: 'Gemini', claude: 'Claude', grok: 'Grok' };
            const modelAbbrev = { openai: 'GPT', gemini: 'GEM', claude: 'CLD', grok: 'GRK' };

            let html = '<div class="transcript-inner">';

            result.rounds.forEach((round, idx) => {
                const roundNum = idx + 1;
                let roundLabel = roundNum === 1 ? 'Initial Analysis' :
                                 roundNum === result.rounds.length ? 'Final Positions' : 'Debate & Rebuttal';

                html += `<div class="transcript-round">`;
                html += `<div class="transcript-round-header">Round ${roundNum}: ${roundLabel}</div>`;

                (round.results || []).forEach(rawR => {
                    const r = sanitizeResponse(rawR);
                    const llmClass = r.llmId === 'openai' ? 'gpt' : r.llmId;
                    const verdictClass = (r.decision || '').toLowerCase();
                    const changedBadge = r.changed ? '<span class="transcript-changed">Changed Mind</span>' : '';

                    html += `
                        <div class="transcript-message ${llmClass}">
                            <div class="transcript-avatar">${modelAbbrev[r.llmId] || r.llmId}</div>
                            <div class="transcript-body">
                                <div class="transcript-header">
                                    <span class="transcript-name">${modelNames[r.llmId] || r.llmId}</span>
                                    <span class="transcript-verdict ${verdictClass}">${r.decision}</span>
                                    ${changedBadge}
                                </div>
                                <div class="transcript-text">${r.position}</div>
                                ${r.key_argument ? `<div class="transcript-key-arg">"${r.key_argument}"</div>` : ''}
                            </div>
                        </div>
                    `;
                });

                html += `</div>`;
            });

            html += '</div>';
            container.innerHTML = html;
        }

        // ============================================
        // TOAST
        // ============================================

        function showToast(message, type = 'success') {
            toast.textContent = message;
            toast.className = `toast ${type} show`;
            setTimeout(() => toast.classList.remove('show'), 3000);
        }

        // ============================================
        // NODE INSPECTOR (Click-to-View Details)
        // ============================================

        const nodeInspector = document.getElementById('nodeInspector');
        const llmDataStore = {}; // Store LLM results for inspection

        const aiConfig = {
            openai: { name: 'GPT-4o', color: 'var(--ai-gpt)', bg: 'rgba(16, 163, 127, 0.2)' },
            gemini: { name: 'Gemini', color: 'var(--ai-gemini)', bg: 'rgba(66, 133, 244, 0.2)' },
            claude: { name: 'Claude', color: 'var(--ai-claude)', bg: 'rgba(217, 119, 6, 0.2)' },
            grok: { name: 'Grok', color: 'var(--ai-grok)', bg: 'rgba(249, 115, 22, 0.2)' }
        };

        function openInspector(llmId) {
            const data = llmDataStore[llmId];
            if (!data) {
                showToast('No data available for this model', 'error');
                return;
            }

            const config = aiConfig[llmId];
            document.getElementById('dossierIcon').style.background = config.bg;
            document.getElementById('dossierIcon').style.border = `2px solid ${config.color}`;
            document.getElementById('dossierTitle').textContent = config.name;
            document.getElementById('dossierTitle').style.color = config.color;

            const verdict = data.decision || 'ANALYZING';
            document.getElementById('dossierVerdict').textContent = verdict;
            document.getElementById('dossierVerdict').style.background =
                verdict === 'YES' ? 'rgba(16, 185, 129, 0.2)' :
                verdict === 'NO' ? 'rgba(239, 68, 68, 0.2)' : 'rgba(245, 158, 11, 0.2)';
            document.getElementById('dossierVerdict').style.color =
                verdict === 'YES' ? 'var(--success)' :
                verdict === 'NO' ? 'var(--error)' : 'var(--warning)';

            const analysis = data.key_argument || data.position || 'No detailed analysis available.';
            document.getElementById('dossierBody').textContent = analysis;

            const confidence = data.confidence || 7;
            document.getElementById('dossierMeter').style.width = (confidence * 10) + '%';
            document.getElementById('dossierMeter').style.background = config.color;
            document.getElementById('dossierConfidence').textContent = confidence + '/10';

            nodeInspector.classList.add('active');
        }

        function closeInspector() {
            nodeInspector.classList.remove('active');
        }

        // Attach click handlers to nodes
        document.getElementById('nodeGpt').addEventListener('click', () => openInspector('openai'));
        document.getElementById('nodeGemini').addEventListener('click', () => openInspector('gemini'));
        document.getElementById('nodeClaude').addEventListener('click', () => openInspector('claude'));
        document.getElementById('nodeGrok').addEventListener('click', () => openInspector('grok'));

        // ============================================
        // TACTICAL DRAWER
        // ============================================

        const tacticalHandle = document.getElementById('tacticalHandle');
        const tacticalDrawer = document.getElementById('tacticalDrawer');

        function toggleDrawer() {
            tacticalDrawer.classList.toggle('open');
        }

        function populateDrawer(actionPlan) {
            if (!actionPlan) return;

            const actions = actionPlan.immediate_actions || ['Proceed with recommendation'];
            const risks = actionPlan.risk_mitigation || ['No major risks identified'];
            const timeline = actionPlan.timeline || ['Execute when ready'];
            const indicators = actionPlan.success_indicators || ['Monitor outcomes'];

            document.getElementById('drawerActions').innerHTML = actions.map(a => `<li>${a}</li>`).join('');
            document.getElementById('drawerRisks').innerHTML = risks.map(r => `<li>${r}</li>`).join('');
            document.getElementById('drawerTimeline').innerHTML = timeline.map(t => `<li>${t}</li>`).join('');
            document.getElementById('drawerIndicators').innerHTML = indicators.map(i => `<li>${i}</li>`).join('');
        }

        // ============================================
        // TIMELINE SCRUBBER
        // ============================================

        const timelineScrubber = document.getElementById('timelineScrubber');
        let debateRounds = [];

        function scrubTimeline(value) {
            const idx = parseInt(value);
            const maxRounds = debateRounds.length || 3;
            const progress = (idx / maxRounds) * 100;
            document.getElementById('scrubberProgress').style.width = progress + '%';

            if (idx === maxRounds || idx >= debateRounds.length) {
                document.getElementById('scrubberSummary').textContent = 'Final verdict reached with consensus.';
            } else if (debateRounds[idx]) {
                const round = debateRounds[idx];
                const summary = round.results?.map(r =>
                    `${aiConfig[r.llmId]?.name || r.llmId}: ${r.decision}`
                ).join('  ') || `Round ${idx + 1} summary`;
                document.getElementById('scrubberSummary').textContent = summary;
            } else {
                document.getElementById('scrubberSummary').textContent = `Round ${idx + 1}: Positions being formed...`;
            }
        }

        // ============================================
        // SHOW POST-DEBATE UI
        // ============================================

        function showPostDebateUI(result) {
            // Store LLM data for inspector
            const lastRound = result.rounds[result.rounds.length - 1];
            if (lastRound?.results) {
                lastRound.results.forEach(r => {
                    if (!r.error) {
                        llmDataStore[r.llmId] = r;
                    }
                });
            }

            // Store rounds for scrubber
            debateRounds = result.rounds || [];

            // Populate drawer
            populateDrawer(result.actionPlan);

            // Show UI elements
            tacticalHandle.classList.add('visible');
            timelineScrubber.classList.add('visible');

            // Update scrubber max based on actual rounds
            const scrubberInput = document.getElementById('scrubberInput');
            scrubberInput.max = debateRounds.length;
            scrubberInput.value = debateRounds.length;

            // Update labels dynamically
            const labelsContainer = document.getElementById('scrubberLabels');
            let labelsHTML = '';
            for (let i = 1; i <= debateRounds.length; i++) {
                labelsHTML += `<span>Round ${i}</span>`;
            }
            labelsHTML += '<span>Final</span>';
            labelsContainer.innerHTML = labelsHTML;

            scrubTimeline(debateRounds.length);
        }

        function hidePostDebateUI() {
            tacticalHandle.classList.remove('visible');
            timelineScrubber.classList.remove('visible');
            tacticalDrawer.classList.remove('open');
        }

        // ============================================
        // CONTEXT INPUT TOGGLE
        // ============================================

        function toggleContext() {
            const toggle = document.getElementById('contextToggle');
            const container = document.getElementById('contextContainer');
            toggle.classList.toggle('open');
            container.classList.toggle('open');
        }

        // ============================================
        // USAGE STATS
        // ============================================

        async function fetchUsageStats() {
            try {
                const res = await fetch('/api/config');
                const data = await res.json();

                const usageCount = document.getElementById('usageCount');

                // Update usage display
                if (data.user) {
                    const remaining = data.user.remaining;
                    const limit = data.user.dailyLimit;

                    if (remaining !== undefined && remaining !== 'unlimited') {
                        usageCount.textContent = `${remaining}/${limit}`;

                        // Visual feedback when low on debates
                        if (remaining <= 1 && remaining > 0) {
                            usageCount.style.color = 'var(--warning)';
                        } else if (remaining === 0) {
                            usageCount.style.color = 'var(--error)';
                        }
                    } else if (remaining === 'unlimited') {
                        usageCount.textContent = '';
                        usageCount.style.color = 'var(--success)';
                    }

                    // Update tier selector based on user tier
                    const userTier = data.user.tier;
                    const canUsePremium = userTier === 'pro' || userTier === 'enterprise' || userTier === 'owner';
                    updateTierSelectorAccess(canUsePremium);

                    // Set initial tier selector to match server's active tier
                    if (data.activeTier) {
                        selectedTier = data.activeTier;
                        updateTierSelectorUI(data.activeTier);
                    }
                }
            } catch (err) {
                console.log('Could not fetch usage stats');
            }
        }

        // Fetch usage stats on load
        fetchUsageStats();

        // ============================================
        // CLERK AUTHENTICATION
        // ============================================

        let clerkInstance = null;
        let authConfigured = false;
        let currentUser = null;

        async function initAuth() {
            const authLoading = document.getElementById('authLoading');
            const authSignedOut = document.getElementById('authSignedOut');
            const authSignedIn = document.getElementById('authSignedIn');

            try {
                // Get auth config from server
                const configRes = await fetch('/api/config');
                const configData = await configRes.json();

                if (!configData.auth?.configured || !configData.auth?.publishableKey) {
                    // Auth not configured - hide auth UI entirely
                    authLoading.style.display = 'none';
                    authConfigured = false;
                    console.log('Clerk not configured - auth disabled');
                    return;
                }

                authConfigured = true;
                const publishableKey = configData.auth.publishableKey;

                // Load Clerk script dynamically
                await loadClerkScript(publishableKey);

                // Initialize Clerk
                clerkInstance = window.Clerk;
                await clerkInstance.load();

                // Listen for auth state changes
                clerkInstance.addListener(() => {
                    updateAuthUI();
                });

                // Initial UI update
                updateAuthUI();

            } catch (error) {
                console.error('Auth initialization failed:', error);
                authLoading.style.display = 'none';
                authConfigured = false;
            }
        }

        function loadClerkScript(publishableKey) {
            return new Promise((resolve, reject) => {
                if (window.Clerk) {
                    resolve();
                    return;
                }

                const script = document.createElement('script');
                script.src = 'https://cdn.jsdelivr.net/npm/@clerk/clerk-js@latest/dist/clerk.browser.js';
                script.crossOrigin = 'anonymous';
                script.setAttribute('data-clerk-publishable-key', publishableKey);
                script.onload = () => setTimeout(resolve, 100);
                script.onerror = reject;
                document.head.appendChild(script);
            });
        }

        function updateAuthUI() {
            const authLoading = document.getElementById('authLoading');
            const authSignedOut = document.getElementById('authSignedOut');
            const authSignedIn = document.getElementById('authSignedIn');
            const userAvatar = document.getElementById('userAvatar');
            const userName = document.getElementById('userName');
            const userTier = document.getElementById('userTier');

            authLoading.style.display = 'none';

            if (!clerkInstance) {
                authSignedOut.style.display = 'none';
                authSignedIn.style.display = 'none';
                return;
            }

            const user = clerkInstance.user;

            if (user) {
                currentUser = user;
                authSignedOut.style.display = 'none';
                authSignedIn.style.display = 'block';

                // Update avatar
                if (user.imageUrl) {
                    userAvatar.innerHTML = `<img src="${user.imageUrl}" alt="Avatar">`;
                } else {
                    const initials = (user.firstName?.[0] || '') + (user.lastName?.[0] || user.emailAddresses?.[0]?.emailAddress?.[0] || 'U');
                    userAvatar.innerHTML = initials.toUpperCase();
                }

                // Update name
                userName.textContent = user.firstName || user.emailAddresses?.[0]?.emailAddress?.split('@')[0] || 'User';

                // Update tier
                const tier = user.publicMetadata?.tier || 'free';
                userTier.textContent = tier.toUpperCase();
                userTier.className = `user-tier user-tier-${tier}`;

                // Refresh usage stats when logged in
                fetchUsageStats();
            } else {
                currentUser = null;
                authSignedOut.style.display = 'flex';
                authSignedIn.style.display = 'none';
            }
        }

        function handleSignIn() {
            if (clerkInstance) {
                clerkInstance.openSignIn({
                    afterSignInUrl: window.location.href,
                    afterSignUpUrl: window.location.href
                });
            }
        }

        function handleSignUp() {
            if (clerkInstance) {
                clerkInstance.openSignUp({
                    afterSignInUrl: window.location.href,
                    afterSignUpUrl: window.location.href
                });
            }
        }

        function handleSignOut() {
            if (clerkInstance) {
                clerkInstance.signOut();
            }
        }

        function handleManageAccount() {
            if (clerkInstance) {
                clerkInstance.openUserProfile();
            }
        }

        function toggleUserMenu() {
            const userMenu = document.getElementById('userMenu');
            userMenu.classList.toggle('active');
        }

        // Close user menu when clicking outside
        document.addEventListener('click', (e) => {
            const userMenu = document.getElementById('userMenu');
            if (userMenu && !userMenu.contains(e.target)) {
                userMenu.classList.remove('active');
            }
        });

        // ============================================
        // HISTORY DRAWER
        // ============================================

        let historyData = [];

        function toggleHistoryDrawer() {
            const drawer = document.getElementById('historyDrawer');
            const overlay = document.getElementById('historyOverlay');
            drawer.classList.toggle('open');
            overlay.classList.toggle('active');

            if (drawer.classList.contains('open')) {
                loadHistory();
            }
        }

        function closeHistoryDrawer() {
            document.getElementById('historyDrawer').classList.remove('open');
            document.getElementById('historyOverlay').classList.remove('active');
        }

        // ============================================
        // UPGRADE MODAL
        // ============================================

        function showUpgradeModal() {
            document.getElementById('upgradeOverlay').classList.add('active');
        }

        function closeUpgradeModal(event) {
            if (event.target === event.currentTarget) {
                document.getElementById('upgradeOverlay').classList.remove('active');
            }
        }

        async function handleUpgrade() {
            const ctaBtn = document.getElementById('upgradeCtaBtn');
            const originalText = ctaBtn.textContent;

            try {
                // Check if Stripe is configured
                const configRes = await fetch('/api/stripe/config');
                const stripeConfig = await configRes.json();

                if (!stripeConfig.configured) {
                    showToast('Payment system is being set up. Please try again soon!', 'warning');
                    return;
                }

                // Check if user is authenticated
                const authRes = await fetch('/api/auth/me');
                const authData = await authRes.json();

                if (!authData.authenticated) {
                    document.getElementById('upgradeOverlay').classList.remove('active');
                    // Open Clerk sign-in modal
                    handleSignIn();
                    return;
                }

                // Show loading state
                ctaBtn.disabled = true;
                ctaBtn.textContent = 'Redirecting...';

                // Create checkout session
                const checkoutRes = await fetch('/api/stripe/checkout', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' }
                });

                const checkoutData = await checkoutRes.json();

                if (checkoutData.error) {
                    throw new Error(checkoutData.error);
                }

                // Redirect to Stripe Checkout
                if (checkoutData.url) {
                    window.location.href = checkoutData.url;
                }
            } catch (error) {
                console.error('Upgrade error:', error);
                showToast('Failed to start checkout. Please try again.', 'error');
                ctaBtn.disabled = false;
                ctaBtn.textContent = originalText;
            }
        }

        // ============================================
        // TIER SELECTOR
        // ============================================

        let userCanUsePremium = false; // Will be set based on user tier

        function toggleTierSelector() {
            const selector = document.getElementById('tierSelector');
            selector.classList.toggle('open');

            // Close when clicking outside
            if (selector.classList.contains('open')) {
                setTimeout(() => {
                    document.addEventListener('click', closeTierSelectorOnClickOutside);
                }, 0);
            }
        }

        function closeTierSelectorOnClickOutside(e) {
            const selector = document.getElementById('tierSelector');
            if (!selector.contains(e.target)) {
                selector.classList.remove('open');
                document.removeEventListener('click', closeTierSelectorOnClickOutside);
            }
        }

        async function selectTier(tier) {
            const premiumOption = document.getElementById('tierOptionPremium');

            // If selecting premium and user can't use it, show upgrade modal
            if (tier === 'premium' && premiumOption.classList.contains('locked')) {
                document.getElementById('tierSelector').classList.remove('open');
                showUpgradeModal();
                return;
            }

            try {
                const res = await fetch('/api/tier', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ tier })
                });

                const data = await res.json();

                if (data.error) {
                    if (data.upgradeRequired) {
                        showUpgradeModal();
                    } else {
                        showToast(data.error, 'error');
                    }
                    return;
                }

                // Update UI
                selectedTier = tier;
                updateTierSelectorUI(tier);
                showToast(`Switched to ${tier === 'premium' ? 'Premium' : 'Budget'} models`, 'success');

            } catch (error) {
                console.error('Failed to change tier:', error);
                showToast('Failed to change model tier', 'error');
            }

            document.getElementById('tierSelector').classList.remove('open');
        }

        function updateTierSelectorUI(tier) {
            const btn = document.getElementById('tierSelectorBtn');
            const label = document.getElementById('tierSelectorLabel');
            const budgetOption = document.getElementById('tierOptionBudget');
            const premiumOption = document.getElementById('tierOptionPremium');
            const budgetCheck = document.getElementById('tierCheckBudget');
            const premiumBadge = document.getElementById('tierPremiumBadge');

            // Update button label and style
            label.textContent = tier === 'premium' ? 'Premium' : 'Budget';
            btn.classList.toggle('premium', tier === 'premium');

            // Update option active states
            budgetOption.classList.toggle('active', tier === 'budget');
            premiumOption.classList.toggle('active', tier === 'premium');

            // Show/hide checkmarks
            budgetCheck.style.display = tier === 'budget' ? 'block' : 'none';

            // If premium is selected and user can use it, show check instead of badge
            if (tier === 'premium' && userCanUsePremium) {
                premiumBadge.style.display = 'none';
                // Add check to premium option if not exists
                if (!document.getElementById('tierCheckPremium')) {
                    const check = budgetCheck.cloneNode(true);
                    check.id = 'tierCheckPremium';
                    premiumOption.appendChild(check);
                } else {
                    document.getElementById('tierCheckPremium').style.display = 'block';
                }
            }
        }

        function updateTierSelectorAccess(canUsePremium) {
            userCanUsePremium = canUsePremium;
            const premiumOption = document.getElementById('tierOptionPremium');
            const premiumBadge = document.getElementById('tierPremiumBadge');

            if (canUsePremium) {
                premiumOption.classList.remove('locked');
                premiumBadge.textContent = '';
                premiumBadge.style.display = 'none';
            } else {
                premiumOption.classList.add('locked');
                premiumBadge.textContent = 'PRO';
                premiumBadge.style.display = 'inline';
            }
        }

        // ============================================
        // AI SETTINGS PANEL
        // ============================================

        // Track selected AIs (default: all 4)
        let selectedAIs = new Set(['openai', 'gemini', 'claude', 'grok']);

        // Track personas for each AI
        let aiPersonas = {
            openai: 'balanced',
            gemini: 'innovative',
            claude: 'risk-aware',
            grok: 'direct'
        };

        function openAISettings() {
            document.getElementById('aiSettingsOverlay').classList.add('open');
            document.getElementById('aiSettingsPanel').classList.add('open');
            updateAISettingsUI();
        }

        function closeAISettings() {
            document.getElementById('aiSettingsOverlay').classList.remove('open');
            document.getElementById('aiSettingsPanel').classList.remove('open');
        }

        function toggleAISelection(aiId) {
            const item = document.querySelector(`.ai-select-item[data-ai="${aiId}"]`);

            if (selectedAIs.has(aiId)) {
                // Don't allow deselecting if only 2 AIs are selected
                if (selectedAIs.size <= 2) {
                    showToast('At least 2 AIs required for debate', 'warning');
                    return;
                }
                selectedAIs.delete(aiId);
                item.classList.remove('selected');
            } else {
                selectedAIs.add(aiId);
                item.classList.add('selected');
            }

            // Update persona items visibility
            updatePersonaVisibility();

            // Update the AI nodes in the arena to reflect selection
            updateArenaNodes();
        }

        function updatePersonaVisibility() {
            const aiMapping = {
                openai: 'Gpt',
                gemini: 'Gemini',
                claude: 'Claude',
                grok: 'Grok'
            };

            Object.entries(aiMapping).forEach(([aiId, name]) => {
                const personaItem = document.getElementById(`persona${name}`);
                if (personaItem) {
                    personaItem.classList.toggle('disabled', !selectedAIs.has(aiId));
                    const select = personaItem.querySelector('select');
                    if (select) {
                        select.disabled = !selectedAIs.has(aiId);
                    }
                }
            });
        }

        function updatePersona(aiId, persona) {
            aiPersonas[aiId] = persona;
            console.log(`Updated ${aiId} persona to: ${persona}`);
        }

        function updateAISettingsUI() {
            // Update checkboxes based on selectedAIs
            document.querySelectorAll('.ai-select-item').forEach(item => {
                const aiId = item.dataset.ai;
                item.classList.toggle('selected', selectedAIs.has(aiId));
            });

            // Update persona visibility
            updatePersonaVisibility();
        }

        function updateArenaNodes() {
            // Show/hide AI nodes in the arena based on selection
            const nodeMapping = {
                openai: 'nodeGpt',
                gemini: 'nodeGemini',
                claude: 'nodeClaude',
                grok: 'nodeGrok'
            };

            Object.entries(nodeMapping).forEach(([aiId, nodeId]) => {
                const node = document.getElementById(nodeId);
                if (node) {
                    node.style.display = selectedAIs.has(aiId) ? 'flex' : 'none';
                    node.style.opacity = selectedAIs.has(aiId) ? '1' : '0';
                }
            });
        }

        // Get selected AIs for API call
        function getSelectedAIModels() {
            return Array.from(selectedAIs);
        }

        // Get personas for API call
        function getAIPersonas() {
            return aiPersonas;
        }

        async function loadHistory() {
            const content = document.getElementById('historyContent');

            try {
                const res = await fetch('/api/history');
                historyData = await res.json();

                if (historyData.length === 0) {
                    content.innerHTML = `
                        <div class="history-empty">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                                <circle cx="12" cy="12" r="10"></circle>
                                <polyline points="12 6 12 12 16 14"></polyline>
                            </svg>
                            <p>No decisions yet.<br>Start your first debate!</p>
                        </div>
                    `;
                    return;
                }

                content.innerHTML = historyData.map((item, index) => {
                    const date = new Date(item.timestamp);
                    const dateStr = date.toLocaleDateString('en-US', {
                        month: 'short',
                        day: 'numeric',
                        hour: '2-digit',
                        minute: '2-digit'
                    });
                    const consensus = item.finalConsensus;
                    const isConsensus = consensus?.reached;
                    const verdictText = isConsensus
                        ? (consensus.type === 'unanimous' ? 'Unanimous' : 'Consensus')
                        : 'Split';

                    return `
                        <div class="history-item" onclick="viewHistoryItem(${index})">
                            <div class="history-item-date">${dateStr}</div>
                            <div class="history-item-question">${item.question}</div>
                            <span class="history-item-verdict ${isConsensus ? 'consensus' : 'split'}">${verdictText}</span>
                        </div>
                    `;
                }).join('');

            } catch (err) {
                console.error('Failed to load history:', err);
                content.innerHTML = `
                    <div class="history-empty">
                        <p>Failed to load history</p>
                    </div>
                `;
            }
        }

        function viewHistoryItem(index) {
            const item = historyData[index];
            if (!item) return;

            // Close the drawer
            closeHistoryDrawer();

            // Display this result in the verdict panel
            currentResult = item;
            showVerdict(item);
        }

        // ============================================
        // INIT
        // ============================================

        // Initialize auth
        initAuth();

        // Focus input on load
        setTimeout(() => input.focus(), 500);
    </script>
</body>
</html>
